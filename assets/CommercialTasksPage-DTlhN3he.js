const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TaskBoardPage-GMSCTpTp.js","assets/pdf-vendor-CqWdlgKa.js","assets/zustand-vendor-BohoUguQ.js","assets/react-vendor-DRPWudcR.js","assets/index-g2Iar00F.js","assets/supabase-vendor-DWEVVlJw.js","assets/index-BuLTOePZ.css","assets/link-2-CBhsYMIt.js","assets/copy-h2JdlwCb.js","assets/trash-2-BDmyaqdf.js","assets/briefcase-D9q5pFcT.js","assets/activity-B4S4uuem.js","assets/ellipsis-BXGtEPtg.js","assets/star-64zWe-bS.js","assets/search-DWH6CPM6.js","assets/chevron-down-BXhPJRBU.js","assets/funnel-HqLKkiDs.js","assets/list-Csd3VtbD.js","assets/message-square-Dl4ZrkmU.js"])))=>i.map(i=>d[i]);
import{o as e,u as t,g as r,b as n,E as a,_ as s}from"./index-g2Iar00F.js";import{j as l}from"./pdf-vendor-CqWdlgKa.js";import{r as o}from"./zustand-vendor-BohoUguQ.js";import{L as i}from"./list-Csd3VtbD.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const c=e("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),d=o.lazy(()=>s(()=>import("./TaskBoardPage-GMSCTpTp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),m=108e5,p=[{id:"upcoming_deals",label:"Upcoming Deals",icon:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",color:"text-green-400 bg-green-500/10 border-green-500/30"},{id:"client_tasks",label:"Client Tasks",icon:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4",color:"text-blue-400 bg-blue-500/10 border-blue-500/30"},{id:"research",label:"Research",icon:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",color:"text-purple-400 bg-purple-500/10 border-purple-500/30"},{id:"client_comms",label:"Client Comms",icon:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",color:"text-orange-400 bg-orange-500/10 border-orange-500/30"}];function u(){const e=t(e=>e.clients)||[],s=t(e=>e.quotes)||[],u=t(e=>e.updateClient),x=t(e=>e.addClient),h=r(e=>e.opportunities)||[],b=r(e=>e.updateOpportunity),y=r(e=>e.addOpportunity),{addActivityLog:f}=n(),C=n(e=>e.settings),j=C?.okrs||[],[w,v]=o.useState(()=>{const e=localStorage.getItem("tell_commercial_tasks_v2");return e?JSON.parse(e):[]}),[k,N]=o.useState(()=>{const e=localStorage.getItem("tell_manual_tasks");return e?JSON.parse(e):[]}),[S,I]=o.useState(!1),[_,O]=o.useState(null),[L,D]=o.useState(()=>{const e=localStorage.getItem("tell_commercial_tasks_time");return e?new Date(e):null}),[M,T]=o.useState(()=>{const e=localStorage.getItem("tell_completed_tasks_v2");return e?JSON.parse(e):[]}),[A,E]=o.useState(null),[R,$]=o.useState(!1),[P,B]=o.useState({title:"",description:"",category:"client_tasks",priority:"medium",okrId:""}),[F,z]=o.useState("all"),[J,W]=o.useState("all"),[H,U]=o.useState(()=>localStorage.getItem("tell_tasks_view_mode")||"list");o.useEffect(()=>{localStorage.setItem("tell_tasks_view_mode",H)},[H]);const[V,Y]=o.useState(!1),[q,G]=o.useState(null),[K,Q]=o.useState({note:"",clientId:"",opportunityId:"",createOpportunity:!1,newOppTitle:"",createClient:!1,newClientCompany:"",newClientContact:"",newClientRole:"",newClientCountry:"",newClientEmail:""}),X=o.useRef(null),Z=o.useRef(!1),ee=o.useRef(!1);o.useEffect(()=>{localStorage.setItem("tell_commercial_tasks_v2",JSON.stringify(w))},[w]),o.useEffect(()=>{localStorage.setItem("tell_manual_tasks",JSON.stringify(k))},[k]),o.useEffect(()=>{localStorage.setItem("tell_completed_tasks_v2",JSON.stringify(M))},[M]),o.useEffect(()=>{L&&localStorage.setItem("tell_commercial_tasks_time",L.toISOString())},[L]);const te=o.useCallback(async(t=!1)=>{if(!ee.current){if(ee.current=!0,!t){const e=localStorage.getItem("tell_commercial_tasks_time"),t=localStorage.getItem("tell_commercial_tasks_v2");if(e&&t){const r=Date.now()-new Date(e).getTime(),n=JSON.parse(t).length>0;if(r<m&&n)return void(ee.current=!1)}}I(!0),O(null);try{const t=e=>e?Math.floor((Date.now()-new Date(e))/864e5):null,r={summary:{totalClients:e.length,totalQuotes:s.length,totalOpportunities:h.length,activeOpportunities:h.filter(e=>"active"===e.status).length,totalPipelineValue:h.filter(e=>"active"===e.status).reduce((e,t)=>e+(t.value||0),0)},opportunities:h.filter(e=>"active"===e.status).map(e=>({id:e.id,title:e.title,client:e.client?.company,clientContact:e.client?.contact,country:e.country,region:e.region,value:e.value,currency:e.currency||"USD",probability:e.probability,competitors:e.competitors,brief:e.brief?.substring(0,200),notes:e.notes?.substring(0,300),nextAction:e.nextAction,nextActionDate:e.nextActionDate,expectedCloseDate:e.expectedCloseDate,contacts:e.contacts?.map(e=>({name:e.name,role:e.role})),daysSinceUpdate:t(e.updatedAt),isOverdue:e.nextActionDate&&new Date(e.nextActionDate)<new Date,isStale:t(e.updatedAt)>14})),clients:e.map(e=>{const r=h.filter(t=>t.client?.company===e.company),n=s.filter(t=>t.client?.company===e.company);return{id:e.id,company:e.company,contact:e.contact,email:e.email,region:e.region,notes:e.notes?.substring(0,200),contacts:e.contacts?.slice(0,3).map(e=>({name:e.name,role:e.role})),activeOpportunities:r.filter(e=>"active"===e.status).length,totalQuotes:n.length,wonQuotes:n.filter(e=>"won"===e.status).length,daysSinceLastContact:t(e.updatedAt)}}),recentQuotes:s.filter(e=>"sent"===e.status).slice(0,10).map(e=>({number:e.quoteNumber,client:e.client?.company,project:e.project?.title,status:e.status,total:e.totals?.grandTotal,daysSinceSent:t(e.quoteDate)}))},n=C?.company||{},l=`You are a commercial task generator for ${n.name||"the company"} - a production company.\n\nCOMPANY INFO:\n- Name: ${n.name||"Your Company"}\n- Based in: ${n.country||"Malaysia"}\n- Website: ${n.website||""}\n\nTODAY'S DATE: ${(new Date).toLocaleDateString("en-GB")} (${(new Date).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})\nIMPORTANT: Only suggest CURRENT or FUTURE opportunities. Do not reference past events or old dates.\n\nFOCUS REGIONS: Only use regions that appear in the opportunities data below. Do not suggest regions we don't already operate in.\n\nSPORTS FOCUS: Football (soccer), futsal, cycling ONLY. Primarily football. No other sports.\n\nDATA:\n${JSON.stringify(r,null,1)}\n\nRULES:\n- ONLY use regions/countries that appear in our opportunities data\n- Reference specific clients, opportunities, quotes from the data\n- For research tasks: suggest SPECIFIC organizations/contacts (broadcasters, football federations, production companies)\n- Include contact suggestions with roles where possible\n- Football/futsal/cycling opportunities ONLY - no other sports\n\nCATEGORIES & TASKS:\n\nUPCOMING_DEALS - Close existing pipeline:\n- "Follow up Quote #[X] to [Client] - sent [X] days ago"\n- "Chase [Opportunity] at [Client] - closing [date]"\n\nCLIENT_TASKS - Manage existing clients:\n- "Review stale opportunity at [Client] - [X] days no update"\n- "Update contact info for [Client]"\n\nRESEARCH - New business development:\n- "Research [specific broadcaster/org] in [country] - potential for [type] coverage"\n- "Find Head of Production at [specific company] in [region]"\n- "Identify football rights holders in [SEA country]"\n- For NEW contacts: include "newClient": true and suggest company/contact details\n\nCLIENT_COMMS - Relationship building:\n- "Check in with [Contact] at [Client] - [X] days since contact"\n- "Introduce [service] to [Client]"\n\nGenerate 8-12 tasks. For research/new business, suggest SPECIFIC companies and contacts in our focus regions.\n\nReturn ONLY JSON:\n[{"id":"unique","category":"upcoming_deals|client_tasks|research|client_comms","priority":"high|medium|low","title":"Specific action","description":"Context and why","client":"Client/Company name","clientId":"ID if existing client","opportunityId":"ID if relevant","contact":"Person NAME only - no job titles/roles","newClient":true/false,"suggestedCompany":"For new prospects","suggestedContact":"Person name only","suggestedRole":"Their job title separately","suggestedCountry":"Country"}]`,{data:{session:o}}=await a.auth.getSession();if(!o)throw new Error("Please log in to generate tasks");const i=await fetch("https://deitlnfumugxcbxqqivk.supabase.co/functions/v1/generate-commercial-tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({prompt:l})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||`API error: ${i.status}`)}const c=await i.json(),d=c.content.match(/\[[\s\S]*\]/);if(!d)throw new Error("Could not parse tasks from AI response");{const e=JSON.parse(d[0]);v(e),D(new Date)}}catch(r){O(r.message)}finally{I(!1),ee.current=!1}}},[e,s,h]);o.useEffect(()=>{if(L){const e=new Date(new Date(L).getTime()+m);E(e)}},[L]),o.useEffect(()=>{if(Z.current)return;if(0===e.length&&0===s.length&&0===h.length)return;Z.current=!0;const t=localStorage.getItem("tell_commercial_tasks_v2"),r=localStorage.getItem("tell_commercial_tasks_time"),n=t&&JSON.parse(t).length>0,a=r?new Date(r):null,l=a?Date.now()-a.getTime():1/0;return(!n||l>=m)&&te(!0),X.current=setInterval(()=>{te(!0)},m),()=>{X.current&&clearInterval(X.current)}},[e.length,s.length,h.length]);const re=t=>{G(t);const r=`[${t.category.toUpperCase()}] ${t.title}\n\nOutcome: `,n=e.find(e=>e.company?.toLowerCase()===t.client?.toLowerCase()||e.id===t.clientId),a=h.find(e=>e.id===t.opportunityId||t.client&&e.client?.company?.toLowerCase()===t.client?.toLowerCase()),s=t.newClient||"research"===t.category&&!n;Q({note:r,clientId:n?.id||"",opportunityId:a?.id||"",createOpportunity:!1,newOppTitle:"",createClient:s,newClientCompany:t.suggestedCompany||t.client||"",newClientContact:t.suggestedContact||t.contact||"",newClientRole:t.suggestedRole||"",newClientCountry:t.suggestedCountry||"",newClientEmail:""}),Y(!0)},ne=(e,t=!1)=>{t?N(t=>t.filter(t=>t.id!==e)):T(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},ae=(e,t=!1)=>{t?N(t=>t.filter(t=>t.id!==e)):(v(t=>t.filter(t=>t.id!==e)),T(t=>t.filter(t=>t!==e)))},se=e=>{switch(e){case"high":return"text-red-400 bg-red-500/10 border-red-500/30";case"medium":return"text-yellow-400 bg-yellow-500/10 border-yellow-500/30";case"low":return"text-green-400 bg-green-500/10 border-green-500/30";default:return"text-gray-400 bg-gray-500/10 border-gray-500/30"}},le=K.clientId?h.filter(t=>{const r=e.find(e=>e.id===K.clientId);return r&&t.client?.company===r.company}):[],oe=[...k,...w.filter(e=>!M.includes(e.id))],ie=oe.filter(e=>{const t="all"===F||e.category===F,r="all"===J||e.okrId===J;return t&&r}),ce=p.reduce((e,t)=>(e[t.id]=ie.filter(e=>e.category===t.id),e),{}),de=w.filter(e=>M.includes(e.id));return l.jsx("div",{className:"min-h-screen bg-dark-bg",children:l.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:"Commercial Tasks"}),l.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Actions from your pipeline, clients & opportunities"})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[L&&l.jsxs("div",{className:"text-right hidden sm:block",children:[l.jsxs("span",{className:"text-xs text-gray-500 block",children:["Last scan: ",L.toLocaleTimeString()]}),A&&l.jsxs("span",{className:"text-[10px] text-gray-600",children:["Next: ",A.toLocaleTimeString()]})]}),l.jsxs("button",{onClick:()=>$(!0),className:"btn-ghost flex items-center gap-2",children:[l.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),l.jsx("span",{className:"hidden sm:inline",children:"Add Task"})]}),"list"===H&&l.jsx("button",{onClick:()=>te(!0),disabled:S,className:"btn-primary flex items-center gap-2",children:S?l.jsxs(l.Fragment,{children:[l.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[l.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),l.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l.jsx("span",{className:"hidden sm:inline",children:"Scanning..."})]}):l.jsxs(l.Fragment,{children:[l.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})}),l.jsxs("div",{className:"flex items-center bg-gray-800 rounded-lg p-1",children:[l.jsx("button",{onClick:()=>U("list"),className:"p-2 rounded-md transition-colors "+("list"===H?"bg-accent-primary text-white":"text-gray-400 hover:text-white"),title:"List View",children:l.jsx(i,{className:"w-4 h-4"})}),l.jsx("button",{onClick:()=>U("board"),className:"p-2 rounded-md transition-colors "+("board"===H?"bg-accent-primary text-white":"text-gray-400 hover:text-white"),title:"Board View",children:l.jsx(c,{className:"w-4 h-4"})})]})]})]}),"board"===H?l.jsx(o.Suspense,{fallback:l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}),children:l.jsx(d,{embedded:!0})}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-2",children:[l.jsxs("button",{onClick:()=>z("all"),className:"px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors "+("all"===F?"bg-accent-primary/20 text-accent-primary border border-accent-primary/30":"bg-gray-800 text-gray-400 hover:text-gray-200 border border-transparent"),children:["All (",oe.length,")"]}),p.map(e=>{const t=oe.filter(t=>t.category===e.id).length;return l.jsxs("button",{onClick:()=>z(e.id),className:"px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors flex items-center gap-2 "+(F===e.id?`${e.color}`:"bg-gray-800 text-gray-400 hover:text-gray-200 border border-transparent"),children:[l.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:e.icon})}),e.label," (",t,")"]},e.id)})]}),j.length>0&&l.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[l.jsx("span",{className:"text-xs text-gray-500 py-2 px-2",children:"OKR:"}),l.jsx("button",{onClick:()=>W("all"),className:"px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors "+("all"===J?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"bg-gray-800/50 text-gray-500 hover:text-gray-300 border border-transparent"),children:"All"}),j.map((e,t)=>{const r=oe.filter(t=>t.okrId===e.id).length;return l.jsxs("button",{onClick:()=>W(e.id),className:"px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors "+(J===e.id?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"bg-gray-800/50 text-gray-500 hover:text-gray-300 border border-transparent"),title:e.keyResult,children:["OKR",t+1,": ",e.objective.substring(0,20),e.objective.length>20?"...":""," (",r,")"]},e.id)})]}),R&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-md",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Add Task"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),l.jsx("input",{type:"text",value:P.title,onChange:e=>B({...P,title:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",placeholder:"Task title..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),l.jsx("textarea",{value:P.description,onChange:e=>B({...P,description:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white h-20",placeholder:"Details..."})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category"}),l.jsx("select",{value:P.category,onChange:e=>B({...P,category:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:p.map(e=>l.jsx("option",{value:e.id,children:e.label},e.id))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Priority"}),l.jsxs("select",{value:P.priority,onChange:e=>B({...P,priority:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:[l.jsx("option",{value:"high",children:"High"}),l.jsx("option",{value:"medium",children:"Medium"}),l.jsx("option",{value:"low",children:"Low"})]})]})]}),j.length>0&&l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Link to OKR (optional)"}),l.jsxs("select",{value:P.okrId,onChange:e=>B({...P,okrId:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:[l.jsx("option",{value:"",children:"No OKR"}),j.map(e=>l.jsx("option",{value:e.id,children:e.objective},e.id))]})]})]}),l.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[l.jsx("button",{onClick:()=>$(!1),className:"btn-ghost",children:"Cancel"}),l.jsx("button",{onClick:()=>{if(!P.title.trim())return;const e={...P,id:`manual_${Date.now()}`,isManual:!0,createdAt:(new Date).toISOString()};N(t=>[e,...t]),B({title:"",description:"",category:"client_tasks",priority:"medium",okrId:""}),$(!1)},className:"btn-primary",children:"Add Task"})]})]})}),V&&q&&l.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-lg shadow-2xl",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Complete & Log"}),l.jsx("p",{className:"text-sm text-gray-400 mb-4",children:q.title}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"What happened?"}),l.jsx("textarea",{value:K.note,onChange:e=>Q({...K,note:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white h-24",placeholder:"Outcome of this task..."})]}),l.jsx("div",{className:"flex items-center gap-3 p-3 bg-dark-bg rounded-lg border border-dark-border",children:l.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer flex-1",children:[l.jsx("input",{type:"checkbox",checked:K.createClient,onChange:e=>Q({...K,createClient:e.target.checked,clientId:""}),className:"rounded border-gray-600"}),"Create new client/contact"]})}),K.createClient?l.jsxs("div",{className:"space-y-3 p-3 bg-green-500/5 border border-green-500/20 rounded-lg",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Company Name *"}),l.jsx("input",{type:"text",value:K.newClientCompany,onChange:e=>Q({...K,newClientCompany:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm",placeholder:"Company name..."})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Contact Name"}),l.jsx("input",{type:"text",value:K.newClientContact,onChange:e=>Q({...K,newClientContact:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm",placeholder:"Contact name..."})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Role/Title"}),l.jsx("input",{type:"text",value:K.newClientRole,onChange:e=>Q({...K,newClientRole:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm",placeholder:"Job title..."})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Country/Region"}),l.jsx("input",{type:"text",value:K.newClientCountry,onChange:e=>Q({...K,newClientCountry:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm",placeholder:"e.g. Malaysia"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Email"}),l.jsx("input",{type:"email",value:K.newClientEmail,onChange:e=>Q({...K,newClientEmail:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm",placeholder:"email@company.com"})]})]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Log to Client"}),l.jsxs("select",{value:K.clientId,onChange:e=>Q({...K,clientId:e.target.value,opportunityId:""}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:[l.jsx("option",{value:"",children:"Select client..."}),e.map(e=>l.jsx("option",{value:e.id,children:e.company},e.id))]})]}),K.clientId&&le.length>0&&l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Log to Opportunity (optional)"}),l.jsxs("select",{value:K.opportunityId,onChange:e=>Q({...K,opportunityId:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:[l.jsx("option",{value:"",children:"Just log to client"}),le.map(e=>l.jsx("option",{value:e.id,children:e.title},e.id))]})]})]}),(K.clientId||K.createClient)&&l.jsxs("div",{className:"border-t border-dark-border pt-4",children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:K.createOpportunity,onChange:e=>Q({...K,createOpportunity:e.target.checked}),className:"rounded border-gray-600"}),"Also create opportunity from this"]}),K.createOpportunity&&l.jsx("input",{type:"text",value:K.newOppTitle,onChange:e=>Q({...K,newOppTitle:e.target.value}),className:"w-full mt-2 px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",placeholder:"New opportunity title..."})]})]}),l.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[l.jsx("button",{onClick:()=>Y(!1),className:"btn-ghost",children:"Cancel"}),l.jsx("button",{onClick:async()=>{if(!q)return;const t=(new Date).toISOString(),r=(new Date).toLocaleDateString("en-GB");let n=null;if(K.createClient&&K.newClientCompany){const e={company:K.newClientCompany,contact:K.newClientContact||"",email:K.newClientEmail||"",region:K.newClientCountry||"",notes:`--- ${r} ---\nCreated from Commercial Task: ${q.title}\n\n${K.note}`,contacts:K.newClientContact?[{name:K.newClientContact,role:K.newClientRole||"",email:K.newClientEmail||""}]:[]},t=await x(e);n=t?.id}const a=n||K.clientId;if(K.opportunityId){const e=h.find(e=>e.id===K.opportunityId);if(e){const n=e.notes||"",a=`\n\n--- ${r} ---\n${K.note}`;await b(K.opportunityId,{notes:n+a,updatedAt:t})}}else if(a&&!K.createClient){const n=e.find(e=>e.id===a);if(n){const e=n.notes||"",s=`\n\n--- ${r} ---\n${K.note}`;await u(a,{notes:e+s,updatedAt:t})}}if(K.createOpportunity&&K.newOppTitle&&a){const t=K.createClient?{company:K.newClientCompany,contact:K.newClientContact,email:K.newClientEmail}:e.find(e=>e.id===a);t&&await y({title:K.newOppTitle,client:{company:t.company||K.newClientCompany,contact:t.contact||K.newClientContact,email:t.email||K.newClientEmail},status:"active",probability:25,source:"Commercial Tasks",notes:`Created from task: ${q.title}\n\n${K.note}`,region:t.region||K.newClientCountry,country:K.newClientCountry})}f&&f({action:K.createClient?"client_created":"task_completed",category:"commercial_task",description:K.createClient?`Created client: ${K.newClientCompany}`:`Completed: ${q.title}`,details:K.note,clientId:a,opportunityId:K.opportunityId}),q.isManual?N(e=>e.filter(e=>e.id!==q.id)):T(e=>[...e,q.id]),Y(!1),G(null)},className:"btn-primary",disabled:!K.note.trim()||K.createClient&&!K.newClientCompany.trim(),children:K.createClient?"Create Client & Complete":"Complete & Log"})]})]})}),_&&l.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6",children:l.jsx("p",{className:"text-red-400 text-sm",children:_})}),!S&&0===ie.length&&!_&&l.jsxs("div",{className:"text-center py-16",children:[l.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-800 flex items-center justify-center",children:l.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),l.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:"No tasks yet"}),l.jsx("p",{className:"text-gray-500 text-sm mb-6",children:'Click "Refresh" to scan for tasks or add one manually'})]}),"all"===F?p.map(e=>{const t=ce[e.id];return 0===t.length?null:l.jsxs("div",{className:"mb-8",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${e.color}`,children:l.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:e.icon})})}),l.jsxs("h2",{className:"text-sm font-semibold text-gray-300 uppercase tracking-wider",children:[e.label," (",t.length,")"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:t.map(e=>l.jsx(g,{task:e,onToggle:()=>ne(e.id,e.isManual),onLog:()=>re(e),onDelete:()=>ae(e.id,e.isManual),getPriorityColor:se},e.id))})]},e.id)}):l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:ie.map(e=>l.jsx(g,{task:e,onToggle:()=>ne(e.id,e.isManual),onLog:()=>re(e),onDelete:()=>ae(e.id,e.isManual),getPriorityColor:se},e.id))}),de.length>0&&l.jsxs("div",{className:"mt-8 pt-8 border-t border-dark-border",children:[l.jsxs("h2",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider mb-4",children:["Completed (",de.length,")"]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-2",children:de.map(e=>l.jsx("div",{className:"bg-dark-card/50 border border-dark-border/50 rounded-lg p-3 opacity-60",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>ne(e.id),className:"w-5 h-5 rounded border-2 border-green-600 bg-green-600 flex items-center justify-center flex-shrink-0",children:l.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),l.jsx("span",{className:"text-gray-400 line-through text-sm",children:e.title})]})},e.id))})]})]})]})})}function g({task:e,onToggle:t,onLog:r,onDelete:n,getPriorityColor:a}){return l.jsxs("div",{className:`card bg-gradient-to-br ${(e=>{switch(e){case"upcoming_deals":return"from-green-900/20 to-green-950/10 border-green-800/30 hover:border-green-700/50";case"client_tasks":return"from-blue-900/20 to-blue-950/10 border-blue-800/30 hover:border-blue-700/50";case"research":return"from-purple-900/20 to-purple-950/10 border-purple-800/30 hover:border-purple-700/50";case"client_comms":return"from-orange-900/20 to-orange-950/10 border-orange-800/30 hover:border-orange-700/50";default:return"from-gray-900/20 to-gray-950/10 border-gray-800/30 hover:border-gray-700/50"}})(e.category)} p-4 hover:shadow-lg transition-all group relative`,children:[l.jsx("div",{className:"absolute top-3 right-3 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:l.jsx("button",{onClick:n,className:"p-2 min-w-[32px] min-h-[32px] text-gray-500 hover:text-red-400 bg-dark-card/80 rounded-lg shadow-sm border border-dark-border flex items-center justify-center",title:"Delete task",children:l.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),l.jsxs("div",{className:"flex items-start gap-3 pr-8",children:[l.jsx("button",{onClick:t,className:"mt-0.5 w-5 h-5 rounded border-2 border-gray-600 hover:border-accent-primary flex items-center justify-center flex-shrink-0 transition-colors"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[l.jsx("span",{className:`text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded font-medium ${a(e.priority)}`,children:e.priority}),e.isManual&&l.jsx("span",{className:"text-[9px] text-gray-500 bg-gray-800/50 px-1.5 py-0.5 rounded font-medium",children:"Manual"})]}),l.jsx("h3",{className:"font-medium text-gray-100 text-sm leading-snug mb-1",children:e.title}),e.description&&l.jsx("p",{className:"text-xs text-gray-400 mb-2 line-clamp-2",children:e.description}),l.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-gray-500",children:[e.client&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.client]}),e.contact&&l.jsxs("span",{className:"flex items-center gap-1 text-accent-primary/80",children:[l.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.contact]})]}),l.jsxs("button",{onClick:r,className:"mt-3 text-[11px] text-accent-primary hover:text-accent-primary/80 flex items-center gap-1.5 transition-colors font-medium",children:[l.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete & Log"]})]})]})]})}export{u as default};
