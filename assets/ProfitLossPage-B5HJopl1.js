import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{am as s,ay as r,aA as a,aC as n,u as l,f as i}from"./index-g2Iar00F.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";function o({label:t,value:s,isPositive:r,color:a,icon:n,subValue:l}){return e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:t}),e.jsx("div",{className:`text-2xl font-bold ${a}`,children:s}),l&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l})]}),e.jsx("div",{className:`p-3 rounded-lg ${a.replace("text-","bg-").replace("400","500/10")}`,children:n})]})})}function d({project:t,invoices:s,expenses:r,crewBookings:a,clients:n,onSelect:l}){const o=n.find(e=>e.id===t.clientId),d=s.filter(e=>e.projectId===t.id),c=d.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.total||0),0),x=d.filter(e=>"sent"===e.status).reduce((e,t)=>e+(t.total||0),0),m=r.filter(e=>e.projectId===t.id),h=m.reduce((e,t)=>e+(t.amount||0),0),u=a.filter(e=>e.projectId===t.id&&"cancelled"!==e.status),g=u.reduce((e,t)=>e+(t.totalCost||0),0),p=c-(h+g),j=c>0?p/c*100:0,v=p>=0;return e.jsxs("tr",{className:"border-b border-dark-border hover:bg-dark-card/50 cursor-pointer transition-colors",onClick:()=>l(t.id),children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-200",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:o?.company||t.clientName||"Unknown"})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("completed"===t.status?"bg-green-500/10 text-green-400":"in-progress"===t.status?"bg-blue-500/10 text-blue-400":"on-hold"===t.status?"bg-yellow-500/10 text-yellow-400":"bg-gray-500/10 text-gray-400"),children:t.status||"Planning"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"text-green-400 font-medium",children:i(c,"USD")}),x>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",i(x,"USD")," pending"]})]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"text-orange-400",children:i(g,"USD")}),e.jsxs("div",{className:"text-xs text-gray-500",children:[u.length," bookings"]})]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"text-red-400",children:i(h,"USD")}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m.length," expenses"]})]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsxs("div",{className:"font-semibold "+(v?"text-green-400":"text-red-400"),children:[v?"+":"",i(p,"USD")]}),c>0&&e.jsxs("div",{className:"text-xs "+(v?"text-green-500":"text-red-500"),children:[j.toFixed(1),"% margin"]})]})]})}function c({expenses:s,crewBookings:r}){const a=t.useMemo(()=>{const e={},t=r.filter(e=>"cancelled"!==e.status).reduce((e,t)=>e+(t.totalCost||0),0);return t>0&&(e.Crew=t),s.forEach(t=>{e[t.category]||(e[t.category]=0),e[t.category]+=t.amount||0}),Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,10)},[s,r]),n=a.reduce((e,[,t])=>e+t,0);return 0===a.length?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No costs to show"}):e.jsx("div",{className:"space-y-3",children:a.map(([t,s])=>{const r=n>0?s/n*100:0,a="Crew"===t;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"flex items-center gap-2 "+(a?"text-orange-300":"text-gray-300"),children:[a&&e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})}),t]}),e.jsx("span",{className:"text-gray-400",children:i(s,"USD")})]}),e.jsx("div",{className:"h-2 bg-dark-bg rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full "+(a?"bg-gradient-to-r from-orange-500 to-yellow-500":"bg-gradient-to-r from-red-500 to-orange-500"),style:{width:`${r}%`}})})]},t)})})}function x({invoices:s,expenses:r,crewBookings:a}){const n=t.useMemo(()=>{const e=[],t=new Date;for(let n=5;n>=0;n--){const l=new Date(t.getFullYear(),t.getMonth()-n,1),i=new Date(l.getFullYear(),l.getMonth(),1),o=new Date(l.getFullYear(),l.getMonth()+1,0),d=s.filter(e=>{if("paid"!==e.status||!e.paidDate)return!1;const t=new Date(e.paidDate);return t>=i&&t<=o}).reduce((e,t)=>e+(t.total||0),0),c=r.filter(e=>{if(!e.date)return!1;const t=new Date(e.date);return t>=i&&t<=o}).reduce((e,t)=>e+(t.amount||0),0),x=a.filter(e=>{if("cancelled"===e.status||!e.startDate)return!1;const t=new Date(e.startDate);return t>=i&&t<=o}).reduce((e,t)=>e+(t.totalCost||0),0),m=c+x;e.push({month:l.toLocaleDateString("en-GB",{month:"short"}),revenue:d,expenses:c,crewCosts:x,totalCosts:m,profit:d-m})}return e},[s,r,a]),l=Math.max(...n.map(e=>Math.max(e.revenue,e.totalCosts)),1);return e.jsx("div",{className:"flex items-end justify-between gap-2 h-32",children:n.map((t,s)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"w-full flex gap-0.5 items-end h-24",children:[e.jsx("div",{className:"flex-1 bg-green-500/30 rounded-t",style:{height:t.revenue/l*100+"%"},title:`Revenue: ${i(t.revenue,"USD")}`}),e.jsx("div",{className:"flex-1 bg-orange-500/30 rounded-t",style:{height:t.crewCosts/l*100+"%"},title:`Crew: ${i(t.crewCosts,"USD")}`}),e.jsx("div",{className:"flex-1 bg-red-500/30 rounded-t",style:{height:t.expenses/l*100+"%"},title:`Expenses: ${i(t.expenses,"USD")}`})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.month})]},s))})}function m({onSelectProject:m}){const{projects:h,initialize:u}=s(),{invoices:g,initialize:p}=r(),{expenses:j,initialize:v}=a(),{bookings:f,initialize:b}=n(),{clients:N}=l(),[y,k]=t.useState("all"),[w,C]=t.useState(!1);t.useEffect(()=>{u(),p(),v(),b()},[u,p,v,b]);const M=t.useMemo(()=>{const e=g.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.total||0),0),t=g.filter(e=>"sent"===e.status).reduce((e,t)=>e+(t.total||0),0),s=j.reduce((e,t)=>e+(t.amount||0),0),r=f.filter(e=>"cancelled"!==e.status).reduce((e,t)=>e+(t.totalCost||0),0),a=s+r,n=e-a;return{totalRevenue:e,pendingRevenue:t,totalExpenses:s,totalCrewCosts:r,totalCosts:a,profit:n,margin:e>0?n/e*100:0}},[g,j,f]),D=t.useMemo(()=>{let e=h;return w&&(e=e.filter(e=>"in-progress"===e.status||"planning"===e.status)),e},[h,w]);return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"Profit & Loss"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Financial overview by project"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:e=>C(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bg text-accent-primary"}),"Active only"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(o,{label:"Revenue",value:i(M.totalRevenue,"USD",0),subValue:M.pendingRevenue>0?`+${i(M.pendingRevenue,"USD",0)} pending`:null,color:"text-green-400",icon:e.jsx("svg",{className:"w-6 h-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx(o,{label:"Crew Costs",value:i(M.totalCrewCosts,"USD",0),subValue:`${f.filter(e=>"cancelled"!==e.status).length} bookings`,color:"text-orange-400",icon:e.jsx("svg",{className:"w-6 h-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})})}),e.jsx(o,{label:"Expenses",value:i(M.totalExpenses,"USD",0),subValue:`${j.length} items`,color:"text-red-400",icon:e.jsx("svg",{className:"w-6 h-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx(o,{label:"Net Profit",value:`${M.profit>=0?"+":""}${i(M.profit,"USD",0)}`,subValue:M.totalRevenue>0?`${M.margin.toFixed(1)}% margin`:null,color:M.profit>=0?"text-green-400":"text-red-400",icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:M.profit>=0?"#4ade80":"#f87171",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),e.jsx(o,{label:"Projects",value:h.filter(e=>"in-progress"===e.status).length,subValue:`${h.length} total`,color:"text-blue-400",icon:e.jsx("svg",{className:"w-6 h-6 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-dark-card border border-dark-border rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-200 mb-4",children:"6-Month Trend"}),e.jsx(x,{invoices:g,expenses:j,crewBookings:f}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500/50 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Revenue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500/50 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Crew"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500/50 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Expenses"})]})]})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-200 mb-4",children:"Cost Breakdown"}),e.jsx(c,{expenses:j,crewBookings:f})]})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-dark-border",children:e.jsx("h3",{className:"text-lg font-medium text-gray-200",children:"P&L by Project"})}),0===D.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-600 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("div",{className:"text-gray-400 mb-2",children:"No projects yet"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Create projects to track P&L"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-bg/50 border-b border-dark-border",children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Project"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Status"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Revenue"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Crew"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Expenses"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Profit"})]})}),e.jsx("tbody",{children:D.map(t=>e.jsx(d,{project:t,invoices:g,expenses:j,crewBookings:f,clients:N,onSelect:m},t.id))}),e.jsx("tfoot",{className:"bg-dark-bg/30 border-t border-dark-border",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-sm font-medium text-gray-300",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-right text-green-400 font-semibold",children:i(M.totalRevenue,"USD")}),e.jsx("td",{className:"px-4 py-3 text-right text-orange-400 font-semibold",children:i(M.totalCrewCosts,"USD")}),e.jsx("td",{className:"px-4 py-3 text-right text-red-400 font-semibold",children:i(M.totalExpenses,"USD")}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold "+(M.profit>=0?"text-green-400":"text-red-400"),children:[M.profit>=0?"+":"",i(M.profit,"USD")]})]})})]})]})]})}export{m as default};
