import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{u as s,a,b as r,e as n,c as l,d as i,R as o,f as c}from"./index-DKsXopg7.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const d=[{id:"draft",label:"Drafts",color:"#9CA3AF",bgColor:"bg-gray-400/10"},{id:"sent",label:"Sent",color:"#0F8B8D",bgColor:"bg-[#0F8B8D]/10"},{id:"won",label:"Won",color:"#22c55e",bgColor:"bg-green-500/10"},{id:"dead",label:"Dead",color:"#F87171",bgColor:"bg-red-400/10"}],x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function m(e,t){if(!e)return null;const s=new Date(e);return s.setDate(s.getDate()+(parseInt(t)||30)),s}function u({onViewQuote:u,onNewQuote:p,onGoToOpportunities:h}){const{savedQuotes:g,clients:j,updateQuoteStatus:b}=s(),{rates:v,ratesUpdated:f,refreshRates:N,ratesLoading:w}=a(),{settings:y,setDashboardPreferences:D}=r(),{opportunities:k}=n(),[C,M]=t.useState("all"),[S,A]=t.useState((new Date).getFullYear()),[L,U]=t.useState(null),[F,E]=t.useState(null),R=y.dashboardPreferences||{},q=R.currency||"USD",B=R.collapsedColumns||{},W=R.pipelineMinimized||!1,[I,P]=t.useState({open:!1,quoteId:null,newStatus:null}),[Q,V]=t.useState(""),[H,O]=t.useState(""),T=e=>{(e=>{const t="function"==typeof e?e(B):e;D({collapsedColumns:t})})(t=>({...t,[e]:!t[e]}))},Y=y?.users?.[0]?.name||"User",z=t.useMemo(()=>{const e=new Set;return g.forEach(t=>{const s=new Date(t.savedAt||t.createdAt);e.add(s.getFullYear())}),Array.from(e).sort((e,t)=>t-e)},[g]),G=t.useMemo(()=>g.filter(e=>{if(!e)return!1;const t=new Date(e.savedAt||e.createdAt),s=t.getFullYear()===S,a="all"===C||t.getMonth()===parseInt(C);return s&&a}).sort((e,t)=>{const s=new Date(e?.updatedAt||e?.savedAt||e?.createdAt||0);return new Date(t?.updatedAt||t?.savedAt||t?.createdAt||0)-s}),[g,C,S]),$=t.useMemo(()=>{const e={};return d.forEach(t=>{e[t.id]=G.filter(e=>(e?.status||"draft")===t.id)}),e},[G]),_=t.useMemo(()=>{const e={};return d.forEach(t=>{e[t.id]=$[t.id].reduce((e,t)=>{const s=l(t?.sections||{},t?.fees||{});return e+i(s.totalCharge,t.currency||"USD",q,v)},0)}),e},[$,v,q]),J=t.useMemo(()=>{let e=0,t=0,s=0,a=0,r=0,n=0,o=0,c=0;return G.forEach(d=>{const x=l(d.sections||{},d.fees||{}),m=i(x.totalCharge,d.currency||"USD",q,v),u=i(x.totalCost,d.currency||"USD",q,v);"won"===d.status?(e+=m,t+=m-u,s+=x.margin,a++):"draft"!==d.status&&"sent"!==d.status||(r+=m,n+=m-u,o+=x.margin,c++)}),k.filter(e=>"active"===e.status).forEach(e=>{const t=i(e.value||0,e.currency||"USD",q,v)*((e.probability||0)/100);r+=t,c++}),{won:{revenue:e,profit:t,avgMargin:a>0?s/a:0},pipeline:{revenue:r,profit:n,avgMargin:c>0?o/c:0}}},[G,k,v,q]),K=t.useMemo(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()+3,e.getDate()),s=new Date(e.getFullYear(),e.getMonth()+6,e.getDate());let a={revenue:0,profit:0},r={revenue:0,profit:0},n={revenue:0,profit:0},o={revenue:0,profit:0},c={revenue:0,weighted:0},d={revenue:0,weighted:0};return g.forEach(c=>{if("dead"===c.status)return;const d=c.project?.startDate?new Date(c.project.startDate):null;if(!d||d<e)return;const x=l(c.sections||{},c.fees||{}),m=i(x.totalCharge,c.currency||"USD",q,v),u=m-i(x.totalCost,c.currency||"USD",q,v),p="won"===c.status||"approved"===c.status;d<=t&&(p?(a.revenue+=m,a.profit+=u):(r.revenue+=m,r.profit+=u)),d<=s&&(p?(n.revenue+=m,n.profit+=u):(o.revenue+=m,o.profit+=u))}),k.filter(e=>"active"===e.status).forEach(a=>{const r=a.expectedCloseDate?new Date(a.expectedCloseDate):null;if(!r||r<e)return;const n=i(a.value||0,a.currency||"USD",q,v),l=n*((a.probability||0)/100);r<=t&&(c.revenue+=n,c.weighted+=l),r<=s&&(d.revenue+=n,d.weighted+=l)}),{threeMonth:{won:a,pipeline:r,opportunities:c,total:{revenue:a.revenue+r.revenue+c.weighted,profit:a.profit+r.profit}},sixMonth:{won:n,pipeline:o,opportunities:d,total:{revenue:n.revenue+o.revenue+d.weighted,profit:n.profit+o.profit}}}},[g,k,v,q]),X=t.useMemo(()=>{const e=k.filter(e=>"active"===e.status),t=e.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",q,v),0),s=e.reduce((e,t)=>{const s=(t.probability||0)/100;return e+i(t.value||0,t.currency||"USD",q,v)*s},0),a={};Object.keys(o).forEach(t=>{const s=e.filter(e=>e.region===t);a[t]={count:s.length,value:s.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",q,v),0)}});const r=new Date,n=new Date(r.getTime()+6048e5),l=e.filter(e=>{if(!e.nextActionDate)return!1;const t=new Date(e.nextActionDate);return t>=r&&t<=n}).sort((e,t)=>new Date(e.nextActionDate)-new Date(t.nextActionDate)).slice(0,5);return{totalCount:e.length,totalValue:t,weightedValue:s,wonCount:k.filter(e=>"won"===e.status).length,lostCount:k.filter(e=>"lost"===e.status).length,byRegion:a,upcomingActions:l}},[k,q,v]),Z=e=>{if(e.client?.company)return e.client.company;const t=j.find(t=>t.id===e.clientId);return t?.company||"Unknown"},ee=()=>{},te=()=>{U(null),E(null)};return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-dark-bg border-b border-dark-border p-3 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-semibold text-gray-100",children:["Welcome back, ",Y]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-400 mt-0.5",children:"Pipeline Dashboard"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:()=>p&&p(),className:"btn-primary flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"New Quote"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 hidden sm:inline",children:"Filters:"}),e.jsxs("select",{value:S,onChange:e=>A(parseInt(e.target.value)),className:"input-sm text-sm w-20 sm:w-32 min-h-[40px]",children:[0===z.length&&e.jsx("option",{value:(new Date).getFullYear(),children:(new Date).getFullYear()}),z.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:C,onChange:e=>M(e.target.value),className:"input-sm text-sm w-24 sm:w-40 min-h-[40px]",children:[e.jsx("option",{value:"all",children:"All Months"}),x.map((t,s)=>e.jsx("option",{value:s,children:t},t))]}),e.jsx("div",{className:"hidden sm:block h-4 w-px bg-dark-border mx-2"}),e.jsx("span",{className:"text-sm text-gray-400 hidden sm:inline",children:"View:"}),e.jsxs("select",{value:q,onChange:e=>{return t=e.target.value,void D({currency:t});var t},className:"input-sm text-sm w-20 sm:w-24 min-h-[40px]",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"AED",children:"AED"}),e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"QAR",children:"QAR"}),e.jsx("option",{value:"KWD",children:"KWD"})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-4",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Rates: ",f?new Date(f).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never"]}),e.jsx("button",{onClick:N,disabled:w,className:"p-2 min-w-[32px] min-h-[32px] hover:text-white transition-colors "+(w?"animate-spin":""),title:"Refresh Exchange Rates",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[G.length," quotes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-900/30 to-green-950/20 border-green-800/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-[10px] font-medium text-green-400/90 uppercase tracking-wide",children:"Won"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:c(J.won.revenue,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:c(J.won.profit,q,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-[#0F8B8D]/10 to-[#143642]/10 border-[#0F8B8D]/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#0F8B8D]"}),e.jsx("span",{className:"text-[10px] font-medium text-[#0F8B8D]/90 uppercase tracking-wide",children:"Pipeline"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-200 tabular-nums",children:c(J.pipeline.revenue,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-gray-300 tabular-nums",children:c(J.pipeline.profit,q,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-amber-900/20 to-amber-950/10 border-amber-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-[10px] font-medium text-amber-400/90 uppercase tracking-wide",children:"3-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:c(K.threeMonth.won.revenue,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:c(K.threeMonth.pipeline.revenue,q,0)})]}),K.threeMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:c(K.threeMonth.opportunities.weighted,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-amber-800/30",children:[e.jsx("p",{className:"text-[10px] text-amber-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-amber-400 tabular-nums",children:c(K.threeMonth.total.revenue,q,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-900/20 to-purple-950/10 border-purple-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-[10px] font-medium text-purple-400/90 uppercase tracking-wide",children:"6-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:c(K.sixMonth.won.revenue,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:c(K.sixMonth.pipeline.revenue,q,0)})]}),K.sixMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:c(K.sixMonth.opportunities.weighted,q,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-purple-800/30",children:[e.jsx("p",{className:"text-[10px] text-purple-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-purple-400 tabular-nums",children:c(K.sixMonth.total.revenue,q,0)})]})]})]})]}),e.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0 sm:overflow-visible",children:d.map(t=>e.jsx("div",{className:`flex-shrink-0 sm:flex-1 min-w-[140px] sm:min-w-0 rounded-lg px-3 py-2 ${t.bgColor} border border-white/5`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:t.label}),e.jsxs("span",{className:"text-xs text-gray-600 tabular-nums",children:["(",$[t.id].length,")"]})]}),e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:c(_[t.id],q)})]})},t.id))}),k.length>0&&e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-cyan-900/20 to-cyan-950/10 border-cyan-800/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("span",{className:"text-sm font-semibold text-cyan-400",children:"Opportunities Pipeline"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X.totalCount," active)"]})]}),e.jsxs("button",{onClick:()=>h&&h(),className:"text-xs text-cyan-400 hover:text-cyan-300 flex items-center gap-1",children:["View All",e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Pipeline"}),e.jsx("p",{className:"text-lg font-bold text-cyan-400",children:c(X.totalValue,q,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Weighted"}),e.jsx("p",{className:"text-lg font-bold text-amber-400",children:c(X.weightedValue,q,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Won"}),e.jsx("p",{className:"text-lg font-bold text-green-400",children:X.wonCount})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Lost"}),e.jsx("p",{className:"text-lg font-bold text-red-400",children:X.lostCount})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(X.byRegion).map(([t,s])=>s.count>0&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-dark-bg/30 rounded text-xs",children:[e.jsx("span",{className:"text-gray-400",children:t}),e.jsxs("span",{className:"text-gray-500",children:["(",s.count,")"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:c(s.value,q,0)})]},t))}),X.upcomingActions.length>0&&e.jsxs("div",{className:"border-t border-cyan-800/20 pt-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider mb-2",children:"Upcoming Actions"}),e.jsx("div",{className:"space-y-1",children:X.upcomingActions.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-300 truncate max-w-[200px]",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-400",children:t.nextAction}),e.jsx("span",{className:"text-gray-500",children:new Date(t.nextActionDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]},t.id))})]})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("button",{onClick:()=>{D({pipelineMinimized:!W})},className:"flex items-center gap-2 text-sm font-semibold text-gray-400 mb-3 hover:text-white transition-colors min-h-[44px]",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform "+(W?"":"rotate-90"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Pipeline Board",e.jsxs("span",{className:"text-xs text-gray-600 font-normal",children:["(",G.length," quotes)"]})]}),!W&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 items-start",children:d.map(t=>{const a=B[t.id];return e.jsxs("div",{className:"space-y-2 rounded-xl transition-colors "+(F===t.id?"bg-white/5 ring-2 ring-[#0F8B8D]/30":""),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",F!==t&&E(t)})(e,t.id),onDrop:e=>((e,t)=>{e.preventDefault(),E(null),U(null);const s=e.dataTransfer.getData("quoteId");s&&("rejected"===t||"expired"===t||"dead"===t?P({open:!0,quoteId:s,newStatus:t}):b(s,t))})(e,t.id),onDragLeave:ee,children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer",style:{backgroundColor:`${t.color}20`},onClick:()=>T(t.id),title:a?"Expand column":"Collapse column",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:t.label}),a?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]}),!a&&e.jsx("div",{className:"space-y-3 px-1 pb-3",children:0===$[t.id].length?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-dark-border/50 rounded-xl bg-dark-bg/30",children:[e.jsx("svg",{className:"w-10 h-10 mx-auto mb-3 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsxs("p",{className:"text-gray-400 text-sm mb-3",children:["No ",t.label.toLowerCase()," quotes"]}),"draft"===t.id&&e.jsxs("button",{onClick:()=>p&&p(),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-brand-teal hover:text-white bg-brand-teal/10 hover:bg-brand-teal/20 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create your first quote"]}),"draft"!==t.id&&e.jsx("p",{className:"text-xs text-gray-500",children:"Drag quotes here to update status"})]}):$[t.id].map(a=>{const r=l(a.sections||{},a.fees||{}),n=i(r.totalCharge,a.currency||"USD",q,v),o=function(e,t){const s=m(e,t);return!!s&&new Date>s}(a.quoteDate,a.validityDays),d=!o&&function(e,t,s=7){const a=m(e,t);if(!a)return!1;const r=new Date,n=Math.ceil((a-r)/864e5);return n>0&&n<=s}(a.quoteDate,a.validityDays),x=!!(p=a.nextFollowUpDate)&&new Date(p)<new Date;var p;const h=d||x;return e.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{U(t),e.dataTransfer.setData("quoteId",t),e.dataTransfer.effectAllowed="move"})(e,a.id),onDragEnd:te,onClick:()=>u&&u(a),className:`w-full card text-left hover:border-white/15 transition-all cursor-move\n                                                            ${L===a.id?"opacity-50 scale-95":"opacity-100"}\n                                                            ${h?"border-amber-500/30 bg-amber-500/5":""}\n                                                            ${o?"border-red-500/30 bg-red-500/5 opacity-60":""}\n                                                            active:cursor-grabbing hover:shadow-lg group relative`,children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete this quote?")&&s.getState().deleteQuote(a.id)},className:"p-2 min-w-[36px] min-h-[36px] text-gray-500 hover:text-red-400 bg-dark-card rounded shadow-sm border border-dark-border flex items-center justify-center",title:"Delete Quote",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"flex justify-between items-start mb-1.5 pr-6 gap-2",children:[e.jsx("p",{className:"text-[11px] text-gray-500 font-mono tracking-tight",children:a.quoteNumber}),e.jsxs("div",{className:"flex gap-1 items-center flex-wrap",children:[o&&e.jsx("span",{className:"text-[9px] bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded font-medium",title:"Quote has expired",children:"EXPIRED"}),d&&e.jsx("span",{className:"text-[9px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded font-medium",title:"Expires within 7 days",children:"EXPIRING"}),x&&e.jsxs("span",{className:"text-[9px] bg-orange-500/20 text-orange-400 px-1.5 py-0.5 rounded font-medium flex items-center gap-0.5",title:`Follow-up was due on ${new Date(a.nextFollowUpDate).toLocaleDateString()}`,children:[e.jsx("svg",{className:"w-2.5 h-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),"DUE"]}),a.project?.startDate&&e.jsx("span",{className:"text-[10px] bg-dark-bg/70 px-1.5 py-0.5 rounded text-gray-500",children:new Date(a.project.startDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]}),e.jsx("p",{className:"text-sm font-medium text-gray-200 mb-0.5 truncate",children:Z(a)}),a.project?.title&&e.jsx("p",{className:"text-xs text-gray-500 truncate mb-2",children:a.project.title}),e.jsx("div",{className:"flex items-center justify-between pt-1 border-t border-white/5",children:e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:c(n,q)})})]},a.id)})})]},t.id)})})]}),I.open&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-2",children:"rejected"===I.newStatus?"Quote Rejected":"expired"===I.newStatus?"Quote Expired":"Quote Lost"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Help us track why this opportunity didn't close"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Reason"}),e.jsxs("select",{value:Q,onChange:e=>V(e.target.value),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"price",children:"Price too high"}),e.jsx("option",{value:"timing",children:"Wrong timing"}),e.jsx("option",{value:"lost_to_competitor",children:"Lost to competitor"}),e.jsx("option",{value:"no_budget",children:"No budget"}),e.jsx("option",{value:"requirements_mismatch",children:"Requirements didn't match"}),e.jsx("option",{value:"client_unresponsive",children:"Client unresponsive"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{value:H,onChange:e=>O(e.target.value),placeholder:"Any additional context...",rows:3,className:"input resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>{P({open:!1,quoteId:null,newStatus:null}),V(""),O("")},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{I.quoteId&&I.newStatus&&b(I.quoteId,I.newStatus,H,Q,H),P({open:!1,quoteId:null,newStatus:null}),V(""),O("")},disabled:!Q,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Update Status"})]})]})})]})}export{u as default};
