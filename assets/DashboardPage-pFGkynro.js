import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{o as s,p as a,g as r,u as n,e as i,q as l,f as o,c,r as d,t as x,w as m,S as u,X as p,U as h,x as g,y as j,z as f,B as b,D as v,E as y,G as N,H as w,a as k,b as D,J as C,K as M,d as S,R as _}from"./index-Civi5K2Q.js";import"./contactStore-CWMZuGE8.js";import{T as A}from"./trending-up-DV8_LUvq.js";import{Z as R}from"./zap-Dsylw07O.js";import{P as U}from"./phone-ClQiknGh.js";import{F as L}from"./file-text-Bfl-WJmE.js";import{A as E}from"./activity-D7pi9uFJ.js";import{C as F}from"./chart-column-LV9JMBC6.js";import{U as q}from"./user-C5gXarCw.js";import{B as P}from"./briefcase-eSCo_qCO.js";import{D as I}from"./dollar-sign-D2Fa3Mc7.js";import{C as W}from"./chevron-down-fSk3gD6A.js";import{C as B}from"./chevron-up-ChP4NTD4.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const O=s("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),T=s("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);function V({dashboardCurrency:s,rates:a,timeRange:c="all"}){const{opportunities:d}=r(),{savedQuotes:x}=n(),m=t.useMemo(()=>{const e=d.filter(e=>"won"===e.status||"lost"===e.status),t=e.filter(e=>"won"===e.status);e.length>0&&(t.length,e.length);const r=x.filter(e=>"won"===e.status||"dead"===e.status),n=r.filter(e=>"won"===e.status);r.length>0&&(n.length,r.length);const l=e.length+r.length,o=t.length+n.length,c=l>0?o/l*100:0;return{winRate:c,wonCount:o,lostCount:l-o,totalClosed:l,wonValue:t.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",s,a),0),trend:c>=50?"up":"down"}},[d,x,s,a]),u="up"===m.trend?A:T,p="up"===m.trend?"text-green-400":"text-red-400";return e.jsxs("div",{className:"card bg-gradient-to-br from-emerald-900/20 to-emerald-950/10 border-emerald-800/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:e.jsx(l,{className:"w-4 h-4 text-emerald-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Win Rate"})]}),e.jsx(u,{className:`w-4 h-4 ${p}`})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-emerald-400",children:[m.winRate.toFixed(0),"%"]}),e.jsx("span",{className:"text-sm text-gray-500 pb-1",children:"of deals closed"})]}),e.jsx("div",{className:"h-2 bg-dark-border rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-green-400",style:{width:`${Math.min(m.winRate,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-green-400",children:[m.wonCount," won"]}),e.jsxs("span",{className:"text-red-400",children:[m.lostCount," lost"]})]}),m.wonValue>0&&e.jsxs("div",{className:"pt-2 border-t border-emerald-800/30",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Won Value"}),e.jsx("p",{className:"text-sm font-semibold text-emerald-400",children:o(m.wonValue,s,0)})]})]})]})}function $({dashboardCurrency:s,rates:a}){const{opportunities:l}=r(),{savedQuotes:c}=n(),d=t.useMemo(()=>{const e=l.filter(e=>"won"===e.status&&e.close_date&&e.created_at),t=e.length>0?e.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",s,a),0)/e.length:0;let r=0;if(e.length>0){const t=e.map(e=>{const t=new Date(e.created_at),s=new Date(e.close_date);return Math.ceil((s-t)/864e5)}).filter(e=>e>0);t.length>0&&(r=t.reduce((e,t)=>e+t,0)/t.length)}const n=l.filter(e=>"won"===e.status||"lost"===e.status),o=n.length>0?e.length/n.length*100:0,c=l.filter(e=>"active"===e.status),d=c.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",s,a),0),x=c.length;return{velocity:r>0?x*t*(o/100)/r:0,pipelineCount:x,avgDealValue:t,winRate:o,avgCycle:r,pipelineValue:d}},[l,c,s,a]);return e.jsxs("div",{className:"card bg-gradient-to-br from-cyan-900/20 to-cyan-950/10 border-cyan-800/20 p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:e.jsx(R,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Sales Velocity"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-cyan-400",children:o(d.velocity,s,0)}),e.jsx("span",{className:"text-sm text-gray-500 pb-1",children:"/ day"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:"Avg Deal"}),e.jsx("p",{className:"text-sm font-medium text-white",children:o(d.avgDealValue,s,0)})]}),e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:"Avg Cycle"}),e.jsxs("p",{className:"text-sm font-medium text-white",children:[d.avgCycle.toFixed(0)," days"]})]}),e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:"Win Rate"}),e.jsxs("p",{className:"text-sm font-medium text-white",children:[d.winRate.toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:"Pipeline"}),e.jsxs("p",{className:"text-sm font-medium text-white",children:[d.pipelineCount," deals"]})]})]})]})]})}function Q(){const{activities:s}=c(),a=t.useMemo(()=>{const e=new Date,t=new Date(e.getTime()-6048e5),a=new Date(e.getTime()-2592e6),r=s.filter(e=>new Date(e.created_at)>=t),n=s.filter(e=>new Date(e.created_at)>=a),i={};return r.forEach(e=>{const t=e.activity_type||"other";i[t]=(i[t]||0)+1}),{weekTotal:r.length,monthTotal:n.length,calls:i.call||0,meetings:i.meeting||0,emails:i.email||0,notes:i.note||0,tasks:i.task||0,avgPerDay:Math.round(r.length/7)}},[s]),r=[{type:"calls",label:"Calls",count:a.calls,icon:U,color:"text-blue-400"},{type:"meetings",label:"Meetings",count:a.meetings,icon:d,color:"text-green-400"},{type:"emails",label:"Emails",count:a.emails,icon:x,color:"text-amber-400"},{type:"notes",label:"Notes",count:a.notes,icon:L,color:"text-purple-400"}];return e.jsxs("div",{className:"card bg-gradient-to-br from-indigo-900/20 to-indigo-950/10 border-indigo-800/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center",children:e.jsx(E,{className:"w-4 h-4 text-indigo-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Activity (7 Days)"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[a.avgPerDay,"/day avg"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-indigo-400",children:a.weekTotal}),e.jsx("span",{className:"text-sm text-gray-500 pb-1",children:"activities logged"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:r.map(({type:t,label:s,count:a,icon:r,color:n})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(r,{className:`w-4 h-4 ${n}`})}),e.jsx("span",{className:"text-lg font-semibold text-white block",children:a}),e.jsx("span",{className:"text-[10px] text-gray-500",children:s})]},t))}),e.jsxs("div",{className:"pt-2 border-t border-indigo-800/30 flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Last 30 days"}),e.jsxs("span",{className:"text-indigo-400 font-medium",children:[a.monthTotal," activities"]})]})]})]})}function z({dashboardCurrency:s,rates:a}){const{opportunities:n}=r(),l=t.useMemo(()=>{const e=new Date,t=n.filter(e=>"active"===e.status);let r=0,l=0,o=0,c=0;t.forEach(t=>{const n=i(t.value||0,t.currency||"USD",s,a);c+=n;const d=t.last_activity_at?new Date(t.last_activity_at):new Date(t.created_at),x=Math.floor((e-d)/864e5);x>30?r++:x>14?l++:o++});const d=t.length>0?Math.round(o/t.length*100):100;return{totalDeals:t.length,totalValue:c,healthyCount:o,atRiskCount:l,staleCount:r,healthScore:d}},[n,s,a]);return e.jsxs("div",{className:"card bg-gradient-to-br from-teal-900/20 to-teal-950/10 border-teal-800/20 p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-teal-500/20 flex items-center justify-center",children:e.jsx(F,{className:"w-4 h-4 text-teal-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Pipeline Health"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-3xl font-bold "+(c=l.healthScore,c>=70?"text-green-400":c>=40?"text-amber-400":"text-red-400"),children:[l.healthScore,"%"]}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"healthy"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm font-semibold text-white",children:o(l.totalValue,s,0)}),e.jsxs("span",{className:"text-xs text-gray-500 block",children:[l.totalDeals," deals"]})]})]}),e.jsxs("div",{className:"flex gap-1 h-3",children:[l.healthyCount>0&&e.jsx("div",{className:"bg-green-500 rounded-l",style:{width:l.healthyCount/l.totalDeals*100+"%"},title:`${l.healthyCount} healthy`}),l.atRiskCount>0&&e.jsx("div",{className:"bg-amber-500",style:{width:l.atRiskCount/l.totalDeals*100+"%"},title:`${l.atRiskCount} at risk`}),l.staleCount>0&&e.jsx("div",{className:"bg-red-500 rounded-r",style:{width:l.staleCount/l.totalDeals*100+"%"},title:`${l.staleCount} stale`})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-gray-400",children:[l.healthyCount," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsxs("span",{className:"text-gray-400",children:[l.atRiskCount," At Risk"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsxs("span",{className:"text-gray-400",children:[l.staleCount," Stale"]})]})]})]})]});var c}function Y({dashboardCurrency:t,rates:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(V,{dashboardCurrency:t,rates:s}),e.jsx($,{dashboardCurrency:t,rates:s}),e.jsx(Q,{}),e.jsx(z,{dashboardCurrency:t,rates:s})]})}const H=[{id:"account_created",label:"Create your account",description:"You're already here!",icon:q,action:null,alwaysComplete:!0},{id:"company_profile_setup",label:"Set up company profile",description:"Add your logo and company details",icon:P,action:{view:"settings",tab:"company"}},{id:"rates_configured",label:"Configure your rates",description:"Set up your rate card for quick quoting",icon:I,action:{view:"rate-card"}},{id:"first_client_added",label:"Add your first client",description:"Start building your client database",icon:h,action:{view:"clients",action:"new"}},{id:"first_quote_created",label:"Create your first quote",description:"Generate a professional quote in minutes",icon:L,action:{view:"editor",isNew:!0}},{id:"first_project_created",label:"Start a project",description:"Turn a quote into an active project",icon:g,action:{view:"projects",action:"new"}}];function G({userId:s,organizationId:a,onNavigate:r}){const[n,i]=t.useState(null),[l,o]=t.useState(!1),[c,d]=t.useState(!1),[x,h]=t.useState(!0);t.useEffect(()=>{g()},[s,a]);const g=async()=>{if(!s||!a)return void h(!1);const e=await m(s,a);e&&(i(e),o(e.minimized||!1),d(e.dismissed||!1)),h(!1)},v=async()=>{d(!0),await b(s,a)},y=n?H.filter(e=>!!e.alwaysComplete||n[e.id]).length:1,N=H.length,w=Math.round(y/N*100);return x||c||!s&&!a?null:y===N&&!l?e.jsx("div",{className:"bg-gradient-to-r from-green-500/20 to-teal-500/20 border border-green-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Setup Complete!"}),e.jsx("p",{className:"text-sm text-gray-400",children:"You've completed all the getting started tasks."})]})]}),e.jsx("button",{onClick:v,className:"text-gray-400 hover:text-gray-300 transition-colors p-1",title:"Dismiss",children:e.jsx(p,{className:"w-5 h-5"})})]})}):e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-orange/20 flex items-center justify-center",children:e.jsx(u,{className:"w-4 h-4 text-brand-orange"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Getting Started"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[y," of ",N," tasks complete"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const e=!l;o(e),await f(s,a,e)},className:"text-gray-400 hover:text-gray-300 transition-colors p-1",title:l?"Expand":"Minimize",children:l?e.jsx(W,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})}),e.jsx("button",{onClick:v,className:"text-gray-400 hover:text-gray-300 transition-colors p-1",title:"Dismiss",children:e.jsx(p,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"h-2 bg-dark-bg rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-orange to-brand-teal transition-all duration-500",style:{width:`${w}%`}})})})]}),!l&&e.jsx("div",{className:"p-2",children:H.map(t=>{const s=(e=>!!e.alwaysComplete||n?.[e.id]||!1)(t),a=t.icon;return e.jsxs("button",{onClick:()=>!s&&(e=>{e.action&&r&&r(e.action)})(t),disabled:s,className:"w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors "+(s?"opacity-60 cursor-default":"hover:bg-dark-bg cursor-pointer"),children:[s?e.jsx(j,{className:"w-5 h-5 text-green-500 flex-shrink-0"}):e.jsx(O,{className:"w-5 h-5 text-gray-500 flex-shrink-0"}),e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 "+(s?"bg-gray-700":"bg-brand-orange/20"),children:e.jsx(a,{className:"w-4 h-4 "+(s?"text-gray-500":"text-brand-orange")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium "+(s?"text-gray-400 line-through":"text-white"),children:t.label}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.description})]})]},t.id)})})]})}const J=120,K=[24,12,6,1],X="active",Z="expiring_soon",ee="grace_period",te="expired",se="converted";function ae({organizationId:s,onUpgrade:a}){const[r,n]=t.useState(null),[i,l]=t.useState(!1),[o,c]=t.useState(!0);t.useEffect(()=>{d()},[s]);const d=async()=>{if(!s)return void c(!1);const e=await async function(e){if(!v())return{status:X,hoursRemaining:J,trialEndsAt:null,isReadOnly:!1};const{data:t,error:s}=await y.from("organizations").select("trial_ends_at, subscription_status, subscription_tier, stripe_customer_id").eq("id",e).single();if(s)return null;if("active"===t.subscription_status&&"free"!==t.subscription_tier)return{status:se,hoursRemaining:null,trialEndsAt:null,isReadOnly:!1,hasPaymentMethod:!!t.stripe_customer_id};const a=t.trial_ends_at?new Date(t.trial_ends_at):null,r=new Date;if(!a)return{status:X,hoursRemaining:J,trialEndsAt:null,isReadOnly:!1,hasPaymentMethod:!!t.stripe_customer_id};const n=Math.ceil((a-r)/36e5),i=Math.ceil(n/24);if(n>K[0])return{status:X,hoursRemaining:n,daysRemaining:i,trialEndsAt:a,isReadOnly:!1,hasPaymentMethod:!!t.stripe_customer_id};if(n>0){let e="medium";return n<=1?e="critical":n<=6&&(e="high"),{status:Z,hoursRemaining:n,daysRemaining:i,trialEndsAt:a,isReadOnly:!1,warningLevel:e,hasPaymentMethod:!!t.stripe_customer_id}}return{status:te,hoursRemaining:0,daysRemaining:0,trialEndsAt:a,isReadOnly:!t.stripe_customer_id,hasPaymentMethod:!!t.stripe_customer_id}}(s);n(e),c(!1)};if(t.useEffect(()=>{sessionStorage.getItem(`trial-banner-dismissed-${s}`)&&l(!0)},[s]),o||!r)return null;const x=function(e){if(!e)return null;switch(e.status){case X:return{type:"info",title:"Trial Active",message:`${e.daysRemaining} days remaining in your trial`,showUpgrade:!1};case Z:return{type:"critical"===e.warningLevel?"error":"warning",title:"Trial Ending Soon",message:1===e.daysRemaining?"Your trial ends tomorrow!":`Only ${e.daysRemaining} days left in your trial`,showUpgrade:!0};case ee:return{type:"error",title:"Trial Expired",message:`Your trial has ended. Upgrade within ${e.graceDaysRemaining} days to keep all features.`,showUpgrade:!0};case te:return{type:"error",title:"Trial Expired",message:"Your trial has expired. Upgrade to continue using all features.",showUpgrade:!0,readOnly:!0};default:return null}}(r);if(!x||i)return null;if(r.status===X||r.status===se)return null;const m={warning:"bg-yellow-500/20 border-yellow-500/30 text-yellow-200",error:"bg-red-500/20 border-red-500/30 text-red-200",info:"bg-blue-500/20 border-blue-500/30 text-blue-200"},h={warning:"text-yellow-400",error:"text-red-400",info:"text-blue-400"},g=m[x.type]||m.info,j=h[x.type]||h.info;return e.jsx("div",{className:`${g} border rounded-lg p-4 mb-4`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:["error"===x.type?e.jsx(N,{className:`w-5 h-5 ${j} flex-shrink-0`}):e.jsx(w,{className:`w-5 h-5 ${j} flex-shrink-0`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:x.title}),e.jsx("p",{className:"text-sm opacity-80",children:x.message})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x.showUpgrade&&e.jsxs("button",{onClick:()=>{a&&a()},className:"flex items-center gap-2 px-4 py-2 bg-brand-orange text-white rounded-lg hover:bg-brand-orange/90 transition-colors font-medium text-sm",children:[e.jsx(u,{className:"w-4 h-4"}),"Upgrade Now"]}),r.status!==te&&e.jsx("button",{onClick:()=>{l(!0),sessionStorage.setItem(`trial-banner-dismissed-${s}`,"true")},className:"text-current opacity-60 hover:opacity-100 transition-opacity p-1",title:"Dismiss",children:e.jsx(p,{className:"w-5 h-5"})})]})]})})}const re=[{id:"draft",label:"Drafts",color:"#9CA3AF",bgColor:"bg-gray-400/10"},{id:"sent",label:"Sent",color:"#0F8B8D",bgColor:"bg-[#0F8B8D]/10"},{id:"won",label:"Won",color:"#22c55e",bgColor:"bg-green-500/10"},{id:"dead",label:"Dead",color:"#F87171",bgColor:"bg-red-400/10"}],ne=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ie(e,t){if(!e)return null;const s=new Date(e);return s.setDate(s.getDate()+(parseInt(t)||30)),s}function le({onViewQuote:s,onNewQuote:l,onGoToOpportunities:d,onGoToKnowledge:x,onNavigate:m}){const{savedQuotes:u,clients:p,updateQuoteStatus:h}=n(),{rates:g,ratesUpdated:j,refreshRates:f,ratesLoading:b}=k(),{settings:v,setDashboardPreferences:y}=D(),{opportunities:N}=r(),{getOverdueFollowUps:w,activities:A}=c(),{fragments:R,learnings:U,getStats:L,getPendingReview:E}=C(),{user:F}=M(),{organizationId:q}=function(){const e=a(e=>e.organization?.id||null);return{organizationId:e,orgFields:e?{organization_id:e}:{},hasOrg:!!e}}(),[P,I]=t.useState("all"),[W,B]=t.useState((new Date).getFullYear()),[O,T]=t.useState(null),[V,$]=t.useState(null),Q=v.dashboardPreferences||{},z=Q.currency||"USD",H=Q.collapsedColumns||{},J=Q.pipelineMinimized||!1,[K,X]=t.useState({open:!1,quoteId:null,newStatus:null}),[Z,ee]=t.useState(""),[te,se]=t.useState(""),le=e=>{(e=>{const t="function"==typeof e?e(H):e;y({collapsedColumns:t})})(t=>({...t,[e]:!t[e]}))},oe=v?.users?.[0]?.name||"User",ce=t.useMemo(()=>{const e=new Set;return u.forEach(t=>{const s=new Date(t.savedAt||t.createdAt);e.add(s.getFullYear())}),Array.from(e).sort((e,t)=>t-e)},[u]),de=t.useMemo(()=>u.filter(e=>{if(!e)return!1;const t=new Date(e.savedAt||e.createdAt),s=t.getFullYear()===W,a="all"===P||t.getMonth()===parseInt(P);return s&&a}).sort((e,t)=>{const s=new Date(e?.updatedAt||e?.savedAt||e?.createdAt||0);return new Date(t?.updatedAt||t?.savedAt||t?.createdAt||0)-s}),[u,P,W]),xe=t.useMemo(()=>{const e={};return re.forEach(t=>{e[t.id]=de.filter(e=>(e?.status||"draft")===t.id)}),e},[de]),me=t.useMemo(()=>{const e={};return re.forEach(t=>{e[t.id]=xe[t.id].reduce((e,t)=>{const s=S(t?.sections||{},t?.fees||{});return e+i(s.totalCharge,t.currency||"USD",z,g)},0)}),e},[xe,g,z]),ue=t.useMemo(()=>{let e=0,t=0,s=0,a=0,r=0,n=0,l=0,o=0;return de.forEach(c=>{const d=S(c.sections||{},c.fees||{}),x=i(d.totalCharge,c.currency||"USD",z,g),m=i(d.totalCost,c.currency||"USD",z,g);"won"===c.status?(e+=x,t+=x-m,s+=d.margin,a++):"draft"!==c.status&&"sent"!==c.status||(r+=x,n+=x-m,l+=d.margin,o++)}),N.filter(e=>"active"===e.status).forEach(e=>{const t=i(e.value||0,e.currency||"USD",z,g)*((e.probability||0)/100);r+=t,o++}),{won:{revenue:e,profit:t,avgMargin:a>0?s/a:0},pipeline:{revenue:r,profit:n,avgMargin:o>0?l/o:0}}},[de,N,g,z]),pe=t.useMemo(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()+3,e.getDate()),s=new Date(e.getFullYear(),e.getMonth()+6,e.getDate());let a={revenue:0,profit:0},r={revenue:0,profit:0},n={revenue:0,profit:0},l={revenue:0,profit:0},o={revenue:0,weighted:0},c={revenue:0,weighted:0};return u.forEach(o=>{if("dead"===o.status)return;const c=o.project?.startDate?new Date(o.project.startDate):null;if(!c||c<e)return;const d=S(o.sections||{},o.fees||{}),x=i(d.totalCharge,o.currency||"USD",z,g),m=x-i(d.totalCost,o.currency||"USD",z,g),u="won"===o.status||"approved"===o.status;c<=t&&(u?(a.revenue+=x,a.profit+=m):(r.revenue+=x,r.profit+=m)),c<=s&&(u?(n.revenue+=x,n.profit+=m):(l.revenue+=x,l.profit+=m))}),N.filter(e=>"active"===e.status).forEach(a=>{const r=a.expectedCloseDate?new Date(a.expectedCloseDate):null;if(!r||r<e)return;const n=i(a.value||0,a.currency||"USD",z,g),l=n*((a.probability||0)/100);r<=t&&(o.revenue+=n,o.weighted+=l),r<=s&&(c.revenue+=n,c.weighted+=l)}),{threeMonth:{won:a,pipeline:r,opportunities:o,total:{revenue:a.revenue+r.revenue+o.weighted,profit:a.profit+r.profit}},sixMonth:{won:n,pipeline:l,opportunities:c,total:{revenue:n.revenue+l.revenue+c.weighted,profit:n.profit+l.profit}}}},[u,N,g,z]),he=t.useMemo(()=>{const e=N.filter(e=>"active"===e.status),t=e.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",z,g),0),s=e.reduce((e,t)=>{const s=(t.probability||0)/100;return e+i(t.value||0,t.currency||"USD",z,g)*s},0),a={};Object.keys(_).forEach(t=>{const s=e.filter(e=>e.region===t);a[t]={count:s.length,value:s.reduce((e,t)=>e+i(t.value||0,t.currency||"USD",z,g),0)}});const r=new Date,n=new Date(r.getTime()+6048e5),l=e.filter(e=>{if(!e.nextActionDate)return!1;const t=new Date(e.nextActionDate);return t>=r&&t<=n}).sort((e,t)=>new Date(e.nextActionDate)-new Date(t.nextActionDate)).slice(0,5);return{totalCount:e.length,totalValue:t,weightedValue:s,wonCount:N.filter(e=>"won"===e.status).length,lostCount:N.filter(e=>"lost"===e.status).length,byRegion:a,upcomingActions:l}},[N,z,g]),ge=t.useMemo(()=>{const e=new Date,t=u.filter(t=>{if("sent"!==t.status)return!1;const s=ie(t.quoteDate,t.validityDays);if(!s)return!1;const a=Math.ceil((s-e)/864e5);return a>0&&a<=7}).map(t=>{const s=ie(t.quoteDate,t.validityDays),a=Math.ceil((s-e)/864e5);return{...t,daysUntilExpiry:a,expiryDate:s}}).sort((e,t)=>e.daysUntilExpiry-t.daysUntilExpiry),s=w().map(t=>{const s=p.find(e=>e.id===t.clientId),a=Math.floor((e-new Date(t.followUpDate))/864e5);return{...t,clientName:s?.company||"Unknown Client",daysOverdue:a}});return{expiringQuotes:t,overdueFollowUps:s,totalCount:t.length+s.length}},[u,p,w]);t.useMemo(()=>{const e=L(),t=E(),s={market_insight:"Market Insights",pricing_strategy:"Pricing Strategy",client_preference:"Client Preferences",competitor_intel:"Competitor Intel",process_tip:"Process Tips",regional_pattern:"Regional Patterns"},a=Object.entries(e.byType||{}).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e,t])=>({type:e,label:s[e]||e,count:t}));return{...e,pendingCount:t.totalCount,pendingFragments:t.fragments.length,pendingLearnings:t.learnings.length,topTypes:a}},[R,U,L,E]);const je=e=>{if(e.client?.company)return e.client.company;const t=p.find(t=>t.id===e.clientId);return t?.company||"Unknown"},fe=()=>{},be=()=>{T(null),$(null)};return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-dark-bg border-b border-dark-border p-3 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-semibold text-gray-100",children:["Welcome back, ",oe]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-400 mt-0.5",children:"Pipeline Dashboard"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:()=>l&&l(),className:"btn-primary flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"New Quote"})]})})]}),e.jsx(ae,{organizationId:q,onUpgrade:()=>m?.({view:"settings",tab:"billing"})}),e.jsx("div",{className:"mb-4",children:e.jsx(G,{userId:F?.userId,organizationId:q,onNavigate:m})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 hidden sm:inline",children:"Filters:"}),e.jsxs("select",{value:W,onChange:e=>B(parseInt(e.target.value)),className:"input-sm text-sm w-20 sm:w-32 min-h-[40px]",children:[0===ce.length&&e.jsx("option",{value:(new Date).getFullYear(),children:(new Date).getFullYear()}),ce.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:P,onChange:e=>I(e.target.value),className:"input-sm text-sm w-24 sm:w-40 min-h-[40px]",children:[e.jsx("option",{value:"all",children:"All Months"}),ne.map((t,s)=>e.jsx("option",{value:s,children:t},t))]}),e.jsx("div",{className:"hidden sm:block h-4 w-px bg-dark-border mx-2"}),e.jsx("span",{className:"text-sm text-gray-400 hidden sm:inline",children:"View:"}),e.jsxs("select",{value:z,onChange:e=>{return t=e.target.value,void y({currency:t});var t},className:"input-sm text-sm w-20 sm:w-24 min-h-[40px]",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"AED",children:"AED"}),e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"QAR",children:"QAR"}),e.jsx("option",{value:"KWD",children:"KWD"})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-4",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Rates: ",j?new Date(j).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never"]}),e.jsx("button",{onClick:f,disabled:b,className:"p-2 min-w-[32px] min-h-[32px] hover:text-white transition-colors "+(b?"animate-spin":""),title:"Refresh Exchange Rates",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[de.length," quotes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-900/30 to-green-950/20 border-green-800/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-[10px] font-medium text-green-400/90 uppercase tracking-wide",children:"Won"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:o(ue.won.revenue,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:o(ue.won.profit,z,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-[#0F8B8D]/10 to-[#143642]/10 border-[#0F8B8D]/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#0F8B8D]"}),e.jsx("span",{className:"text-[10px] font-medium text-[#0F8B8D]/90 uppercase tracking-wide",children:"Pipeline"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-200 tabular-nums",children:o(ue.pipeline.revenue,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-gray-300 tabular-nums",children:o(ue.pipeline.profit,z,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-amber-900/20 to-amber-950/10 border-amber-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-[10px] font-medium text-amber-400/90 uppercase tracking-wide",children:"3-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:o(pe.threeMonth.won.revenue,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:o(pe.threeMonth.pipeline.revenue,z,0)})]}),pe.threeMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:o(pe.threeMonth.opportunities.weighted,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-amber-800/30",children:[e.jsx("p",{className:"text-[10px] text-amber-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-amber-400 tabular-nums",children:o(pe.threeMonth.total.revenue,z,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-900/20 to-purple-950/10 border-purple-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-[10px] font-medium text-purple-400/90 uppercase tracking-wide",children:"6-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:o(pe.sixMonth.won.revenue,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:o(pe.sixMonth.pipeline.revenue,z,0)})]}),pe.sixMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:o(pe.sixMonth.opportunities.weighted,z,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-purple-800/30",children:[e.jsx("p",{className:"text-[10px] text-purple-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-purple-400 tabular-nums",children:o(pe.sixMonth.total.revenue,z,0)})]})]})]})]}),e.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0 sm:overflow-visible",children:re.map(t=>e.jsx("div",{className:`flex-shrink-0 sm:flex-1 min-w-[140px] sm:min-w-0 rounded-lg px-3 py-2 ${t.bgColor} border border-white/5`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:t.label}),e.jsxs("span",{className:"text-xs text-gray-600 tabular-nums",children:["(",xe[t.id].length,")"]})]}),e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:o(me[t.id],z)})]})},t.id))}),e.jsx("div",{className:"mt-6",children:e.jsx(Y,{dashboardCurrency:z,rates:g})}),ge.totalCount>0&&e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-red-900/20 to-orange-950/10 border-red-800/20",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-red-400",children:"Action Required"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",ge.totalCount," items)"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ge.expiringQuotes.length>0&&e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-xs font-medium text-amber-400 uppercase tracking-wide",children:"Expiring Soon"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",ge.expiringQuotes.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[ge.expiringQuotes.slice(0,5).map(t=>e.jsxs("button",{onClick:()=>s&&s(t),className:"w-full flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors text-left group",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-gray-200 truncate group-hover:text-white",children:t.quoteNumber}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:je(t)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded "+(t.daysUntilExpiry<=2?"bg-red-500/20 text-red-400":"bg-amber-500/20 text-amber-400"),children:1===t.daysUntilExpiry?"1 day":`${t.daysUntilExpiry} days`}),e.jsx("svg",{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},t.id)),ge.expiringQuotes.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-1",children:["+",ge.expiringQuotes.length-5," more"]})]})]}),ge.overdueFollowUps.length>0&&e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),e.jsx("span",{className:"text-xs font-medium text-orange-400 uppercase tracking-wide",children:"Overdue Follow-ups"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",ge.overdueFollowUps.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[ge.overdueFollowUps.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-gray-200 truncate",children:t.title||"Follow-up"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.clientName})]}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded ml-2 "+(t.daysOverdue>7?"bg-red-500/20 text-red-400":"bg-orange-500/20 text-orange-400"),children:0===t.daysOverdue?"Today":1===t.daysOverdue?"1 day ago":`${t.daysOverdue}d overdue`})]},t.id)),ge.overdueFollowUps.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-1",children:["+",ge.overdueFollowUps.length-5," more"]})]})]})]})]}),N.length>0&&e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-cyan-900/20 to-cyan-950/10 border-cyan-800/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("span",{className:"text-sm font-semibold text-cyan-400",children:"Opportunities Pipeline"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",he.totalCount," active)"]})]}),e.jsxs("button",{onClick:()=>d&&d(),className:"text-xs text-cyan-400 hover:text-cyan-300 flex items-center gap-1",children:["View All",e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Pipeline"}),e.jsx("p",{className:"text-lg font-bold text-cyan-400",children:o(he.totalValue,z,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Weighted"}),e.jsx("p",{className:"text-lg font-bold text-amber-400",children:o(he.weightedValue,z,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Won"}),e.jsx("p",{className:"text-lg font-bold text-green-400",children:he.wonCount})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Lost"}),e.jsx("p",{className:"text-lg font-bold text-red-400",children:he.lostCount})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(he.byRegion).map(([t,s])=>s.count>0&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-dark-bg/30 rounded text-xs",children:[e.jsx("span",{className:"text-gray-400",children:t}),e.jsxs("span",{className:"text-gray-500",children:["(",s.count,")"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:o(s.value,z,0)})]},t))}),he.upcomingActions.length>0&&e.jsxs("div",{className:"border-t border-cyan-800/20 pt-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider mb-2",children:"Upcoming Actions"}),e.jsx("div",{className:"space-y-1",children:he.upcomingActions.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-300 truncate max-w-[200px]",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-400",children:t.nextAction}),e.jsx("span",{className:"text-gray-500",children:new Date(t.nextActionDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]},t.id))})]})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("button",{onClick:()=>{y({pipelineMinimized:!J})},className:"flex items-center gap-2 text-sm font-semibold text-gray-400 mb-3 hover:text-white transition-colors min-h-[44px]",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform "+(J?"":"rotate-90"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Pipeline Board",e.jsxs("span",{className:"text-xs text-gray-600 font-normal",children:["(",de.length," quotes)"]})]}),!J&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 items-start",children:re.map(t=>{const a=H[t.id];return e.jsxs("div",{className:"space-y-2 rounded-xl transition-colors "+(V===t.id?"bg-white/5 ring-2 ring-[#0F8B8D]/30":""),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",V!==t&&$(t)})(e,t.id),onDrop:e=>((e,t)=>{e.preventDefault(),$(null),T(null);const s=e.dataTransfer.getData("quoteId");s&&("rejected"===t||"expired"===t||"dead"===t?X({open:!0,quoteId:s,newStatus:t}):h(s,t))})(e,t.id),onDragLeave:fe,children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer",style:{backgroundColor:`${t.color}20`},onClick:()=>le(t.id),title:a?"Expand column":"Collapse column",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:t.label}),a?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]}),!a&&e.jsx("div",{className:"space-y-3 px-1 pb-3",children:0===xe[t.id].length?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-dark-border/50 rounded-xl bg-dark-bg/30",children:[e.jsx("svg",{className:"w-10 h-10 mx-auto mb-3 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsxs("p",{className:"text-gray-400 text-sm mb-3",children:["No ",t.label.toLowerCase()," quotes"]}),"draft"===t.id&&e.jsxs("button",{onClick:()=>l&&l(),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-brand-teal hover:text-white bg-brand-teal/10 hover:bg-brand-teal/20 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create your first quote"]}),"draft"!==t.id&&e.jsx("p",{className:"text-xs text-gray-500",children:"Drag quotes here to update status"})]}):xe[t.id].map(a=>{const r=S(a.sections||{},a.fees||{}),l=i(r.totalCharge,a.currency||"USD",z,g),c=function(e,t){const s=ie(e,t);return!!s&&new Date>s}(a.quoteDate,a.validityDays),d=!c&&function(e,t,s=7){const a=ie(e,t);if(!a)return!1;const r=new Date,n=Math.ceil((a-r)/864e5);return n>0&&n<=s}(a.quoteDate,a.validityDays),x=!!(m=a.nextFollowUpDate)&&new Date(m)<new Date;var m;const u=d||x;return e.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{T(t),e.dataTransfer.setData("quoteId",t),e.dataTransfer.effectAllowed="move"})(e,a.id),onDragEnd:be,onClick:()=>s&&s(a),className:`w-full card text-left hover:border-white/15 transition-all cursor-move\n                                                            ${O===a.id?"opacity-50 scale-95":"opacity-100"}\n                                                            ${u?"border-amber-500/30 bg-amber-500/5":""}\n                                                            ${c?"border-red-500/30 bg-red-500/5 opacity-60":""}\n                                                            active:cursor-grabbing hover:shadow-lg group relative`,children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete this quote?")&&n.getState().deleteQuote(a.id)},className:"p-2 min-w-[36px] min-h-[36px] text-gray-500 hover:text-red-400 bg-dark-card rounded shadow-sm border border-dark-border flex items-center justify-center",title:"Delete Quote",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"flex justify-between items-start mb-1.5 pr-6 gap-2",children:[e.jsx("p",{className:"text-[11px] text-gray-500 font-mono tracking-tight",children:a.quoteNumber}),e.jsxs("div",{className:"flex gap-1 items-center flex-wrap",children:[c&&e.jsx("span",{className:"text-[9px] bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded font-medium",title:"Quote has expired",children:"EXPIRED"}),d&&e.jsx("span",{className:"text-[9px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded font-medium",title:"Expires within 7 days",children:"EXPIRING"}),x&&e.jsxs("span",{className:"text-[9px] bg-orange-500/20 text-orange-400 px-1.5 py-0.5 rounded font-medium flex items-center gap-0.5",title:`Follow-up was due on ${new Date(a.nextFollowUpDate).toLocaleDateString()}`,children:[e.jsx("svg",{className:"w-2.5 h-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),"DUE"]}),a.project?.startDate&&e.jsx("span",{className:"text-[10px] bg-dark-bg/70 px-1.5 py-0.5 rounded text-gray-500",children:new Date(a.project.startDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]}),e.jsx("p",{className:"text-sm font-medium text-gray-200 mb-0.5 truncate",children:je(a)}),a.project?.title&&e.jsx("p",{className:"text-xs text-gray-500 truncate mb-2",children:a.project.title}),e.jsx("div",{className:"flex items-center justify-between pt-1 border-t border-white/5",children:e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:o(l,z)})})]},a.id)})})]},t.id)})})]}),K.open&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-2",children:"rejected"===K.newStatus?"Quote Rejected":"expired"===K.newStatus?"Quote Expired":"Quote Lost"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Help us track why this opportunity didn't close"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Reason"}),e.jsxs("select",{value:Z,onChange:e=>ee(e.target.value),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"price",children:"Price too high"}),e.jsx("option",{value:"timing",children:"Wrong timing"}),e.jsx("option",{value:"lost_to_competitor",children:"Lost to competitor"}),e.jsx("option",{value:"no_budget",children:"No budget"}),e.jsx("option",{value:"requirements_mismatch",children:"Requirements didn't match"}),e.jsx("option",{value:"client_unresponsive",children:"Client unresponsive"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{value:te,onChange:e=>se(e.target.value),placeholder:"Any additional context...",rows:3,className:"input resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>{X({open:!1,quoteId:null,newStatus:null}),ee(""),se("")},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{K.quoteId&&K.newStatus&&h(K.quoteId,K.newStatus,te,Z,te),X({open:!1,quoteId:null,newStatus:null}),ee(""),se("")},disabled:!Z,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Update Status"})]})]})})]})}export{le as default};
