import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t,R as s}from"./zustand-vendor-BohoUguQ.js";import{h as a,f as r}from"./index-BALy7xcB.js";import{u as l,E as n,a as i}from"./timelineStore-CrC2_eKA.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const o={active:{bg:"bg-blue-500",border:"border-blue-600"},proposal:{bg:"bg-purple-500",border:"border-purple-600"},negotiation:{bg:"bg-amber-500",border:"border-amber-600"},won:{bg:"bg-green-500",border:"border-green-600"},lost:{bg:"bg-red-500",border:"border-red-600"},dormant:{bg:"bg-gray-500",border:"border-gray-600"}};function c({opp:t,style:s,onClick:a}){const r=o[t.status]||o.active,l=t.probability||50;return e.jsx("div",{className:`absolute h-8 rounded cursor-pointer transition-all hover:scale-y-110 hover:z-10 ${r.bg} ${r.border} border shadow-sm`,style:{...s,opacity:"lost"===t.status?.4:l/100*.5+.5},onClick:()=>a(t),title:`${t.title} - ${t.status} (${l}%)`,children:e.jsx("div",{className:"px-2 py-1 truncate text-xs text-white font-medium",children:t.title})})}function d({startDate:t,totalDays:s}){const a=((new Date).getTime()-t.getTime())/864e5/s*100;return a<0||a>100?null:e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-20",style:{left:`${a}%`},children:[e.jsx("div",{className:"absolute -top-1 -left-1 w-2 h-2 rounded-full bg-red-500"}),e.jsx("div",{className:"absolute -bottom-5 -left-4 text-[9px] text-red-400 whitespace-nowrap",children:"Today"})]})}function x({event:t,startDate:s,totalDays:a,onClick:r}){const l=(new Date(t.timestamp).getTime()-s.getTime())/864e5/a*100;if(l<0||l>100)return null;const o=n[t.type]||n[i.RESEARCH_FINDING];return e.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full cursor-pointer transition-transform hover:scale-150 z-10 ${o.bgColor} border ${o.borderColor}`,style:{left:`${l}%`},onClick:()=>r?.(t),title:`${o.label}: ${t.title}`,children:e.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 hidden group-hover:block whitespace-nowrap bg-dark-card px-2 py-1 rounded text-xs shadow-lg",children:t.title})})}function m({opportunities:i,onSelectOpportunity:m}){const h=a(e=>e.opportunities),u=i||h,{events:p,initialize:g}=l(),[b,j]=t.useState("6m"),[v,y]=t.useState("status"),[f,N]=t.useState(null),[k,w]=t.useState(null),[D,M]=t.useState(!0),[C,L]=t.useState(!1),S=s.useRef(null);t.useEffect(()=>{g()},[g]);s.useEffect(()=>{const e=()=>{L(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);const{startDate:$,endDate:T,totalDays:A}=t.useMemo(()=>{const e=new Date;let t,s;switch(b){case"3m":t=new Date(e.getFullYear(),e.getMonth()-1,1),s=new Date(e.getFullYear(),e.getMonth()+2,0);break;case"6m":t=new Date(e.getFullYear(),e.getMonth()-2,1),s=new Date(e.getFullYear(),e.getMonth()+4,0);break;case"12m":t=new Date(e.getFullYear(),e.getMonth()-3,1),s=new Date(e.getFullYear(),e.getMonth()+9,0);break;default:const a=u.filter(e=>e.createdAt||e.expectedCloseDate).flatMap(e=>[e.createdAt?new Date(e.createdAt):null,e.expectedCloseDate?new Date(e.expectedCloseDate):null]).filter(Boolean);0===a.length?(t=new Date(e.getFullYear(),e.getMonth()-2,1),s=new Date(e.getFullYear(),e.getMonth()+4,0)):(t=new Date(Math.min(...a.map(e=>e.getTime()))),s=new Date(Math.max(...a.map(e=>e.getTime()))),t.setMonth(t.getMonth()-1),s.setMonth(s.getMonth()+1))}return t.setDate(1),s.setDate(28),{startDate:t,endDate:s,totalDays:Math.max(1,(s.getTime()-t.getTime())/864e5)}},[b,u]),E=t.useMemo(()=>function(e,t){const s=[],a=new Date(e);for(a.setDate(1);a<=t;)s.push({key:`${a.getFullYear()}-${a.getMonth()}`,label:a.toLocaleDateString("en-GB",{month:"short",year:"2-digit"}),date:new Date(a)}),a.setMonth(a.getMonth()+1);return s}($,T),[$,T]),B=t.useMemo(()=>{const e={};u.forEach(t=>{let s;switch(v){case"region":s=t.region||"Other";break;case"country":s=t.country||"Unknown";break;default:s=t.status||"active"}e[s]||(e[s]=[]),e[s].push(t)});return("status"===v?["active","proposal","negotiation","won","lost","dormant"]:Object.keys(e).sort()).filter(t=>e[t]).map(t=>({key:t,label:t.charAt(0).toUpperCase()+t.slice(1),opportunities:e[t].sort((e,t)=>new Date(e.createdAt||0).getTime()-new Date(t.createdAt||0).getTime())}))},[u,v]),F=t.useMemo(()=>{const e=u.filter(e=>["active","proposal","negotiation"].includes(e.status)),t=e.reduce((e,t)=>e+(t.value||0),0),s=e.reduce((e,t)=>e+(t.value||0)*(t.probability||50)/100,0);return{total:u.length,active:e.length,totalValue:t,weightedValue:s}},[u]),z=e=>{N(e),m&&m(e)};return 0===u.length?e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-600 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-400",children:"No opportunities to display"})]}):e.jsxs("div",{ref:S,className:"space-y-4 "+(C?"bg-dark-bg p-6 overflow-auto h-screen":""),children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-1 bg-dark-card rounded-lg p-1",children:["3m","6m","12m","all"].map(t=>e.jsx("button",{onClick:()=>j(t),className:"px-3 py-1 text-xs rounded-md transition-colors "+(b===t?"bg-accent-primary/20 text-accent-primary":"text-gray-400 hover:text-gray-200"),children:"all"===t?"All":t.toUpperCase()},t))}),e.jsxs("select",{value:v,onChange:e=>y(e.target.value),className:"input-sm bg-dark-card",children:[e.jsx("option",{value:"status",children:"Group by Status"}),e.jsx("option",{value:"region",children:"Group by Region"}),e.jsx("option",{value:"country",children:"Group by Country"})]}),e.jsxs("button",{onClick:()=>M(!D),className:"px-3 py-1.5 text-xs rounded-lg flex items-center gap-1.5 transition-colors "+(D?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-dark-card text-gray-400 hover:text-gray-200"),title:"Toggle research events",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Research",D&&p.length>0&&e.jsx("span",{className:"bg-blue-500/30 px-1.5 rounded text-[10px]",children:p.length})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Active: "}),e.jsx("span",{className:"text-gray-200 font-medium",children:F.active})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Pipeline: "}),e.jsx("span",{className:"text-emerald-400 font-medium",children:r(F.totalValue,"USD")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Weighted: "}),e.jsx("span",{className:"text-amber-400 font-medium",children:r(F.weightedValue,"USD")})]}),e.jsx("button",{onClick:()=>{document.fullscreenElement?(document.exitFullscreen(),L(!1)):(S.current?.requestFullscreen(),L(!0))},className:"p-2 rounded-lg bg-dark-card hover:bg-dark-border transition-colors text-gray-400 hover:text-gray-200",title:C?"Exit fullscreen":"Enter fullscreen",children:C?e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9L4 4m0 0v4m0-4h4m6 10l5 5m0 0v-4m0 4h-4M9 15l-5 5m0 0h4m-4 0v-4m10-6l5-5m0 0h-4m4 0v4"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-dark-border bg-dark-bg/50",children:[e.jsx("div",{className:"w-48 flex-shrink-0 p-2 border-r border-dark-border",children:e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Opportunity"})}),e.jsx("div",{className:"flex-1 flex",children:E.map(t=>e.jsx("div",{className:"flex-1 p-2 text-center text-xs text-gray-400 border-r border-dark-border/50 last:border-0",style:{minWidth:"60px"},children:t.label},t.key))})]}),B.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex bg-dark-bg/30 border-b border-dark-border",children:[e.jsxs("div",{className:"w-48 flex-shrink-0 p-2 border-r border-dark-border",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-300 uppercase",children:t.label}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",t.opportunities.length,")"]})]}),e.jsx("div",{className:"flex-1"})]}),t.opportunities.map(t=>{const s=function(e,t,s,a){const r=e.createdAt?new Date(e.createdAt):t,l=e.expectedCloseDate?new Date(e.expectedCloseDate):s,n=Math.max(r.getTime(),t.getTime()),i=Math.min(l.getTime(),s.getTime()),o=(n-t.getTime())/864e5/a*100,c=Math.max((i-n)/864e5,14)/a*100;return{left:`${Math.max(0,o)}%`,width:`${Math.min(100-o,c)}%`}}(t,$,T,A),a=D?p.filter(e=>e.opportunityId===t.id||e.metadata?.opportunityId===t.id||e.metadata?.country&&e.metadata.country===t.country||e.metadata?.clientId&&e.metadata.clientId===t.clientId):[];return e.jsxs("div",{className:"flex border-b border-dark-border/50 hover:bg-white/5 "+(f?.id===t.id?"bg-accent-primary/10":""),children:[e.jsxs("div",{className:"w-48 flex-shrink-0 p-2 border-r border-dark-border",children:[e.jsx("div",{className:"text-sm text-gray-200 truncate cursor-pointer hover:text-accent-primary",onClick:()=>z(t),title:t.title,children:t.title}),e.jsxs("div",{className:"text-[10px] text-gray-500 flex items-center gap-2",children:[e.jsx("span",{children:t.country||t.region}),t.value&&e.jsx("span",{className:"text-emerald-400",children:r(t.value,t.currency||"USD")}),a.length>0&&e.jsxs("span",{className:"text-blue-400 flex items-center gap-0.5",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a.length]})]})]}),e.jsxs("div",{className:"flex-1 relative h-12 py-2 group",children:[e.jsx("div",{className:"absolute inset-0 flex",children:E.map(t=>e.jsx("div",{className:"flex-1 border-r border-dark-border/20 last:border-0"},t.key))}),e.jsx(d,{startDate:$,totalDays:A}),a.map(t=>e.jsx(x,{event:t,startDate:$,totalDays:A,onClick:e=>w(e)},t.id)),e.jsx(c,{opp:t,style:s,onClick:z})]})]},t.id)})]},t.key))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),Object.entries(o).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 rounded ${s.bg}`}),e.jsx("span",{className:"text-gray-400 capitalize",children:t})]},t))]}),f&&e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-100",children:f.title}),e.jsxs("div",{className:"text-sm text-gray-400",children:[f.country||f.region,f.client?.company&&` - ${f.client.company}`]})]}),e.jsx("button",{onClick:()=>N(null),className:"text-gray-500 hover:text-gray-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Status"}),e.jsx("p",{className:"capitalize text-gray-200",children:f.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Value"}),e.jsx("p",{className:"text-emerald-400",children:r(f.value||0,f.currency||"USD")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Probability"}),e.jsxs("p",{className:"text-gray-200",children:[f.probability||50,"%"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Expected Close"}),e.jsx("p",{className:"text-gray-200",children:f.expectedCloseDate?new Date(f.expectedCloseDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-"})]})]}),f.brief&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Brief"}),e.jsx("p",{className:"text-sm text-gray-300",children:f.brief})]}),f.nextAction&&e.jsxs("div",{className:"mt-3 p-2 bg-amber-500/10 border border-amber-500/20 rounded",children:[e.jsx("label",{className:"text-xs text-amber-400",children:"Next Action"}),e.jsx("p",{className:"text-sm text-gray-200",children:f.nextAction}),f.nextActionDate&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1",children:["Due: ",new Date(f.nextActionDate).toLocaleDateString("en-GB")]})]})]}),k&&e.jsxs("div",{className:"card p-4 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n[k.type]?.bgColor||"bg-blue-500"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-100",children:k.title}),e.jsxs("div",{className:"text-sm text-gray-400",children:[n[k.type]?.label||"Research Event"," â€¢ ",new Date(k.timestamp).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-gray-500 hover:text-gray-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),k.description&&e.jsx("p",{className:"text-sm text-gray-300 mb-3",children:k.description}),k.metadata&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[k.metadata.source&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Source"}),e.jsx("p",{className:"text-gray-200",children:k.metadata.source})]}),k.metadata.country&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Country"}),e.jsx("p",{className:"text-gray-200",children:k.metadata.country})]}),k.metadata.url&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"URL"}),e.jsx("a",{href:k.metadata.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline truncate block",children:k.metadata.url})]})]})]})]})}export{m as default};
