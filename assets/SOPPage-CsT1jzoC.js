import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{ae as s,af as r,ag as o}from"./index-DoA-9vkb.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";function n({category:t,isActive:s,onClick:r,sopCount:n,completionRate:i}){const a=o[t];return e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-3 rounded-xl font-medium transition-all flex flex-col items-center gap-1 "+(s?`${a.color} border`:"text-gray-400 hover:text-white hover:bg-white/5"),children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("span",{className:"text-sm",children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[e.jsxs("span",{children:[n," SOPs"]}),i>0&&e.jsxs("span",{className:"text-green-400",children:[i,"% done"]})]})]})}function i({percentage:t}){return e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 "+(100===t?"bg-green-500":"bg-accent-primary"),style:{width:`${t}%`}})})}function a({item:t,onToggle:s,onDelete:r,onEdit:o,isEditing:n,onEditSubmit:i,editText:a,setEditText:l}){return n?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[e.jsx("input",{type:"text",value:a,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&i(),"Escape"===e.key&&o(null)},className:"flex-1 bg-white/10 border border-white/20 rounded px-3 py-1.5 text-white text-sm focus:outline-none focus:border-accent-primary",autoFocus:!0}),e.jsx("button",{onClick:i,className:"p-1.5 text-green-400 hover:bg-green-500/20 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:()=>o(null),className:"p-1.5 text-gray-400 hover:bg-white/10 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg group transition-all cursor-pointer "+(t.completed?"bg-green-500/10":"hover:bg-white/5"),onClick:s,children:[e.jsx("button",{className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-all "+(t.completed?"bg-green-500 border-green-500":"border-gray-500 hover:border-accent-primary"),children:t.completed&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"flex-1 text-sm "+(t.completed?"text-gray-500 line-through":"text-white"),children:t.text}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-gray-400 hover:text-white hover:bg-white/10 rounded",title:"Edit",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:r,className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded",title:"Delete",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})}function l({sop:s,onToggleItem:r,onAddItem:n,onRemoveItem:l,onEditItem:c,onReset:d,onDuplicate:x,onUpdatePhotos:h,isCollapsed:p,onToggleCollapsed:m}){const[u,g]=t.useState(""),[j,v]=t.useState(null),[b,f]=t.useState(""),w=!p,y=s.checklist?.filter(e=>e.completed).length||0,N=s.checklist?.length||0,k=N>0?Math.round(y/N*100):0,C=o[s.category],L=()=>{u.trim()&&(n(s.id,u.trim()),g(""))},S=()=>{b.trim()&&j&&(c(s.id,j,b.trim()),v(null),f(""))},M=e=>{const t=s.checklist.find(t=>t.id===e);t&&(v(e),f(t.text))};return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-white/5 transition-colors",onClick:m,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${C.color} border`,children:s.category}),100===k&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-green-500/20 text-green-400 text-[10px] font-bold uppercase",children:"Complete"})]}),e.jsx("h3",{className:"text-white font-semibold",children:s.title}),s.description&&e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:s.description})]}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-white transition-transform "+(w?"rotate-180":""),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(i,{percentage:k})}),e.jsxs("span",{className:"text-sm text-gray-400 min-w-[60px] text-right",children:[y,"/",N]})]})]}),w&&e.jsxs("div",{className:"border-t border-white/10",children:[e.jsxs("div",{className:"p-4 space-y-2",children:[s.checklist?.map(t=>e.jsx(a,{item:t,onToggle:()=>r(s.id,t.id),onDelete:()=>l(s.id,t.id),onEdit:M,isEditing:j===t.id,onEditSubmit:S,editText:b,setEditText:f},t.id)),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),placeholder:"Add new checklist item...",className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-accent-primary"}),e.jsx("button",{onClick:L,disabled:!u.trim(),className:"p-2 text-accent-primary hover:bg-accent-primary/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),(s.photos,e.jsxs("div",{className:"px-4 py-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Reference Photos"}),e.jsxs("label",{className:"text-xs text-accent-primary hover:text-accent-primary/80 cursor-pointer flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Add Photo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(t&&h){const e=new FileReader;e.onload=()=>{const t=[...s.photos||[],{id:crypto.randomUUID(),url:e.result,caption:""}];h(s.id,t)},e.readAsDataURL(t)}e.target.value=""}})]})]}),s.photos?.length>0&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.photos.map((t,r)=>e.jsxs("div",{className:"relative flex-shrink-0 group",children:[e.jsx("img",{src:t.url,alt:t.caption||`Step ${r+1}`,className:"w-20 h-20 object-cover rounded-lg border border-white/10"}),e.jsx("button",{onClick:()=>{const e=s.photos.filter((e,t)=>t!==r);h(s.id,e)},className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"})]},t.id||r))})]})),e.jsx("div",{className:"flex items-center justify-between px-4 py-3 bg-white/5 border-t border-white/10",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(s.id),className:"text-xs text-gray-400 hover:text-white flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset Checklist"]}),e.jsxs("button",{onClick:()=>x(s.id),className:"text-xs text-gray-400 hover:text-white flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Duplicate"]})]})})]})]})}function c({category:s,onSave:r,onCancel:o}){const[n,i]=t.useState({title:"",description:"",category:s}),[a,l]=t.useState([""]);return e.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=a.filter(e=>e.trim()).map(e=>({id:crypto.randomUUID(),text:e.trim(),completed:!1}));r({...n,checklist:t,tags:[]})},className:"bg-white/5 border border-white/10 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Create New SOP"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Title"}),e.jsx("input",{type:"text",required:!0,value:n.title,onChange:e=>i({...n,title:e.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-accent-primary",placeholder:"e.g., Camera Setup Checklist"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Description"}),e.jsx("input",{type:"text",value:n.description,onChange:e=>i({...n,description:e.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-accent-primary",placeholder:"Brief description of this procedure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Checklist Items"}),e.jsx("div",{className:"space-y-2",children:a.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 text-sm w-6",children:[s+1,"."]}),e.jsx("input",{type:"text",value:t,onChange:e=>((e,t)=>{const s=[...a];s[e]=t,l(s)})(s,e.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-accent-primary",placeholder:"Enter checklist item..."}),a.length>1&&e.jsx("button",{type:"button",onClick:()=>(e=>{l(a.filter((t,s)=>s!==e))})(s),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))}),e.jsxs("button",{type:"button",onClick:()=>{l([...a,""])},className:"text-sm text-accent-primary hover:text-accent-primary/80 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Item"]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary px-6 py-2",children:"Create SOP"})]})]})}function d(){const{sops:i,initialize:a,isLoading:d,addSop:x,toggleChecklistItem:h,addChecklistItem:p,removeChecklistItem:m,updateChecklistItemText:u,resetChecklist:g,duplicateSop:j,updateSopPhotos:v,getCompletionPercentage:b,collapsedSops:f,toggleCollapsed:w}=s(),[y,N]=t.useState(r.OPERATIONS),[k,C]=t.useState(""),[L,S]=t.useState(!1);t.useEffect(()=>{a()},[a]);const M=t.useMemo(()=>i.filter(e=>{const t=e.category===y,s=!k||e.title.toLowerCase().includes(k.toLowerCase())||e.description?.toLowerCase().includes(k.toLowerCase())||e.checklist?.some(e=>e.text.toLowerCase().includes(k.toLowerCase()));return t&&s}),[i,y,k]),E=t.useMemo(()=>{const e={};return Object.values(r).forEach(t=>{const s=i.filter(e=>e.category===t),r=s.reduce((e,t)=>e+(t.checklist?.length||0),0),o=s.reduce((e,t)=>e+(t.checklist?.filter(e=>e.completed).length||0),0);e[t]={count:s.length,completionRate:r>0?Math.round(o/r*100):0}}),e},[i]);return d?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-dark-bg",children:e.jsx("div",{className:"text-gray-400",children:"Loading SOPs..."})}):e.jsxs("div",{className:"flex-1 flex flex-col h-full bg-dark-bg p-4 sm:p-6 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"Standard Operating Procedures"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Interactive checklists for consistent operations"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New SOP"]})]}),e.jsx("div",{className:"flex gap-2 mb-6 p-1.5 bg-white/5 rounded-xl",children:Object.values(r).map(t=>e.jsx(n,{category:t,isActive:y===t,onClick:()=>N(t),sopCount:E[t]?.count||0,completionRate:E[t]?.completionRate||0},t))}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:o[y].icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:y}),e.jsx("p",{className:"text-sm text-gray-400",children:o[y].description})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search SOPs...",value:k,onChange:e=>C(e.target.value),className:"bg-white/5 border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white text-sm w-64 focus:outline-none focus:border-accent-primary"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar",children:L?e.jsx(c,{category:y,onSave:async e=>{await x(e),S(!1)},onCancel:()=>S(!1)}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 pb-6",children:[M.map(t=>e.jsx(l,{sop:t,onToggleItem:h,onAddItem:p,onRemoveItem:m,onEditItem:u,onReset:g,onDuplicate:j,onUpdatePhotos:v,isCollapsed:f[t.id]||!1,onToggleCollapsed:()=>w(t.id)},t.id)),0===M.length&&e.jsxs("div",{className:"col-span-full py-12 text-center border-2 border-dashed border-white/10 rounded-2xl",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:k?"No SOPs match your search.":`No SOPs in ${y} yet.`}),!k&&e.jsxs("button",{onClick:()=>S(!0),className:"text-accent-primary hover:text-accent-primary/80 text-sm font-medium",children:["Create your first ",y," SOP"]})]})]})})]})}export{d as default};
