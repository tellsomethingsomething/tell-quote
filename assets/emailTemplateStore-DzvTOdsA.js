import{ah as e,E as t}from"./index-DoA-9vkb.js";import{c as a}from"./zustand-vendor-BohoUguQ.js";const l={quote_followup:{id:"quote_followup",label:"Quote Follow-up",icon:"ðŸ“‹",color:"bg-blue-500/10 text-blue-400"},intro:{id:"intro",label:"Introduction",icon:"ðŸ‘‹",color:"bg-green-500/10 text-green-400"},proposal:{id:"proposal",label:"Proposal",icon:"ðŸ“",color:"bg-purple-500/10 text-purple-400"},thank_you:{id:"thank_you",label:"Thank You",icon:"ðŸ™",color:"bg-amber-500/10 text-amber-400"},meeting_request:{id:"meeting_request",label:"Meeting Request",icon:"ðŸ“…",color:"bg-teal-500/10 text-teal-400"},check_in:{id:"check_in",label:"Check-in",icon:"ðŸ’¬",color:"bg-indigo-500/10 text-indigo-400"},custom:{id:"custom",label:"Custom",icon:"âœ¨",color:"bg-gray-500/10 text-gray-400"}},r=[{name:"clientName",label:"Client Name",default:""},{name:"contactName",label:"Contact Name",default:""},{name:"contactFirstName",label:"Contact First Name",default:""},{name:"companyName",label:"Company Name",default:""},{name:"projectName",label:"Project Name",default:""},{name:"quoteAmount",label:"Quote Amount",default:""},{name:"quoteNumber",label:"Quote Number",default:""},{name:"quoteDueDate",label:"Quote Due Date",default:""},{name:"senderName",label:"Sender Name",default:""},{name:"senderEmail",label:"Sender Email",default:""},{name:"senderPhone",label:"Sender Phone",default:""},{name:"senderTitle",label:"Sender Title",default:""},{name:"todayDate",label:"Today's Date",default:""}],s=(e,t={})=>{if(!e)return"";let a=e;return Object.entries(t).forEach(([e,t])=>{const l=new RegExp(`\\{\\{\\s*${e}\\s*\\}\\}`,"gi");a=a.replace(l,t||"")}),a=a.replace(/\{\{\s*\w+\s*\}\}/g,""),a},o=e=>{if(!e)return[];const t=e.match(/\{\{\s*(\w+)\s*\}\}/g)||[];return[...new Set(t.map(e=>e.replace(/\{\{\s*|\s*\}\}/g,"")))]},n=a(e((e,a)=>({templates:[],selectedTemplate:null,isLoading:!1,isSaving:!1,error:null,categoryFilter:null,searchQuery:"",showSharedOnly:!1,initialize:async()=>{await a().loadTemplates()},loadTemplates:async()=>{e({isLoading:!0,error:null});try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("Not authenticated");const{data:l,error:r}=await t.from("email_templates").select("*").or(`user_id.eq.${a.id},is_shared.eq.true`).order("use_count",{ascending:!1});if(r)throw r;e({templates:l||[],isLoading:!1})}catch(a){e({isLoading:!1,error:a.message})}},getTemplate:async e=>{try{const{data:a,error:l}=await t.from("email_templates").select("*").eq("id",e).single();if(l)throw l;return a}catch(a){return null}},createTemplate:async l=>{e({isSaving:!0,error:null});try{const{data:{user:s}}=await t.auth.getUser();if(!s)throw new Error("Not authenticated");const n=o(l.subject),i=o(l.body_html||l.body_text),c=[...new Set([...n,...i])].map(e=>{const t=r.find(t=>t.name===e);return{name:e,label:t?.label||e,default:t?.default||""}}),{data:u,error:m}=await t.from("email_templates").insert({user_id:s.id,name:l.name,subject:l.subject,body_html:l.body_html,body_text:l.body_text,category:l.category||"custom",variables:c,is_shared:l.is_shared||!1}).select().single();if(m)throw m;return e({templates:[u,...a().templates],isSaving:!1}),{success:!0,template:u}}catch(s){return e({isSaving:!1,error:s.message}),{success:!1,error:s.message}}},updateTemplate:async(l,s)=>{e({isSaving:!0,error:null});try{if(s.subject||s.body_html||s.body_text){const e=a().templates.find(e=>e.id===l),t=s.subject??e?.subject??"",n=s.body_html??s.body_text??e?.body_html??e?.body_text??"",i=o(t),c=o(n),u=[...new Set([...i,...c])];s.variables=u.map(e=>{const t=r.find(t=>t.name===e);return{name:e,label:t?.label||e,default:t?.default||""}})}const{data:n,error:i}=await t.from("email_templates").update(s).eq("id",l).select().single();if(i)throw i;return e({templates:a().templates.map(e=>e.id===l?n:e),selectedTemplate:a().selectedTemplate?.id===l?n:a().selectedTemplate,isSaving:!1}),{success:!0,template:n}}catch(n){return e({isSaving:!1,error:n.message}),{success:!1,error:n.message}}},deleteTemplate:async l=>{try{const{error:r}=await t.from("email_templates").delete().eq("id",l);if(r)throw r;return e({templates:a().templates.filter(e=>e.id!==l),selectedTemplate:a().selectedTemplate?.id===l?null:a().selectedTemplate}),{success:!0}}catch(r){return{success:!1,error:r.message}}},duplicateTemplate:async(e,t)=>{const l=a().templates.find(t=>t.id===e);return l?a().createTemplate({name:t||`${l.name} (Copy)`,subject:l.subject,body_html:l.body_html,body_text:l.body_text,category:l.category,is_shared:!1}):{success:!1,error:"Template not found"}},applyTemplate:async(l,r={})=>{const o=await a().getTemplate(l);return o?(await t.from("email_templates").update({use_count:o.use_count+1,last_used_at:(new Date).toISOString()}).eq("id",l),e({templates:a().templates.map(e=>e.id===l?{...e,use_count:e.use_count+1,last_used_at:(new Date).toISOString()}:e)}),{subject:s(o.subject,r),body_html:s(o.body_html,r),body_text:s(o.body_text,r),template:o}):null},getPopularTemplates:(e=5)=>[...a().templates].sort((e,t)=>t.use_count-e.use_count).slice(0,e),getTemplatesByCategory:e=>a().templates.filter(t=>t.category===e),getRecentTemplates:(e=5)=>[...a().templates].filter(e=>e.last_used_at).sort((e,t)=>new Date(t.last_used_at)-new Date(e.last_used_at)).slice(0,e),setSelectedTemplate:t=>{e({selectedTemplate:t})},setCategoryFilter:t=>{e({categoryFilter:t})},setSearchQuery:t=>{e({searchQuery:t})},setShowSharedOnly:t=>{e({showSharedOnly:t})},getFilteredTemplates:()=>{const{templates:e,categoryFilter:t,searchQuery:l,showSharedOnly:r}=a();return e.filter(e=>{if(t&&e.category!==t)return!1;if(r&&!e.is_shared)return!1;if(l){const t=l.toLowerCase(),a=e.name?.toLowerCase().includes(t),r=e.subject?.toLowerCase().includes(t),s=e.body_text?.toLowerCase().includes(t)||e.body_html?.toLowerCase().includes(t);if(!a&&!r&&!s)return!1}return!0})},reset:()=>{e({templates:[],selectedTemplate:null,isLoading:!1,isSaving:!1,error:null,categoryFilter:null,searchQuery:"",showSharedOnly:!1})}})));export{r as D,l as T,s as a,n as u};
