import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as s}from"./zustand-vendor-BohoUguQ.js";import{h as t,a as r,i as a,F as n}from"./index-DveMps46.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const i=[{code:"USD",symbol:"$",name:"US Dollar"},{code:"GBP",symbol:"Â£",name:"British Pound"},{code:"MYR",symbol:"RM",name:"Malaysian Ringgit"}],l=(e,s,t,r)=>{if(!e||s===t)return e;return e/(r[s]||n[s]||1)*(r[t]||n[t]||1)};function o(){const{items:n,sections:o,addItem:c,updateItem:d,updateItemPricing:x,updateItemCurrencyPricing:m,deleteItem:h,exportToCSV:u,importFromCSV:p,addSection:g,deleteSection:j,renameSection:v,moveSection:b,resetSectionsToDefaults:f}=t(),{rates:N}=r(),y=a(),k=s.useRef(null),w=s.useRef(null),[C,L]=s.useState("all"),[S,M]=s.useState(""),[P,B]=s.useState(!1),[I,W]=s.useState(!1),[A,D]=s.useState(null),[E,R]=s.useState(null),[T,O]=s.useState(!1),[V,$]=s.useState("USD"),[z,F]=s.useState(null),H=i.find(e=>e.code===V)||i[0],U=(e,s)=>{const t=e.currencyPricing?.[s];if(t&&void 0!==t.amount)return l(t.amount,t.baseCurrency,V,N);const r=e.pricing?.MALAYSIA?.[s]||0;return l(r,"MYR",V,N)},Y=(e,s)=>e.currencyPricing?.[s]?.baseCurrency||"MYR",Q=s.useCallback(()=>{O(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>O(!1),2e3)},[]),[q,G]=s.useState({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),[J,K]=s.useState("");s.useEffect(()=>{const e=e=>{"Escape"===e.key&&(E?R(null):P?B(!1):I&&W(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[E,P,I]),s.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const X=n.filter(e=>{const s="all"===C||e.section===C,t=!S||e.name.toLowerCase().includes(S.toLowerCase())||e.description?.toLowerCase().includes(S.toLowerCase());return s&&t}),Z=(e,s,t)=>{m(e,s,t,V),Q(),F(`${e}-${s}`),setTimeout(()=>F(null),2e3)};return e.jsxs("div",{className:"h-[calc(100vh-60px)] flex flex-col bg-dark-bg",children:[e.jsxs("div",{className:"bg-dark-bg border-b border-dark-border p-3 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between sm:justify-start gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-100",children:"Rate Card"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[n.length," services"]})]}),T&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded-full",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved"]}),e.jsx("button",{onClick:()=>{G({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),B(!0)},className:"sm:hidden btn-primary text-sm",children:"+ Add"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 sm:pb-0",children:[e.jsx("input",{type:"file",ref:k,className:"hidden",accept:".csv",onChange:e=>{const s=e.target.files[0];s&&p(s).then(e=>{e.success?(y.success(`Imported ${e.count} items successfully`),Q()):y.error("Import failed: "+e.error)}),e.target.value=""}}),e.jsx("button",{onClick:()=>k.current?.click(),className:"btn-ghost text-sm flex-shrink-0 hidden sm:flex",children:"Import CSV"}),e.jsx("button",{onClick:u,className:"btn-ghost text-sm flex-shrink-0 hidden sm:flex",children:"Export"}),e.jsxs("button",{onClick:()=>W(!0),className:"btn-secondary text-sm flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Manage "}),"Categories"]}),e.jsx("button",{onClick:()=>{G({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),B(!0)},className:"hidden sm:flex btn-primary text-sm flex-shrink-0",children:"+ Add Service"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4",children:[e.jsx("input",{type:"text",value:S,onChange:e=>M(e.target.value),placeholder:"Search services...",className:"input flex-1 sm:max-w-sm"}),e.jsxs("select",{value:C,onChange:e=>L(e.target.value),className:"input w-full sm:w-48",children:[e.jsx("option",{value:"all",children:"All Categories"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Edit in:"}),e.jsx("div",{className:"flex rounded-lg overflow-hidden border border-dark-border",children:i.map(s=>e.jsxs("button",{onClick:()=>$(s.code),className:"px-3 py-1.5 text-sm font-medium transition-colors "+(V===s.code?"bg-accent-primary text-white":"bg-dark-card text-gray-400 hover:text-white hover:bg-dark-bg"),title:s.name,children:[s.symbol," ",s.code]},s.code))})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>W(!1),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-sm shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>W(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Manage Categories"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",value:J,onChange:e=>K(e.target.value),placeholder:"New Category Name",className:"input flex-1"}),e.jsx("button",{onClick:()=>{J.trim()&&(g(J),K(""),W(!1),Q())},disabled:!J.trim(),className:"btn-primary whitespace-nowrap",children:"Add"})]}),e.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Categories (synced with Quote subsections)"}),(()=>{const s={};return o.forEach((e,t)=>{const r=e.group||"Other";s[r]||(s[r]=[]),s[r].push({...e,originalIndex:t})}),Object.entries(s).map(([s,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-medium text-gray-600 uppercase mb-1 px-2",children:s}),e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-dark-bg/50 rounded hover:bg-dark-bg transition-colors group",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:()=>{b(s.id,"up"),Q()},disabled:0===s.originalIndex,className:"text-gray-600 hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>{b(s.id,"down"),Q()},disabled:s.originalIndex===o.length-1,className:"text-gray-600 hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.jsx("input",{type:"text",value:s.name,onChange:e=>{v(s.id,e.target.value),Q()},className:"flex-1 bg-transparent text-sm text-gray-300 focus:bg-dark-bg rounded px-2 py-1 border border-transparent focus:border-dark-border"}),e.jsx("button",{onClick:()=>{confirm(`Delete category "${s.name}"? Items will be moved to 'Other'.`)&&(j(s.id),Q())},className:"text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1",title:"Delete Category",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},s.id))})]},s))})()]}),e.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:async()=>{confirm("Reset categories to sync with Quote subsections? This will replace all current categories.")&&(await f(),Q())},className:"text-xs text-gray-500 hover:text-orange-400 transition-colors",children:"Sync with Quotes"}),e.jsx("button",{onClick:()=>W(!1),className:"btn-ghost",children:"Done"})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>B(!1),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>B(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Add New Service"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Name *"}),e.jsx("input",{type:"text",value:q.name,onChange:e=>G({...q,name:e.target.value}),placeholder:"e.g. Camera Operator",className:"input",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{type:"text",value:q.description,onChange:e=>G({...q,description:e.target.value}),placeholder:"Optional description",className:"input"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsx("select",{value:q.section,onChange:e=>G({...q,section:e.target.value}),className:"input",children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unit"}),e.jsxs("select",{value:q.unit,onChange:e=>G({...q,unit:e.target.value}),className:"input",children:[e.jsx("option",{value:"day",children:"Per Day"}),e.jsx("option",{value:"item",children:"Per Item"}),e.jsx("option",{value:"project",children:"Per Project"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>B(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(!q.name.trim())return;const e=c(q);G({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),B(!1),D(e.id),Q()},className:"btn-primary",children:"Add Service"})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>R(null),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>R(null),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Edit Service"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Name *"}),e.jsx("input",{type:"text",value:E.name,onChange:e=>R({...E,name:e.target.value}),className:"input",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{type:"text",value:E.description,onChange:e=>R({...E,description:e.target.value}),placeholder:"Optional description",className:"input"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsx("select",{value:E.section,onChange:e=>R({...E,section:e.target.value}),className:"input",children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unit"}),e.jsxs("select",{value:E.unit,onChange:e=>R({...E,unit:e.target.value}),className:"input",children:[e.jsx("option",{value:"day",children:"Per Day"}),e.jsx("option",{value:"item",children:"Per Item"}),e.jsx("option",{value:"project",children:"Per Project"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>R(null),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{E?.name.trim()&&(d(E.id,{name:E.name,description:E.description,section:E.section,unit:E.unit}),R(null),Q())},className:"btn-primary",children:"Save Changes"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0!==X.length||S?0===X.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-700 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No matches found"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Try a different search term"})]}):e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>D(A===s.id?null:s.id),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-200 font-medium truncate",children:s.name}),e.jsx("span",{className:"text-xs text-gray-600 px-2 py-0.5 bg-dark-bg rounded flex-shrink-0",children:o.find(e=>e.id===s.section)?.name||"Other"})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{R({id:e.id,name:e.name,description:e.description||"",section:e.section,unit:e.unit||"day"})})(s)},className:"p-1 text-gray-600 hover:text-blue-400",title:"Edit service",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this service?")&&(h(s.id),Q())},className:"p-1 text-gray-600 hover:text-red-400",title:"Delete service",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("svg",{className:"w-5 h-5 text-gray-500 transition-transform "+(A===s.id?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),A===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-medium text-gray-500 uppercase",children:["Pricing in ",H.name," (",H.symbol,")"]}),e.jsx("span",{className:"text-xs text-gray-600",children:"Values convert automatically when switching currencies"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("label",{className:"text-xs text-gray-500",children:["Cost",Y(s,"cost")!==V&&e.jsxs("span",{className:"ml-2 text-amber-500/70",children:["(from ",Y(s,"cost"),")"]})]}),z===`${s.id}-cost`&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1 animate-pulse",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved in ",V]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg font-medium",children:H.symbol}),e.jsx("input",{type:"number",value:Math.round(100*U(s,"cost"))/100||"",onChange:e=>Z(s.id,"cost",e.target.value),className:"input text-lg pl-10 font-medium",placeholder:"0"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Your internal cost"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("label",{className:"text-xs text-gray-500",children:["Charge",Y(s,"charge")!==V&&e.jsxs("span",{className:"ml-2 text-amber-500/70",children:["(from ",Y(s,"charge"),")"]})]}),z===`${s.id}-charge`&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1 animate-pulse",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved in ",V]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg font-medium",children:H.symbol}),e.jsx("input",{type:"number",value:Math.round(100*U(s,"charge"))/100||"",onChange:e=>Z(s.id,"charge",e.target.value),className:"input text-lg pl-10 font-medium",placeholder:"0"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Client-facing rate"})]})]}),U(s,"charge")>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-dark-border/50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Margin"}),e.jsxs("span",{className:"font-medium "+((U(s,"charge")-U(s,"cost"))/U(s,"charge")*100>=30?"text-green-400":(U(s,"charge")-U(s,"cost"))/U(s,"charge")*100>=15?"text-amber-400":"text-red-400"),children:[((U(s,"charge")-U(s,"cost"))/U(s,"charge")*100).toFixed(0),"%"]})]})})]})]})]},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-700 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No services yet"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add your rates and services to use in quotes"}),e.jsx("button",{onClick:()=>B(!0),className:"btn-primary",children:"+ Add Service"})]})})]})}export{o as default};
