import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as s}from"./zustand-vendor-BohoUguQ.js";import{k as t,a as r,l as a,F as n}from"./index-D6_gHIhH.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const i=[{id:"MALAYSIA",label:"Malaysia",currencies:["MYR"],defaultCurrency:"MYR"},{id:"SEA",label:"SEA",currencies:["USD","GBP"],defaultCurrency:"USD"},{id:"GULF",label:"GCC",currencies:["USD","GBP"],defaultCurrency:"USD"},{id:"CENTRAL_ASIA",label:"Central Asia",currencies:["USD","GBP"],defaultCurrency:"USD"}],l={MYR:"RM",USD:"$",GBP:"£"};function c(){const{items:c,sections:o,addItem:d,updateItem:x,updateItemPricing:m,updateItemCurrencyPricing:u,deleteItem:h,exportToCSV:p,importFromCSV:g,addSection:j,deleteSection:v,renameSection:b,moveSection:f,resetSectionsToDefaults:N}=t(),{rates:y}=r(),k=a(),C=s.useRef(null),w=s.useRef(null),[S,L]=s.useState("all"),[M,A]=s.useState(""),[P,D]=s.useState(!1),[I,B]=s.useState(!1),[E,U]=s.useState(null),[W,R]=s.useState(null),[T,$]=s.useState(!1),[G,O]=s.useState(null),[z,F]=s.useState({SEA:"USD",GULF:"USD",CENTRAL_ASIA:"USD"}),V=(e,s,t)=>{const r=i.find(e=>e.id===s),a=z[s]||r.defaultCurrency,l=e.currencyPricing?.[s]?.[t]?.baseCurrency||r.defaultCurrency,c=e.currencyPricing?.[s]?.[t]?.amount;if(void 0!==c)return((e,s,t,r)=>e&&s!==t?e/(r[s]||n[s]||1)*(r[t]||n[t]||1):e)(c,l,a,y);return e.pricing?.[s]?.[t]||0},H=(e,s,t)=>e.currencyPricing?.[s]?.[t]?.baseCurrency,Y=s.useCallback(()=>{$(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>$(!1),2e3)},[]),[Q,_]=s.useState({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),[q,J]=s.useState("");s.useEffect(()=>{const e=e=>{"Escape"===e.key&&(W?R(null):P?D(!1):I&&B(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[W,P,I]),s.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const K=c.filter(e=>{const s="all"===S||e.section===S,t=!M||e.name.toLowerCase().includes(M.toLowerCase())||e.description?.toLowerCase().includes(M.toLowerCase());return s&&t}),X=(e,s,t,r)=>{const a=i.find(e=>e.id===s),n=z[s]||a.defaultCurrency;u(e,s,t,r,n),Y(),O(`${e}-${s}-${t}`),setTimeout(()=>O(null),2e3)};return e.jsxs("div",{className:"h-[calc(100vh-60px)] flex flex-col bg-dark-bg",children:[e.jsxs("div",{className:"bg-dark-bg border-b border-dark-border p-3 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between sm:justify-start gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-100",children:"Rate Card"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c.length," services"]})]}),T&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded-full",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved"]}),e.jsx("button",{onClick:()=>{_({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),D(!0)},className:"sm:hidden btn-primary text-sm",children:"+ Add"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 sm:pb-0",children:[e.jsx("input",{type:"file",ref:C,className:"hidden",accept:".csv",onChange:e=>{const s=e.target.files[0];s&&g(s).then(e=>{e.success?(k.success(`Imported ${e.count} items successfully`),Y()):k.error("Import failed: "+e.error)}),e.target.value=""}}),e.jsx("button",{onClick:()=>C.current?.click(),className:"btn-ghost text-sm flex-shrink-0 hidden sm:flex",children:"Import CSV"}),e.jsx("button",{onClick:p,className:"btn-ghost text-sm flex-shrink-0 hidden sm:flex",children:"Export"}),e.jsxs("button",{onClick:()=>B(!0),className:"btn-secondary text-sm flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Manage "}),"Categories"]}),e.jsx("button",{onClick:()=>{_({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),D(!0)},className:"hidden sm:flex btn-primary text-sm flex-shrink-0",children:"+ Add Service"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4",children:[e.jsx("input",{type:"text",value:M,onChange:e=>A(e.target.value),placeholder:"Search services...",className:"input flex-1 sm:max-w-sm"}),e.jsxs("select",{value:S,onChange:e=>L(e.target.value),className:"input w-full sm:w-48",children:[e.jsx("option",{value:"all",children:"All Categories"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>B(!1),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-sm shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>B(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Manage Categories"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",value:q,onChange:e=>J(e.target.value),placeholder:"New Category Name",className:"input flex-1"}),e.jsx("button",{onClick:()=>{q.trim()&&(j(q),J(""),B(!1),Y())},disabled:!q.trim(),className:"btn-primary whitespace-nowrap",children:"Add"})]}),e.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Categories (synced with Quote subsections)"}),(()=>{const s={};return o.forEach((e,t)=>{const r=e.group||"Other";s[r]||(s[r]=[]),s[r].push({...e,originalIndex:t})}),Object.entries(s).map(([s,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-medium text-gray-600 uppercase mb-1 px-2",children:s}),e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-dark-bg/50 rounded hover:bg-dark-bg transition-colors group",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:()=>{f(s.id,"up"),Y()},disabled:0===s.originalIndex,className:"text-gray-600 hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>{f(s.id,"down"),Y()},disabled:s.originalIndex===o.length-1,className:"text-gray-600 hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.jsx("input",{type:"text",value:s.name,onChange:e=>{b(s.id,e.target.value),Y()},className:"flex-1 bg-transparent text-sm text-gray-300 focus:bg-dark-bg rounded px-2 py-1 border border-transparent focus:border-dark-border"}),e.jsx("button",{onClick:()=>{confirm(`Delete category "${s.name}"? Items will be moved to 'Other'.`)&&(v(s.id),Y())},className:"text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1",title:"Delete Category",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},s.id))})]},s))})()]}),e.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:async()=>{confirm("Reset categories to sync with Quote subsections? This will replace all current categories.")&&(await N(),Y())},className:"text-xs text-gray-500 hover:text-orange-400 transition-colors",children:"Sync with Quotes"}),e.jsx("button",{onClick:()=>B(!1),className:"btn-ghost",children:"Done"})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>D(!1),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>D(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Add New Service"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Name *"}),e.jsx("input",{type:"text",value:Q.name,onChange:e=>_({...Q,name:e.target.value}),placeholder:"e.g. Camera Operator",className:"input",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{type:"text",value:Q.description,onChange:e=>_({...Q,description:e.target.value}),placeholder:"Optional description",className:"input"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsx("select",{value:Q.section,onChange:e=>_({...Q,section:e.target.value}),className:"input",children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unit"}),e.jsxs("select",{value:Q.unit,onChange:e=>_({...Q,unit:e.target.value}),className:"input",children:[e.jsx("option",{value:"day",children:"Per Day"}),e.jsx("option",{value:"item",children:"Per Item"}),e.jsx("option",{value:"project",children:"Per Project"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>D(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(!Q.name.trim())return;const e=d(Q);_({name:"",description:"",section:o[0]?.id||"other",unit:"day"}),D(!1),U(e.id),Y()},className:"btn-primary",children:"Add Service"})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/75 backdrop-blur-md modal-backdrop",onClick:()=>R(null),children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl modal-content relative",onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:()=>R(null),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white rounded-lg hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-lg font-bold text-gray-100 mb-4",children:"Edit Service"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Name *"}),e.jsx("input",{type:"text",value:W.name,onChange:e=>R({...W,name:e.target.value}),className:"input",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{type:"text",value:W.description,onChange:e=>R({...W,description:e.target.value}),placeholder:"Optional description",className:"input"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsx("select",{value:W.section,onChange:e=>R({...W,section:e.target.value}),className:"input",children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unit"}),e.jsxs("select",{value:W.unit,onChange:e=>R({...W,unit:e.target.value}),className:"input",children:[e.jsx("option",{value:"day",children:"Per Day"}),e.jsx("option",{value:"item",children:"Per Item"}),e.jsx("option",{value:"project",children:"Per Project"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>R(null),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{W?.name.trim()&&(x(W.id,{name:W.name,description:W.description,section:W.section,unit:W.unit}),R(null),Y())},className:"btn-primary",children:"Save Changes"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0!==K.length||M?0===K.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-700 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No matches found"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Try a different search term"})]}):e.jsx("div",{className:"space-y-2",children:K.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>U(E===s.id?null:s.id),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-200 font-medium truncate",children:s.name}),e.jsx("span",{className:"text-xs text-gray-600 px-2 py-0.5 bg-dark-bg rounded flex-shrink-0",children:o.find(e=>e.id===s.section)?.name||"Other"})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{R({id:e.id,name:e.name,description:e.description||"",section:e.section,unit:e.unit||"day"})})(s)},className:"p-1 text-gray-600 hover:text-blue-400",title:"Edit service",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this service?")&&(h(s.id),Y())},className:"p-1 text-gray-600 hover:text-red-400",title:"Delete service",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("svg",{className:"w-5 h-5 text-gray-500 transition-transform "+(E===s.id?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),E===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-3",children:"Regional Pricing"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:i.map(t=>{const r=z[t.id]||t.defaultCurrency,a=l[r],n=t.currencies.length>1;return e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-400",children:t.label}),n?e.jsx("div",{className:"flex rounded overflow-hidden border border-dark-border",children:t.currencies.map(s=>e.jsx("button",{onClick:()=>F(e=>({...e,[t.id]:s})),className:"px-2 py-0.5 text-xs font-medium transition-colors "+(r===s?"bg-accent-primary text-white":"bg-dark-card text-gray-500 hover:text-white"),children:l[s]},s))}):e.jsx("span",{className:"text-xs text-gray-600",children:a})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Cost"}),G===`${s.id}-${t.id}-cost`&&e.jsx("span",{className:"text-[10px] text-green-400",children:"✓ Saved"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500 text-sm",children:a}),e.jsx("input",{type:"number",value:Math.round(100*V(s,t.id,"cost"))/100||"",onChange:e=>X(s.id,t.id,"cost",e.target.value),className:"input text-sm pl-7",placeholder:"0"})]}),H(s,t.id,"cost")&&H(s,t.id,"cost")!==r&&e.jsxs("span",{className:"text-[10px] text-amber-500/70",children:["from ",H(s,t.id,"cost")]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Charge"}),G===`${s.id}-${t.id}-charge`&&e.jsx("span",{className:"text-[10px] text-green-400",children:"✓ Saved"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500 text-sm",children:a}),e.jsx("input",{type:"number",value:Math.round(100*V(s,t.id,"charge"))/100||"",onChange:e=>X(s.id,t.id,"charge",e.target.value),className:"input text-sm pl-7",placeholder:"0"})]}),H(s,t.id,"charge")&&H(s,t.id,"charge")!==r&&e.jsxs("span",{className:"text-[10px] text-amber-500/70",children:["from ",H(s,t.id,"charge")]})]})]})]},t.id)})})]})]},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-700 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No services yet"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add your rates and services to use in quotes"}),e.jsx("button",{onClick:()=>D(!0),className:"btn-primary",children:"+ Add Service"})]})})]})}export{c as default};
