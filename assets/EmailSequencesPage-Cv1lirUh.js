import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{c as t,r as s,R as r}from"./zustand-vendor-BohoUguQ.js";import{o as a,ah as n,E as l,aJ as c,t as i,U as d,a2 as o,X as u,O as m}from"./index-Civi5K2Q.js";import{u as x}from"./emailTemplateStore-Db_dC89C.js";import{P as g}from"./play-D3z7_ZeK.js";import{C as p}from"./chart-column-LV9JMBC6.js";import{S as h}from"./search-CrHhslMI.js";import{F as b}from"./funnel-B4nh27xC.js";import{E as f}from"./ellipsis-vertical-t94smgPX.js";import{E as j}from"./eye-C0wIZdIG.js";import{P as y,S as w}from"./save-C2JwvVnc.js";import{C as v}from"./copy-RJicU1i1.js";import{P as N}from"./pause-CV6iLg5C.js";import{T as _}from"./trash-2-CBs7w6jh.js";import{M as q}from"./message-square-goDgpg2Q.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const S=a("mouse-pointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]),k={draft:{label:"Draft",color:"text-gray-400",bgColor:"bg-gray-500/20"},active:{label:"Active",color:"text-green-400",bgColor:"bg-green-500/20"},paused:{label:"Paused",color:"text-yellow-400",bgColor:"bg-yellow-500/20"},archived:{label:"Archived",color:"text-red-400",bgColor:"bg-red-500/20"}},C={delay_days:{label:"Wait X days",icon:"â°"},delay_hours:{label:"Wait X hours",icon:"â±ï¸"},on_open:{label:"When email opened",icon:"ðŸ‘ï¸"},on_click:{label:"When link clicked",icon:"ðŸ”—"},on_reply:{label:"When replied",icon:"â†©ï¸"},on_no_open:{label:"If not opened after X days",icon:"â“"}},O={sales:{label:"Sales Outreach",icon:"ðŸ’°",color:"text-green-400"},followup:{label:"Follow-up",icon:"ðŸ“‹",color:"text-blue-400"},onboarding:{label:"Onboarding",icon:"ðŸŽ¯",color:"text-purple-400"},nurture:{label:"Nurture",icon:"ðŸŒ±",color:"text-teal-400"},reengagement:{label:"Re-engagement",icon:"ðŸ”„",color:"text-amber-400"},event:{label:"Event",icon:"ðŸ“…",color:"text-pink-400"}},D=t(n((e,t)=>({sequences:[],enrollments:[],selectedSequence:null,isLoading:!1,isSaving:!1,error:null,initialize:async()=>{await t().loadSequences()},loadSequences:async()=>{e({isLoading:!0,error:null});try{const{data:{user:t}}=await l.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:s,error:r}=await l.from("email_sequences").select("\n                        *,\n                        steps:email_sequence_steps(*)\n                    ").eq("user_id",t.id).order("created_at",{ascending:!1});if(r)throw r;e({sequences:s||[],isLoading:!1})}catch(t){e({isLoading:!1,error:t.message})}},getSequence:async t=>{try{const{data:s,error:r}=await l.from("email_sequences").select("\n                        *,\n                        steps:email_sequence_steps(*),\n                        enrollments:email_sequence_enrollments(\n                            *,\n                            sends:email_sequence_sends(*)\n                        )\n                    ").eq("id",t).single();if(r)throw r;return e({selectedSequence:s}),{success:!0,sequence:s}}catch(s){return{success:!1,error:s.message}}},createSequence:async s=>{e({isSaving:!0,error:null});try{const{data:{user:r}}=await l.auth.getUser();if(!r)throw new Error("Not authenticated");const{data:a,error:n}=await l.from("email_sequences").insert({user_id:r.id,name:s.name,description:s.description,category:s.category||"sales",status:"draft",settings:s.settings||{sendOnWeekends:!1,sendTime:"09:00",timezone:"UTC",stopOnReply:!0,stopOnMeeting:!0}}).select().single();if(n)throw n;return e({sequences:[a,...t().sequences],isSaving:!1}),{success:!0,sequence:a}}catch(r){return e({isSaving:!1,error:r.message}),{success:!1,error:r.message}}},updateSequence:async(s,r)=>{e({isSaving:!0,error:null});try{const{data:a,error:n}=await l.from("email_sequences").update({...r,updated_at:(new Date).toISOString()}).eq("id",s).select().single();if(n)throw n;return e({sequences:t().sequences.map(e=>e.id===s?{...e,...a}:e),selectedSequence:t().selectedSequence?.id===s?{...t().selectedSequence,...a}:t().selectedSequence,isSaving:!1}),{success:!0,sequence:a}}catch(a){return e({isSaving:!1,error:a.message}),{success:!1,error:a.message}}},deleteSequence:async s=>{try{const{error:r}=await l.from("email_sequences").delete().eq("id",s);if(r)throw r;return e({sequences:t().sequences.filter(e=>e.id!==s),selectedSequence:t().selectedSequence?.id===s?null:t().selectedSequence}),{success:!0}}catch(r){return{success:!1,error:r.message}}},setSequenceStatus:async(e,s)=>await t().updateSequence(e,{status:s}),addStep:async(s,r)=>{try{const{data:a}=await l.from("email_sequence_steps").select("step_order").eq("sequence_id",s).order("step_order",{ascending:!1}).limit(1),n=a?.length?a[0].step_order+1:1,{data:c,error:i}=await l.from("email_sequence_steps").insert({sequence_id:s,step_order:n,name:r.name||`Step ${n}`,subject:r.subject,body:r.body,template_id:r.template_id,trigger_type:r.trigger_type||"delay_days",trigger_value:r.trigger_value||1,is_active:!0}).select().single();if(i)throw i;return t().selectedSequence?.id===s&&e({selectedSequence:{...t().selectedSequence,steps:[...t().selectedSequence.steps||[],c]}}),{success:!0,step:c}}catch(a){return{success:!1,error:a.message}}},updateStep:async(s,r)=>{try{const{data:a,error:n}=await l.from("email_sequence_steps").update(r).eq("id",s).select().single();if(n)throw n;return t().selectedSequence&&e({selectedSequence:{...t().selectedSequence,steps:t().selectedSequence.steps?.map(e=>e.id===s?a:e)}}),{success:!0,step:a}}catch(a){return{success:!1,error:a.message}}},deleteStep:async s=>{try{const{error:r}=await l.from("email_sequence_steps").delete().eq("id",s);if(r)throw r;return t().selectedSequence&&e({selectedSequence:{...t().selectedSequence,steps:t().selectedSequence.steps?.filter(e=>e.id!==s)}}),{success:!0}}catch(r){return{success:!1,error:r.message}}},reorderSteps:async(e,s)=>{try{for(let e=0;e<s.length;e++)await l.from("email_sequence_steps").update({step_order:e+1}).eq("id",s[e]);return await t().getSequence(e),{success:!0}}catch(r){return{success:!1,error:r.message}}},loadEnrollments:async t=>{try{const{data:s,error:r}=await l.from("email_sequence_enrollments").select("\n                        *,\n                        sends:email_sequence_sends(*)\n                    ").eq("sequence_id",t).order("enrolled_at",{ascending:!1});if(r)throw r;return e({enrollments:s||[]}),{success:!0,enrollments:s}}catch(s){return{success:!1,error:s.message}}},enrollContact:async(s,r)=>{try{const{data:{user:a}}=await l.auth.getUser();if(!a)throw new Error("Not authenticated");const{data:n}=await l.from("email_sequence_enrollments").select("id").eq("sequence_id",s).eq("contact_email",r.email).eq("status","active").single();if(n)return{success:!1,error:"Contact already enrolled in this sequence"};const{data:c,error:i}=await l.from("email_sequence_enrollments").insert({sequence_id:s,contact_id:r.contact_id,contact_email:r.email,contact_name:r.name,opportunity_id:r.opportunity_id,status:"active",current_step:1,enrolled_at:(new Date).toISOString(),next_send_at:E(new Date),metadata:r.metadata||{}}).select().single();if(i)throw i;return e({enrollments:[c,...t().enrollments]}),{success:!0,enrollment:c}}catch(a){return{success:!1,error:a.message}}},unenrollContact:async(s,r="manual")=>{try{const{data:a,error:n}=await l.from("email_sequence_enrollments").update({status:"paused",completed_at:(new Date).toISOString(),metadata:{unenrollReason:r}}).eq("id",s).select().single();if(n)throw n;return e({enrollments:t().enrollments.map(e=>e.id===s?a:e)}),{success:!0}}catch(a){return{success:!1,error:a.message}}},enrollOpportunityContacts:async(e,s)=>{try{const{data:r,error:a}=await l.from("contacts").select("id, email, name").eq("opportunity_id",s);if(a)throw a;const n=[];for(const l of r||[])if(l.email){const r=await t().enrollContact(e,{contact_id:l.id,email:l.email,name:l.name,opportunity_id:s});n.push(r)}return{success:!0,enrolled:n.filter(e=>e.success).length,failed:n.filter(e=>!e.success).length}}catch(r){return{success:!1,error:r.message}}},processEnrollments:async()=>{try{const e=new Date,{data:s,error:r}=await l.from("email_sequence_enrollments").select("\n                        *,\n                        sequence:email_sequences(\n                            *,\n                            steps:email_sequence_steps(*)\n                        )\n                    ").eq("status","active").lte("next_send_at",e.toISOString()).limit(50);if(r)throw r;for(const a of s||[])await t().processEnrollment(a);return{success:!0,processed:s?.length||0}}catch(e){return{success:!1,error:e.message}}},processEnrollment:async e=>{try{const s=e.sequence,r=s.steps?.find(t=>t.step_order===e.current_step);if(!r)return void(await l.from("email_sequence_enrollments").update({status:"completed",completed_at:(new Date).toISOString()}).eq("id",e.id));const a=await t().sendSequenceEmail(e,r);if(a.success){await l.from("email_sequence_sends").insert({enrollment_id:e.id,step_id:r.id,sent_at:(new Date).toISOString(),message_id:a.messageId,status:"sent"});const t=s.steps?.find(t=>t.step_order===e.current_step+1);if(t){const s=function(e){const t=new Date;switch(e.trigger_type){case"delay_days":const s=new Date(t);return s.setDate(s.getDate()+(e.trigger_value||1)),E(s);case"delay_hours":const r=new Date(t);return r.setHours(r.getHours()+(e.trigger_value||1)),r;default:return E(t)}}(t);await l.from("email_sequence_enrollments").update({current_step:e.current_step+1,next_send_at:s.toISOString()}).eq("id",e.id)}else await l.from("email_sequence_enrollments").update({status:"completed",completed_at:(new Date).toISOString()}).eq("id",e.id)}}catch(s){}},sendSequenceEmail:async(e,t)=>{try{return{success:!0,messageId:`seq-${Date.now()}`}}catch(s){return{success:!1,error:s.message}}},getSequenceStats:async e=>{try{const{data:t}=await l.from("email_sequence_enrollments").select("status").eq("sequence_id",e),{data:s}=await l.from("email_sequence_sends").select("status, opened_at, clicked_at, replied_at").eq("enrollment_id",t?.map(e=>e.id)||[]),r=t?.length||0,a=t?.filter(e=>"active"===e.status).length||0,n=t?.filter(e=>"completed"===e.status).length||0,c=s?.length||0,i=s?.filter(e=>e.opened_at).length||0,d=s?.filter(e=>e.clicked_at).length||0,o=s?.filter(e=>e.replied_at).length||0;return{totalEnrolled:r,active:a,completed:n,totalSent:c,openRate:c>0?Math.round(i/c*100):0,clickRate:i>0?Math.round(d/i*100):0,replyRate:c>0?Math.round(o/c*100):0}}catch(t){return null}},setSelectedSequence:t=>{e({selectedSequence:t})},reset:()=>{e({sequences:[],enrollments:[],selectedSequence:null,isLoading:!1,isSaving:!1,error:null})}})));function E(e){const t=new Date(e);for(t.setHours(9,0,0,0),t<=e&&t.setDate(t.getDate()+1);0===t.getDay()||6===t.getDay();)t.setDate(t.getDate()+1);return t}function W(e,t){switch(e){case"delay_days":return`Wait ${t} day${1!==t?"s":""}`;case"delay_hours":return`Wait ${t} hour${1!==t?"s":""}`;case"on_open":return"When email is opened";case"on_click":return"When link is clicked";case"on_reply":return"When replied";case"on_no_open":return`If not opened after ${t} day${1!==t?"s":""}`;default:return e}}function R({sequence:t,onEdit:a,onView:n,onToggle:l,onDelete:c,onDuplicate:i}){const[u,m]=s.useState(!1),[x,p]=s.useState(null),{getSequenceStats:h}=D(),b=k[t.status]||k.draft,w=O[t.category]||O.sales;return s.useEffect(()=>{h(t.id).then(p)},[t.id]),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4 hover:border-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${w.color} bg-dark-bg`,children:e.jsx("span",{className:"text-xl",children:w.icon})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:w.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${b.bgColor} ${b.color}`,children:b.label}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>m(!u),className:"p-1.5 text-gray-400 hover:text-white rounded transition-colors",children:e.jsx(f,{className:"w-4 h-4"})}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-dark-nav border border-dark-border rounded-lg shadow-xl z-20 py-1",children:[e.jsxs("button",{onClick:()=>{n(t),m(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"View Details"]}),e.jsxs("button",{onClick:()=>{a(t),m(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>{i(t),m(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("button",{onClick:()=>{l(t),m(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:"active"===t.status?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4"}),"Activate"]})}),e.jsx("hr",{className:"my-1 border-dark-border"}),e.jsxs("button",{onClick:()=>{c(t),m(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Delete"]})]})]})]})]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.steps?.length||0," step",1!==t.steps?.length?"s":""]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 overflow-hidden",children:[t.steps?.slice(0,4).map((s,a)=>e.jsxs(r.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 rounded bg-dark-bg flex items-center justify-center text-xs text-gray-400",children:a+1}),a<Math.min(t.steps.length-1,3)&&e.jsx(o,{className:"w-3 h-3 text-gray-600 flex-shrink-0"})]},s.id)),t.steps?.length>4&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.steps.length-4]})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-4 pt-3 border-t border-dark-border text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-400",children:[e.jsx(d,{className:"w-3 h-3"}),e.jsxs("span",{children:[x.totalEnrolled," enrolled"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(j,{className:"w-3 h-3"}),e.jsxs("span",{children:[x.openRate,"% open"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-blue-400",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsxs("span",{children:[x.clickRate,"% click"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-purple-400",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{children:[x.replyRate,"% reply"]})]})]})]})}function $({sequence:t,onClose:r}){const{createSequence:a,updateSequence:n,addStep:l,updateStep:d,deleteStep:o}=D(),{templates:g}=x(),[p,h]=s.useState(!1),[b,f]=s.useState(null),[j,v]=s.useState("details"),[N,q]=s.useState({name:t?.name||"",description:t?.description||"",category:t?.category||"sales",settings:t?.settings||{sendOnWeekends:!1,sendTime:"09:00",timezone:"UTC",stopOnReply:!0,stopOnMeeting:!0}}),[S,k]=s.useState(t?.steps||[]),[C,E]=s.useState(null),R=()=>{const e={id:`temp-${Date.now()}`,step_order:S.length+1,name:`Step ${S.length+1}`,subject:"",body:"",trigger_type:"delay_days",trigger_value:0===S.length?0:1,is_active:!0};k([...S,e]),E(e)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg w-full max-w-3xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-teal/20 flex items-center justify-center",children:e.jsx(i,{className:"w-5 h-5 text-brand-teal"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t?"Edit Sequence":"Create Sequence"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Build automated email campaigns"})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(u,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-dark-border",children:[e.jsx("button",{onClick:()=>v("details"),className:"px-6 py-3 text-sm font-medium transition-colors "+("details"===j?"text-brand-teal border-b-2 border-brand-teal":"text-gray-400 hover:text-white"),children:"Details"}),e.jsxs("button",{onClick:()=>v("steps"),className:"px-6 py-3 text-sm font-medium transition-colors "+("steps"===j?"text-brand-teal border-b-2 border-brand-teal":"text-gray-400 hover:text-white"),children:["Steps (",S.length,")"]}),e.jsx("button",{onClick:()=>v("settings"),className:"px-6 py-3 text-sm font-medium transition-colors "+("settings"===j?"text-brand-teal border-b-2 border-brand-teal":"text-gray-400 hover:text-white"),children:"Settings"})]}),e.jsxs("div",{className:"p-6",children:[b&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 mb-4",children:[e.jsx(m,{className:"w-5 h-5"}),e.jsx("span",{children:b})]}),"details"===j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Sequence Name *"}),e.jsx("input",{type:"text",value:N.name,onChange:e=>q(t=>({...t,name:e.target.value})),placeholder:"e.g., New Lead Follow-up",className:"w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:N.description,onChange:e=>q(t=>({...t,description:e.target.value})),placeholder:"What is this sequence for?",rows:3,className:"w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Category"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(O).map(([t,s])=>e.jsxs("button",{type:"button",onClick:()=>q(e=>({...e,category:t})),className:"p-3 rounded-lg border text-left transition-colors "+(N.category===t?"border-brand-teal bg-brand-teal/10":"border-dark-border hover:border-gray-600"),children:[e.jsx("span",{className:"text-xl",children:s.icon}),e.jsx("p",{className:`text-sm mt-1 ${s.color}`,children:s.label})]},t))})]})]}),"steps"===j&&e.jsx("div",{className:"space-y-4",children:0===S.length?e.jsxs("div",{className:"text-center py-8 bg-dark-bg rounded-lg border border-dashed border-dark-border",children:[e.jsx(i,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"No steps yet"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Add steps to build your email sequence"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors",children:"Add First Step"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:S.map((s,r)=>e.jsxs("div",{className:"border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-dark-bg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-teal/20 text-brand-teal flex items-center justify-center font-medium",children:r+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-white",children:s.name}),e.jsx("p",{className:"text-xs text-gray-400",children:W(s.trigger_type,s.trigger_value)})]}),e.jsx("button",{onClick:()=>E(s),className:"p-1.5 text-gray-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async e=>{t&&!e.startsWith("temp-")&&await o(e),k(S.filter(t=>t.id!==e))})(s.id),className:"p-1.5 text-gray-400 hover:text-red-400 transition-colors",children:e.jsx(_,{className:"w-4 h-4"})})]}),s.subject&&e.jsx("div",{className:"px-4 py-2 border-t border-dark-border",children:e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"text-gray-500",children:"Subject:"})," ",s.subject]})})]},s.id))}),e.jsxs("button",{onClick:R,className:"w-full px-4 py-3 border border-dashed border-dark-border rounded-lg text-gray-400 hover:text-white hover:border-gray-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"}),"Add Step"]})]})}),"settings"===j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Send on weekends"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow emails to be sent on Saturday/Sunday"})]}),e.jsx("button",{type:"button",onClick:()=>q(e=>({...e,settings:{...e.settings,sendOnWeekends:!e.settings.sendOnWeekends}})),className:"w-12 h-6 rounded-full transition-colors relative "+(N.settings.sendOnWeekends?"bg-brand-teal":"bg-gray-700"),children:e.jsx("div",{className:"absolute top-1 w-4 h-4 rounded-full bg-white transition-transform "+(N.settings.sendOnWeekends?"translate-x-7":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Stop on reply"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Stop sequence when contact replies"})]}),e.jsx("button",{type:"button",onClick:()=>q(e=>({...e,settings:{...e.settings,stopOnReply:!e.settings.stopOnReply}})),className:"w-12 h-6 rounded-full transition-colors relative "+(N.settings.stopOnReply?"bg-brand-teal":"bg-gray-700"),children:e.jsx("div",{className:"absolute top-1 w-4 h-4 rounded-full bg-white transition-transform "+(N.settings.stopOnReply?"translate-x-7":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Stop on meeting"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Stop when a meeting is scheduled"})]}),e.jsx("button",{type:"button",onClick:()=>q(e=>({...e,settings:{...e.settings,stopOnMeeting:!e.settings.stopOnMeeting}})),className:"w-12 h-6 rounded-full transition-colors relative "+(N.settings.stopOnMeeting?"bg-brand-teal":"bg-gray-700"),children:e.jsx("div",{className:"absolute top-1 w-4 h-4 rounded-full bg-white transition-transform "+(N.settings.stopOnMeeting?"translate-x-7":"translate-x-1")})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Preferred send time"}),e.jsx("input",{type:"time",value:N.settings.sendTime,onChange:e=>q(t=>({...t,settings:{...t.settings,sendTime:e.target.value}})),className:"w-48 px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-brand-teal"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-dark-border",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{if(f(null),N.name.trim()){h(!0);try{if(t)await n(t.id,N);else{const e=await a(N);if(!e.success)throw new Error(e.error)}r()}catch(e){f(e.message)}finally{h(!1)}}else f("Sequence name is required")},disabled:p,className:"flex items-center gap-2 px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors disabled:opacity-50",children:[p?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(w,{className:"w-4 h-4"}),t?"Save Changes":"Create Sequence"]})]}),C&&e.jsx(A,{step:C,templates:g,onSave:async e=>{t&&!e.id.startsWith("temp-")?await d(e.id,e):t&&await l(t.id,e),k(S.map(t=>t.id===e.id?e:t)),E(null)},onClose:()=>E(null)})]})})}function A({step:t,templates:r,onSave:a,onClose:n}){const[l,c]=s.useState({...t});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-dark-nav border border-dark-border rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[e.jsx("h3",{className:"font-medium text-white",children:"Edit Step"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:e.jsx(u,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Step Name"}),e.jsx("input",{type:"text",value:l.name,onChange:e=>c(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Trigger"}),e.jsx("select",{value:l.trigger_type,onChange:e=>c(t=>({...t,trigger_type:e.target.value})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-brand-teal",children:Object.entries(C).map(([t,s])=>e.jsxs("option",{value:t,children:[s.icon," ",s.label]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Value"}),e.jsx("input",{type:"number",value:l.trigger_value,onChange:e=>c(t=>({...t,trigger_value:parseInt(e.target.value)||0})),min:0,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-brand-teal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Template"}),e.jsxs("select",{value:l.template_id||"",onChange:e=>c(t=>({...t,template_id:e.target.value||null})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Custom email"}),r?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),!l.template_id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:l.subject||"",onChange:e=>c(t=>({...t,subject:e.target.value})),placeholder:"Email subject line",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Body"}),e.jsx("textarea",{value:l.body||"",onChange:e=>c(t=>({...t,body:e.target.value})),placeholder:"Email body content",rows:6,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal resize-none"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 px-4 py-3 border-t border-dark-border",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:()=>{a(l)},className:"px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90",children:"Save Step"})]})]})})}function T(){const{sequences:t,isLoading:r,loadSequences:a,setSequenceStatus:n,deleteSequence:l}=D(),[o,u]=s.useState(""),[m,x]=s.useState("all"),[f,j]=s.useState("all"),[y,w]=s.useState(!1),[v,N]=s.useState(null),[_,q]=s.useState(null);s.useEffect(()=>{a()},[]);const S=t.filter(e=>{const t=!o||e.name.toLowerCase().includes(o.toLowerCase())||e.description?.toLowerCase().includes(o.toLowerCase()),s="all"===m||e.status===m,r="all"===f||e.category===f;return t&&s&&r}),C=e=>{N(e),w(!0)},E=e=>{N(e),w(!0)},W=async e=>{const t="active"===e.status?"paused":"active";await n(e.id,t)},A=e=>{q(e)},T=async e=>{N({...e,id:null,name:`${e.name} (Copy)`,status:"draft"}),w(!0)};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Email Sequences"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Automated multi-step email campaigns"})]}),e.jsxs("button",{onClick:()=>{N(null),w(!0)},className:"flex items-center gap-2 px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors",children:[e.jsx(c,{className:"w-4 h-4"}),"New Sequence"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Total Sequences"}),e.jsx(i,{className:"w-4 h-4 text-brand-teal"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Active"}),e.jsx(g,{className:"w-4 h-4 text-green-400"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:t.filter(e=>"active"===e.status).length})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Enrolled"}),e.jsx(d,{className:"w-4 h-4 text-blue-400"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:"--"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Avg Open Rate"}),e.jsx(p,{className:"w-4 h-4 text-purple-400"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:"--%"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search sequences...",value:o,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-card border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-gray-300 focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"all",children:"All Status"}),Object.entries(k).map(([t,s])=>e.jsx("option",{value:t,children:s.label},t))]}),e.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-gray-300 focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries(O).map(([t,s])=>e.jsxs("option",{value:t,children:[s.icon," ",s.label]},t))]})]})]}),r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-brand-teal border-t-transparent rounded-full"})}):0===S.length?e.jsxs("div",{className:"text-center py-12 bg-dark-card border border-dark-border rounded-lg",children:[e.jsx(i,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:0===t.length?"No sequences yet":"No matching sequences"}),e.jsx("p",{className:"text-gray-400 mb-4",children:0===t.length?"Create your first email sequence to automate outreach":"Try adjusting your search or filters"}),0===t.length&&e.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors",children:"Create Sequence"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(t=>e.jsx(R,{sequence:t,onEdit:C,onView:E,onToggle:W,onDelete:A,onDuplicate:T},t.id))}),y&&e.jsx($,{sequence:v,onClose:()=>{w(!1),N(null)}}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Sequence"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:['Are you sure you want to delete "',_.name,'"? All enrollments will be stopped.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>q(null),className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{_&&(await l(_.id),q(null))},className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete"})]})]})})]})}export{T as default};
