import{ah as t,D as e,E as r}from"./index-g2Iar00F.js";import{c as i}from"./zustand-vendor-BohoUguQ.js";const a="tell_crm_contacts",n=[{id:"decision_maker",label:"Decision Maker",color:"bg-purple-500",description:"Has authority to approve/reject"},{id:"influencer",label:"Influencer",color:"bg-blue-500",description:"Influences the decision"},{id:"champion",label:"Champion",color:"bg-green-500",description:"Advocates for your solution"},{id:"blocker",label:"Blocker",color:"bg-red-500",description:"May oppose or delay"},{id:"end_user",label:"End User",color:"bg-amber-500",description:"Will use the service"},{id:"other",label:"Other",color:"bg-gray-500",description:"Other role"}],o=t=>n.find(e=>e.id===t)||n[n.length-1];function l(t,e=[]){try{const r=localStorage.getItem(t);return r?JSON.parse(r):e}catch(r){return e}}function s(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(r){}}function c(t){return{id:t.id,clientId:t.client_id,firstName:t.first_name,lastName:t.last_name,email:t.email,phone:t.phone,mobile:t.mobile,jobTitle:t.job_title,department:t.department,role:t.role,linkedinUrl:t.linkedin_url,isPrimary:t.is_primary,isActive:t.is_active,notes:t.notes,tags:t.tags||[],customFields:t.custom_fields||{},avatarUrl:t.avatar_url,createdAt:t.created_at,updatedAt:t.updated_at,lastContactedAt:t.last_contacted_at}}const d=i(t((t,i)=>({contacts:l(a),loading:!1,error:null,initialized:!1,initialize:async()=>{if(!i().initialized)if(t({loading:!0,error:null}),e())try{const{data:e,error:i}=await r.from("contacts").select("*").order("created_at",{ascending:!1});if(i)throw i;const n=(e||[]).map(c);s(a,n),t({contacts:n,loading:!1,initialized:!0,error:null})}catch(n){t({loading:!1,error:n.message,initialized:!0})}else t({loading:!1,initialized:!0})},getClientContacts:t=>i().contacts.filter(e=>e.clientId===t),getPrimaryContact:t=>i().contacts.find(e=>e.clientId===t&&e.isPrimary),getContactById:t=>i().contacts.find(e=>e.id===t),getFullName:t=>t?`${t.firstName||""}${t.lastName?" "+t.lastName:""}`.trim()||"Unknown":"",getInitials:t=>{if(!t)return"?";return((t.firstName?.[0]||"")+(t.lastName?.[0]||"")).toUpperCase()||"?"},searchContacts:t=>{const e=t.toLowerCase();return i().contacts.filter(t=>`${t.firstName||""} ${t.lastName||""}`.toLowerCase().includes(e)||t.email?.toLowerCase().includes(e)||t.phone?.includes(e)||t.mobile?.includes(e)||t.jobTitle?.toLowerCase().includes(e)||t.department?.toLowerCase().includes(e)||t.tags?.some(t=>t.toLowerCase().includes(e)))},getStaleContacts:(t=30)=>{const e=new Date;return e.setDate(e.getDate()-t),i().contacts.filter(t=>!t.lastContactedAt||new Date(t.lastContactedAt)<e)},addContact:async i=>{if(!e())return t({error:"Supabase not configured"}),null;try{const e={client_id:(n=i).clientId,first_name:n.firstName,last_name:n.lastName||null,email:n.email||null,phone:n.phone||null,mobile:n.mobile||null,job_title:n.jobTitle||null,department:n.department||null,role:n.role||null,linkedin_url:n.linkedinUrl||null,is_primary:n.isPrimary||!1,is_active:!1!==n.isActive,notes:n.notes||null,tags:n.tags||[],custom_fields:n.customFields||{},avatar_url:n.avatarUrl||null};i.isPrimary&&i.clientId&&await r.from("contacts").update({is_primary:!1}).eq("client_id",i.clientId);const{data:o,error:l}=await r.from("contacts").insert(e).select().single();if(l)throw l;const d=c(o);return t(t=>{let e=t.contacts;return d.isPrimary&&(e=e.map(t=>t.clientId===d.clientId?{...t,isPrimary:!1}:t)),e=[d,...e],s(a,e),{contacts:e,error:null}}),d}catch(o){return t({error:o.message}),null}var n},updateContact:async(n,o)=>{if(!e())return t({error:"Supabase not configured"}),!1;try{const e=i().contacts.find(t=>t.id===n);if(!e)throw new Error("Contact not found");const l={};void 0!==o.firstName&&(l.first_name=o.firstName),void 0!==o.lastName&&(l.last_name=o.lastName),void 0!==o.email&&(l.email=o.email),void 0!==o.phone&&(l.phone=o.phone),void 0!==o.mobile&&(l.mobile=o.mobile),void 0!==o.jobTitle&&(l.job_title=o.jobTitle),void 0!==o.department&&(l.department=o.department),void 0!==o.role&&(l.role=o.role),void 0!==o.linkedinUrl&&(l.linkedin_url=o.linkedinUrl),void 0!==o.isPrimary&&(l.is_primary=o.isPrimary),void 0!==o.isActive&&(l.is_active=o.isActive),void 0!==o.notes&&(l.notes=o.notes),void 0!==o.tags&&(l.tags=o.tags),void 0!==o.customFields&&(l.custom_fields=o.customFields),void 0!==o.avatarUrl&&(l.avatar_url=o.avatarUrl),o.isPrimary&&await r.from("contacts").update({is_primary:!1}).eq("client_id",e.clientId).neq("id",n);const{error:c}=await r.from("contacts").update(l).eq("id",n);if(c)throw c;return t(t=>{const r=t.contacts.map(t=>t.id===n?{...t,...o,updatedAt:(new Date).toISOString()}:o.isPrimary&&t.clientId===e.clientId?{...t,isPrimary:!1}:t);return s(a,r),{contacts:r,error:null}}),!0}catch(l){return t({error:l.message}),!1}},deleteContact:async i=>{if(!e())return t({error:"Supabase not configured"}),!1;try{const{error:e}=await r.from("contacts").delete().eq("id",i);if(e)throw e;return t(t=>{const e=t.contacts.filter(t=>t.id!==i);return s(a,e),{contacts:e,error:null}}),!0}catch(n){return t({error:n.message}),!1}},linkToOpportunity:async(t,i,a=null)=>{if(!e())return!1;try{const{error:e}=await r.from("contact_opportunities").insert({contact_id:t,opportunity_id:i,role:a});if(e&&"23505"!==e.code)throw e;return!0}catch(n){return!1}},unlinkFromOpportunity:async(t,i)=>{if(!e())return!1;try{const{error:e}=await r.from("contact_opportunities").delete().eq("contact_id",t).eq("opportunity_id",i);if(e)throw e;return!0}catch(a){return!1}},getOpportunityContacts:async t=>{if(!e())return[];try{const{data:e,error:i}=await r.from("contact_opportunities").select("\n                        role,\n                        is_primary,\n                        contacts (*)\n                    ").eq("opportunity_id",t);if(i)throw i;return(e||[]).map(t=>({...c(t.contacts),opportunityRole:t.role,isOpportunityPrimary:t.is_primary}))}catch(i){return[]}},clearError:()=>t({error:null})})));export{n as C,o as g,d as u};
