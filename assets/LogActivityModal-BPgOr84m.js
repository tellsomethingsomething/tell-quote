import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{c as a,j as l,C as i,M as n,T as s}from"./index-Civi5K2Q.js";import{u as c}from"./contactStore-CWMZuGE8.js";function r({isOpen:r,onClose:o,clientId:d,contactId:u=null,opportunityId:p=null,quoteId:m=null,contacts:v=[]}){const{addActivity:h,logCall:x,logMeeting:g,addNote:y,createTask:b}=a(),{getFullName:j}=c(),[f,N]=t.useState({activityType:"note",subject:"",description:"",contactId:u||"",activityDate:(new Date).toISOString().slice(0,16),callOutcome:"",callDirection:"outbound",meetingType:"video",meetingLocation:"",dueDate:"",priority:"medium",durationMinutes:""}),[w,D]=t.useState(!1);if(t.useEffect(()=>{r&&N({activityType:"note",subject:"",description:"",contactId:u||"",activityDate:(new Date).toISOString().slice(0,16),callOutcome:"",callDirection:"outbound",meetingType:"video",meetingLocation:"",dueDate:"",priority:"medium",durationMinutes:""})},[r,u]),t.useEffect(()=>{const e=e=>{"Escape"===e.key&&r&&o()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,o]),!r)return null;return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-lg shadow-2xl modal-content relative max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 btn-icon text-gray-500 hover:text-white","aria-label":"Close modal",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-1",children:"Log Activity"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Record an interaction or note"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f.subject.trim()){D(!0);try{const e={clientId:d,contactId:f.contactId||null,opportunityId:p,quoteId:m,subject:f.subject.trim(),description:f.description.trim()||null,activityDate:new Date(f.activityDate).toISOString(),durationMinutes:f.durationMinutes?parseInt(f.durationMinutes):null};"call"===f.activityType?await x({...e,callOutcome:f.callOutcome||null,callDirection:f.callDirection}):"meeting"===f.activityType?await g({...e,meetingType:f.meetingType,meetingLocation:f.meetingLocation||null}):"task"===f.activityType?await b({...e,dueDate:f.dueDate?new Date(f.dueDate).toISOString():null,priority:f.priority}):await y(e),o()}catch(t){}finally{D(!1)}}},className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Activity Type"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:["call","email","meeting","note","task"].map(t=>{const a=l[t];return e.jsx("button",{type:"button",onClick:()=>N({...f,activityType:t}),className:"p-3 rounded-lg border transition-all text-center "+(f.activityType===t?`${a.bgColor} ${a.color} border-current`:"border-dark-border text-gray-400 hover:border-gray-600"),children:e.jsx("span",{className:"text-xs font-medium",children:a.label})},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Subject"}),e.jsx("input",{type:"text",required:!0,autoFocus:!0,value:f.subject,onChange:e=>N({...f,subject:e.target.value}),className:"input w-full",placeholder:`${l[f.activityType]?.label||"Activity"} with client...`})]}),v.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Related Contact"}),e.jsxs("select",{value:f.contactId,onChange:e=>N({...f,contactId:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"-- General (no specific contact) --"}),v.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.role?`(${t.role})`:""]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date & Time"}),e.jsx("input",{type:"datetime-local",value:f.activityDate,onChange:e=>N({...f,activityDate:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes / Details"}),e.jsx("textarea",{value:f.description,onChange:e=>N({...f,description:e.target.value}),className:"input w-full min-h-[100px] resize-none",placeholder:(e=>{switch(e){case"call":return"e.g. Discussed project timeline...";case"email":return"e.g. Sent proposal follow-up...";case"meeting":return"e.g. Kick-off meeting at their office...";case"note":return"e.g. Important context about this client...";case"task":return"e.g. Prepare revised quote...";default:return"Add details..."}})(f.activityType)})]}),"call"===f.activityType&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Call Direction"}),e.jsxs("select",{value:f.callDirection,onChange:e=>N({...f,callDirection:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"outbound",children:"Outbound"}),e.jsx("option",{value:"inbound",children:"Inbound"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Outcome"}),e.jsxs("select",{value:f.callOutcome,onChange:e=>N({...f,callOutcome:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"Select outcome..."}),i.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]})]})]}),"meeting"===f.activityType&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Meeting Type"}),e.jsx("select",{value:f.meetingType,onChange:e=>N({...f,meetingType:e.target.value}),className:"input w-full",children:n.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{type:"text",value:f.meetingLocation,onChange:e=>N({...f,meetingLocation:e.target.value}),className:"input w-full",placeholder:"Office, Zoom link, etc."})]})]}),"task"===f.activityType&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{type:"datetime-local",value:f.dueDate,onChange:e=>N({...f,dueDate:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Priority"}),e.jsx("select",{value:f.priority,onChange:e=>N({...f,priority:e.target.value}),className:"input w-full",children:s.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]})]}),("call"===f.activityType||"meeting"===f.activityType)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Duration (minutes)"}),e.jsx("input",{type:"number",value:f.durationMinutes,onChange:e=>N({...f,durationMinutes:e.target.value}),className:"input w-full",placeholder:"e.g. 30",min:"1"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-ghost px-4 py-2",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w||!f.subject.trim(),className:"btn-primary px-4 py-2",children:w?"Saving...":"Log Activity"})]})]})]})})}export{r as L};
