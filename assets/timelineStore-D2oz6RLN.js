import{ah as e,E as t,D as r}from"./index-qIMeUE46.js";import{c as o}from"./zustand-vendor-BohoUguQ.js";const n={RESEARCH_FINDING:"research_finding",MARKET_INTEL:"market_intel",COMPETITOR_UPDATE:"competitor_update",OPPORTUNITY_CREATED:"opportunity_created",OPPORTUNITY_WON:"opportunity_won",OPPORTUNITY_LOST:"opportunity_lost",QUOTE_SENT:"quote_sent",QUOTE_WON:"quote_won",QUOTE_LOST:"quote_lost",KNOWLEDGE_ADDED:"knowledge_added",LEARNING_CAPTURED:"learning_captured",CLIENT_INTERACTION:"client_interaction",AGENT_TASK:"agent_task"},a={[n.RESEARCH_FINDING]:{label:"Research Finding",icon:"search",color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30"},[n.MARKET_INTEL]:{label:"Market Intelligence",icon:"trending-up",color:"text-cyan-400",bgColor:"bg-cyan-500/10",borderColor:"border-cyan-500/30"},[n.COMPETITOR_UPDATE]:{label:"Competitor Update",icon:"users",color:"text-orange-400",bgColor:"bg-orange-500/10",borderColor:"border-orange-500/30"},[n.OPPORTUNITY_CREATED]:{label:"New Opportunity",icon:"lightbulb",color:"text-violet-400",bgColor:"bg-violet-500/10",borderColor:"border-violet-500/30"},[n.OPPORTUNITY_WON]:{label:"Opportunity Won",icon:"trophy",color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30"},[n.OPPORTUNITY_LOST]:{label:"Opportunity Lost",icon:"x-circle",color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30"},[n.QUOTE_SENT]:{label:"Quote Sent",icon:"send",color:"text-teal-400",bgColor:"bg-teal-500/10",borderColor:"border-teal-500/30"},[n.QUOTE_WON]:{label:"Quote Won",icon:"check-circle",color:"text-emerald-400",bgColor:"bg-emerald-500/10",borderColor:"border-emerald-500/30"},[n.QUOTE_LOST]:{label:"Quote Lost",icon:"x-circle",color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30"},[n.KNOWLEDGE_ADDED]:{label:"Knowledge Added",icon:"book-open",color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/30"},[n.LEARNING_CAPTURED]:{label:"Learning Captured",icon:"brain",color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/30"},[n.CLIENT_INTERACTION]:{label:"Client Interaction",icon:"message-circle",color:"text-indigo-400",bgColor:"bg-indigo-500/10",borderColor:"border-indigo-500/30"},[n.AGENT_TASK]:{label:"Agent Task",icon:"cpu",color:"text-amber-400",bgColor:"bg-amber-500/10",borderColor:"border-amber-500/30"}};function i(e){let t=n.RESEARCH_FINDING;return"market_intelligence"===e.memory_type?t=n.MARKET_INTEL:"competitor_intel"===e.memory_type&&(t=n.COMPETITOR_UPDATE),{id:`memory-${e.id}`,type:t,title:e.content?.title||e.content?.summary||"Research Finding",description:e.content?.description||e.content?.details||"",timestamp:e.created_at,source:"researcher",agentName:e.agent_name,relevanceScore:e.relevance_score,tags:e.context_tags||[],sourceUrls:e.source_urls||[],relatedOpportunityId:e.related_opportunity_id,relatedClientId:e.related_client_id,relatedQuoteId:e.related_quote_id,metadata:e.content}}function l(e){return{id:`task-${e.id}`,type:n.AGENT_TASK,title:`${e.task_type.replace(/_/g," ")} - ${e.status}`,description:e.output_data?.summary||e.input_data?.description||"",timestamp:e.completed_at||e.started_at||e.created_at,source:"agent",agentName:e.agent_name,status:e.status,relatedOpportunityId:e.related_opportunity_id,relatedClientId:e.related_client_id,relatedQuoteId:e.related_quote_id,metadata:{input:e.input_data,output:e.output_data,error:e.error_message}}}function c(e){return{id:`knowledge-${e.id}`,type:n.KNOWLEDGE_ADDED,title:e.title||"Knowledge Fragment",description:e.content,timestamp:e.created_at,source:e.source,confidence:e.confidence,verified:e.verified,tags:e.tags||[],region:e.region,dealType:e.deal_type,fragmentType:e.fragment_type,metadata:e}}function s(e){return{id:`learning-${e.id}`,type:n.LEARNING_CAPTURED,title:e.lesson,description:e.context?JSON.stringify(e.context):"",timestamp:e.created_at,source:"deal_outcome",agentName:e.agent_name,confidence:e.confidence_score,verified:e.verified,learningType:e.learning_type,relatedQuoteId:e.quote_id,relatedOpportunityId:e.opportunity_id,metadata:{context:e.context,outcome:e.outcome}}}const d=o(e((e,o)=>({events:[],loading:!1,error:null,filters:{types:[],dateRange:null,agent:null,region:null,searchQuery:""},initialize:async()=>{if(r()){e({loading:!0,error:null});try{const r=[],{data:o,error:n}=await t.from("agent_memory").select("*").order("created_at",{ascending:!1}).limit(100);!n&&o&&r.push(...o.map(i));const{data:a,error:d}=await t.from("agent_tasks").select("*").in("status",["completed","failed"]).order("completed_at",{ascending:!1}).limit(50);!d&&a&&r.push(...a.map(l));const{data:g,error:p}=await t.from("knowledge_fragments").select("*").order("created_at",{ascending:!1}).limit(50);!p&&g&&r.push(...g.map(c));const{data:u,error:m}=await t.from("agent_learnings").select("*").order("created_at",{ascending:!1}).limit(50);!m&&u&&r.push(...u.map(s)),r.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)),e({events:r,loading:!1,error:null})}catch(o){e({loading:!1,error:o.message})}}else e({loading:!1,error:"Supabase not configured"})},addResearchFinding:async o=>{if(!r())return null;try{const r={agent_name:"research",memory_type:o.type||"research_findings",content:{title:o.title,description:o.description,summary:o.summary,organization:o.organization,country:o.country,region:o.region,opportunityType:o.opportunityType,urgency:o.urgency,budgetRange:o.budgetRange,contacts:o.contacts,recommendedAction:o.recommendedAction},context_tags:o.tags||[],relevance_score:o.urgency?o.urgency/10:.5,source_urls:o.sourceUrls||[],related_opportunity_id:o.opportunityId||null,related_client_id:o.clientId||null,expires_at:o.expiresAt||null},{data:n,error:a}=await t.from("agent_memory").insert(r).select().single();if(a)throw a;const l=i(n);return e(e=>({events:[l,...e.events]})),l}catch(n){return e({error:n.message}),null}},getFilteredEvents:()=>{const{events:e,filters:t}=o();let r=[...e];if(t.types&&t.types.length>0&&(r=r.filter(e=>t.types.includes(e.type))),t.dateRange){const{start:e,end:o}=t.dateRange;r=r.filter(t=>{const r=new Date(t.timestamp);return!(e&&r<new Date(e))&&!(o&&r>new Date(o))})}if(t.agent&&(r=r.filter(e=>e.agentName===t.agent)),t.region&&(r=r.filter(e=>e.region===t.region||e.tags?.includes(t.region.toLowerCase()))),t.searchQuery){const e=t.searchQuery.toLowerCase();r=r.filter(t=>t.title?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.tags?.some(t=>t.toLowerCase().includes(e)))}return r},getEventsByDate:()=>{const e=o().getFilteredEvents(),t={};return e.forEach(e=>{const r=new Date(e.timestamp).toISOString().split("T")[0];t[r]||(t[r]=[]),t[r].push(e)}),t},getRecentEvents:(e=7)=>{const{events:t}=o(),r=new Date;return r.setDate(r.getDate()-e),t.filter(e=>new Date(e.timestamp)>=r)},getEventsByType:e=>{const{events:t}=o();return t.filter(t=>t.type===e)},getResearchFindings:()=>{const{events:e}=o();return e.filter(e=>e.type===n.RESEARCH_FINDING||e.type===n.MARKET_INTEL||e.type===n.COMPETITOR_UPDATE)},getStats:()=>{const{events:e}=o(),t=new Date,r=new Date(t.getTime()-6048e5),n=new Date(t.getTime()-2592e6),a=e.filter(e=>new Date(e.timestamp)>=r),i=e.filter(e=>new Date(e.timestamp)>=n),l={};e.forEach(e=>{l[e.type]=(l[e.type]||0)+1});const c={};return e.forEach(e=>{e.agentName&&(c[e.agentName]=(c[e.agentName]||0)+1)}),{total:e.length,thisWeek:a.length,thisMonth:i.length,byType:l,byAgent:c}},setFilters:t=>{e(e=>({filters:{...e.filters,...t}}))},clearFilters:()=>{e({filters:{types:[],dateRange:null,agent:null,region:null,searchQuery:""}})},clearError:()=>{e({error:null})},prepareOpportunityFromEvent:e=>{const t=e.metadata||{},r={title:t.title||e.title||"New Opportunity",country:t.country||"",region:t.region||"",source:`Research: ${e.title}`,brief:t.description||e.description||"",notes:`Converted from research finding on ${new Date(e.timestamp).toLocaleDateString("en-GB")}.\n\n${t.summary||""}\n\nRecommended Action: ${t.recommendedAction||"Follow up"}`,value:t.budgetRange?.min||t.estimatedValue||0,currency:t.currency||"USD",probability:t.urgency?Math.min(10*t.urgency,90):30,status:"active",nextAction:t.recommendedAction||"Initial contact",nextActionDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],competitors:t.competitors||[],contacts:t.contacts||[],researchEventId:e.id};return t.organization&&(r.client={company:t.organization,contact:t.contactName||"",email:t.contactEmail||""}),r},markEventAsConverted:async(r,o)=>{if(r.startsWith("memory-")){const e=r.replace("memory-","");try{await t.from("agent_memory").update({related_opportunity_id:o}).eq("id",e)}catch(n){}}e(e=>({events:e.events.map(e=>e.id===r?{...e,relatedOpportunityId:o,convertedToOpportunity:!0}:e)}))}})));export{a as E,n as a,d as u};
