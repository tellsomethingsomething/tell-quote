import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{c as t,r as s}from"./zustand-vendor-BohoUguQ.js";import{o as a,ah as r,E as l,X as i,a3 as d,H as n,a2 as o,am as c,g as x,u as m,a6 as u,U as p,aJ as h}from"./index-DoA-9vkb.js";import{L as g}from"./link-2-CZHKfoy3.js";import{C as b}from"./copy-BZXlAuee.js";import{T as f}from"./trash-2-CKFAddvS.js";import{B as y}from"./briefcase-DNnJ5YF_.js";import{A as j}from"./activity-zpYdSaTB.js";import{E as v}from"./ellipsis-BP5YiHN1.js";import{S as w,P as N}from"./star-zY2hGG-R.js";import{S as C}from"./search-uwox6je8.js";import{C as k}from"./chevron-down-u6eNc_wZ.js";import{F as _}from"./funnel-CelHljel.js";import{L as D}from"./list-C8TQg_Wu.js";import{M as z}from"./message-square-BgXjUIcN.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const S=a("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]),L=a("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),B=a("panels-top-left",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),F=a("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),O=a("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),A=a("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),E=a("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]),q={blue:{id:"blue",color:"#0079BF",label:"Blue"},green:{id:"green",color:"#519839",label:"Green"},orange:{id:"orange",color:"#D29034",label:"Orange"},red:{id:"red",color:"#B04632",label:"Red"},purple:{id:"purple",color:"#89609E",label:"Purple"},pink:{id:"pink",color:"#CD5A91",label:"Pink"},gray:{id:"gray",color:"#838C91",label:"Gray"},dark:{id:"dark",color:"#1a1a2e",label:"Dark"}},I={green:{id:"green",color:"#61BD4F",label:"Green"},yellow:{id:"yellow",color:"#F2D600",label:"Yellow"},orange:{id:"orange",color:"#FF9F1A",label:"Orange"},red:{id:"red",color:"#EB5A46",label:"Red"},purple:{id:"purple",color:"#C377E0",label:"Purple"},blue:{id:"blue",color:"#0079BF",label:"Blue"},sky:{id:"sky",color:"#00C2E0",label:"Sky"},lime:{id:"lime",color:"#51E898",label:"Lime"},pink:{id:"pink",color:"#FF78CB",label:"Pink"},black:{id:"black",color:"#344563",label:"Black"}},M={urgent:{id:"urgent",label:"Urgent",color:"#EB5A46",icon:"ðŸ”´"},high:{id:"high",label:"High",color:"#FF9F1A",icon:"ðŸŸ "},medium:{id:"medium",label:"Medium",color:"#F2D600",icon:"ðŸŸ¡"},low:{id:"low",label:"Low",color:"#61BD4F",icon:"ðŸŸ¢"},none:{id:"none",label:"None",color:"#838C91",icon:"âšª"}},T=[{title:"To Do",position:0},{title:"In Progress",position:1},{title:"Review",position:2},{title:"Done",position:3}],P=t(r((e,t)=>({boards:[],currentBoard:null,lists:[],cards:[],labels:[],loading:!1,error:null,draggedCard:null,draggedList:null,dragOverList:null,dragOverCard:null,selectedCard:null,cardDetailOpen:!1,loadBoards:async()=>{e({loading:!0,error:null});try{const{data:t,error:s}=await l.from("task_boards").select("*").order("created_at",{ascending:!1});if(s)throw s;e({boards:t||[],loading:!1})}catch(t){e({error:t.message,loading:!1})}},createBoard:async t=>{try{const{data:s,error:a}=await l.from("task_boards").insert({name:t.name,description:t.description||"",background:t.background||"blue",is_template:t.is_template||!1,settings:t.settings||{}}).select().single();if(a)throw a;const r=(t.lists||T).map((e,t)=>({board_id:s.id,title:e.title,position:e.position??t})),{error:i}=await l.from("task_lists").insert(r);if(i)throw i;const d=Object.values(I).map(e=>({board_id:s.id,name:"",color:e.id})),{error:n}=await l.from("task_labels").insert(d);if(n)throw n;return e(e=>({boards:[s,...e.boards]})),s}catch(s){throw s}},updateBoard:async(t,s)=>{try{const{data:a,error:r}=await l.from("task_boards").update({...s,updated_at:(new Date).toISOString()}).eq("id",t).select().single();if(r)throw r;return e(e=>({boards:e.boards.map(e=>e.id===t?a:e),currentBoard:e.currentBoard?.id===t?a:e.currentBoard})),a}catch(a){throw a}},deleteBoard:async t=>{try{const{error:s}=await l.from("task_boards").delete().eq("id",t);if(s)throw s;e(e=>({boards:e.boards.filter(e=>e.id!==t),currentBoard:e.currentBoard?.id===t?null:e.currentBoard}))}catch(s){throw s}},loadBoard:async t=>{e({loading:!0,error:null});try{const{data:s,error:a}=await l.from("task_boards").select("*").eq("id",t).single();if(a)throw a;const{data:r,error:i}=await l.from("task_lists").select("*").eq("board_id",t).order("position",{ascending:!0});if(i)throw i;const{data:d,error:n}=await l.from("task_cards").select("\n                        *,\n                        assignees:task_card_assignees(user_id, users:user_id(id, name, avatar_url)),\n                        card_labels:task_card_labels(label_id),\n                        checklists:task_checklists(*, items:task_checklist_items(*)),\n                        comments:task_comments(*, user:user_id(id, name, avatar_url)),\n                        attachments:task_attachments(*)\n                    ").eq("board_id",t).order("position",{ascending:!0});if(n)throw n;const{data:o,error:c}=await l.from("task_labels").select("*").eq("board_id",t);if(c)throw c;e({currentBoard:s,lists:r||[],cards:d||[],labels:o||[],loading:!1})}catch(s){e({error:s.message,loading:!1})}},createList:async(s,a,r=null)=>{try{const{lists:i}=t(),d=r??i.length,{data:n,error:o}=await l.from("task_lists").insert({board_id:s,title:a,position:d}).select().single();if(o)throw o;return e(e=>({lists:[...e.lists,n]})),n}catch(i){throw i}},updateList:async(t,s)=>{try{const{data:a,error:r}=await l.from("task_lists").update(s).eq("id",t).select().single();if(r)throw r;return e(e=>({lists:e.lists.map(e=>e.id===t?a:e)})),a}catch(a){throw a}},deleteList:async t=>{try{const{error:s}=await l.from("task_lists").delete().eq("id",t);if(s)throw s;e(e=>({lists:e.lists.filter(e=>e.id!==t),cards:e.cards.filter(e=>e.list_id!==t)}))}catch(s){throw s}},moveList:async(s,a)=>{const{lists:r,currentBoard:i}=t(),d=r.find(e=>e.id===s);if(!d)return;const n=d.position,o=r.map(e=>{if(e.id===s)return{...e,position:a};if(n<a){if(e.position>n&&e.position<=a)return{...e,position:e.position-1}}else if(e.position>=a&&e.position<n)return{...e,position:e.position+1};return e});e({lists:o.sort((e,t)=>e.position-t.position)});try{const e=o.filter(e=>e.position!==r.find(t=>t.id===e.id)?.position).map(e=>l.from("task_lists").update({position:e.position}).eq("id",e.id));await Promise.all(e)}catch(c){e({lists:r})}},createCard:async(s,a)=>{try{const{cards:r,currentBoard:i}=t(),d=r.filter(e=>e.list_id===s).length,{data:n,error:o}=await l.from("task_cards").insert({board_id:i.id,list_id:s,title:a.title,description:a.description||"",position:d,priority:a.priority||"none",due_date:a.due_date||null,cover_color:a.cover_color||null,cover_image:a.cover_image||null}).select().single();if(o)throw o;const c={...n,assignees:[],card_labels:[],checklists:[],comments:[],attachments:[]};return e(e=>({cards:[...e.cards,c]})),c}catch(r){throw r}},updateCard:async(t,s)=>{try{const{data:a,error:r}=await l.from("task_cards").update({...s,updated_at:(new Date).toISOString()}).eq("id",t).select().single();if(r)throw r;return e(e=>({cards:e.cards.map(e=>e.id===t?{...e,...a}:e),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,...a}:e.selectedCard})),a}catch(a){throw a}},deleteCard:async t=>{try{const{error:s}=await l.from("task_cards").delete().eq("id",t);if(s)throw s;e(e=>({cards:e.cards.filter(e=>e.id!==t),selectedCard:e.selectedCard?.id===t?null:e.selectedCard,cardDetailOpen:e.selectedCard?.id!==t&&e.cardDetailOpen}))}catch(s){throw s}},moveCard:async(s,a,r)=>{const{cards:i}=t(),d=i.find(e=>e.id===s);if(!d)return;const n=d.list_id,o=d.position;let c=[...i];c=n===a?i.map(e=>{if(e.list_id!==n)return e;if(e.id===s)return{...e,position:r};if(o<r){if(e.position>o&&e.position<=r)return{...e,position:e.position-1}}else if(e.position>=r&&e.position<o)return{...e,position:e.position+1};return e}):i.map(e=>e.id===s?{...e,list_id:a,position:r}:e.list_id===n&&e.position>o?{...e,position:e.position-1}:e.list_id===a&&e.position>=r?{...e,position:e.position+1}:e),e({cards:c});try{await l.from("task_cards").update({list_id:a,position:r}).eq("id",s);const e=c.filter(e=>{const t=i.find(t=>t.id===e.id);return t&&(t.position!==e.position||t.list_id!==e.list_id)});for(const t of e)t.id!==s&&await l.from("task_cards").update({position:t.position}).eq("id",t.id)}catch(x){e({cards:i})}},duplicateCard:async s=>{try{const{cards:a,currentBoard:r}=t(),i=a.find(e=>e.id===s);if(!i)return;const d=a.filter(e=>e.list_id===i.list_id).length,{data:n,error:o}=await l.from("task_cards").insert({board_id:r.id,list_id:i.list_id,title:`${i.title} (copy)`,description:i.description,position:d,priority:i.priority,due_date:i.due_date,cover_color:i.cover_color,cover_image:i.cover_image}).select().single();if(o)throw o;const c={...n,assignees:[],card_labels:[],checklists:[],comments:[],attachments:[]};return e(e=>({cards:[...e.cards,c]})),c}catch(a){throw a}},updateLabel:async(t,s)=>{try{const{data:a,error:r}=await l.from("task_labels").update(s).eq("id",t).select().single();if(r)throw r;return e(e=>({labels:e.labels.map(e=>e.id===t?a:e)})),a}catch(a){throw a}},addLabelToCard:async(t,s)=>{try{const{error:a}=await l.from("task_card_labels").insert({card_id:t,label_id:s});if(a&&!a.message.includes("duplicate"))throw a;e(e=>({cards:e.cards.map(e=>{if(e.id!==t)return e;const a=e.card_labels?.some(e=>e.label_id===s);return a?e:{...e,card_labels:[...e.card_labels||[],{label_id:s}]}}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,card_labels:[...e.selectedCard.card_labels||[],{label_id:s}]}:e.selectedCard}))}catch(a){throw a}},removeLabelFromCard:async(t,s)=>{try{const{error:a}=await l.from("task_card_labels").delete().eq("card_id",t).eq("label_id",s);if(a)throw a;e(e=>({cards:e.cards.map(e=>e.id!==t?e:{...e,card_labels:(e.card_labels||[]).filter(e=>e.label_id!==s)}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,card_labels:(e.selectedCard.card_labels||[]).filter(e=>e.label_id!==s)}:e.selectedCard}))}catch(a){throw a}},addChecklist:async(t,s="Checklist")=>{try{const{data:a,error:r}=await l.from("task_checklists").insert({card_id:t,title:s,position:0}).select().single();if(r)throw r;const i={...a,items:[]};return e(e=>({cards:e.cards.map(e=>e.id!==t?e:{...e,checklists:[...e.checklists||[],i]}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,checklists:[...e.selectedCard.checklists||[],i]}:e.selectedCard})),i}catch(a){throw a}},deleteChecklist:async t=>{try{const{error:s}=await l.from("task_checklists").delete().eq("id",t);if(s)throw s;e(e=>({cards:e.cards.map(e=>({...e,checklists:(e.checklists||[]).filter(e=>e.id!==t)})),selectedCard:e.selectedCard?{...e.selectedCard,checklists:(e.selectedCard.checklists||[]).filter(e=>e.id!==t)}:null}))}catch(s){throw s}},addChecklistItem:async(s,a)=>{try{const{cards:r,selectedCard:i}=t(),d=r.find(e=>e.checklists?.some(e=>e.id===s)),n=d?.checklists?.find(e=>e.id===s),o=n?.items?.length||0,{data:c,error:x}=await l.from("task_checklist_items").insert({checklist_id:s,text:a,position:o,is_complete:!1}).select().single();if(x)throw x;return e(e=>({cards:e.cards.map(e=>({...e,checklists:(e.checklists||[]).map(e=>e.id!==s?e:{...e,items:[...e.items||[],c]})})),selectedCard:e.selectedCard?{...e.selectedCard,checklists:(e.selectedCard.checklists||[]).map(e=>e.id!==s?e:{...e,items:[...e.items||[],c]})}:null})),c}catch(r){throw r}},updateChecklistItem:async(t,s)=>{try{const{data:a,error:r}=await l.from("task_checklist_items").update(s).eq("id",t).select().single();if(r)throw r;return e(e=>({cards:e.cards.map(e=>({...e,checklists:(e.checklists||[]).map(e=>({...e,items:(e.items||[]).map(e=>e.id===t?a:e)}))})),selectedCard:e.selectedCard?{...e.selectedCard,checklists:(e.selectedCard.checklists||[]).map(e=>({...e,items:(e.items||[]).map(e=>e.id===t?a:e)}))}:null})),a}catch(a){throw a}},deleteChecklistItem:async t=>{try{const{error:s}=await l.from("task_checklist_items").delete().eq("id",t);if(s)throw s;e(e=>({cards:e.cards.map(e=>({...e,checklists:(e.checklists||[]).map(e=>({...e,items:(e.items||[]).filter(e=>e.id!==t)}))})),selectedCard:e.selectedCard?{...e.selectedCard,checklists:(e.selectedCard.checklists||[]).map(e=>({...e,items:(e.items||[]).filter(e=>e.id!==t)}))}:null}))}catch(s){throw s}},addComment:async(t,s,a)=>{try{const{data:r,error:i}=await l.from("task_comments").insert({card_id:t,user_id:a,text:s}).select("*, user:user_id(id, name, avatar_url)").single();if(i)throw i;return e(e=>({cards:e.cards.map(e=>e.id!==t?e:{...e,comments:[r,...e.comments||[]]}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,comments:[r,...e.selectedCard.comments||[]]}:e.selectedCard})),r}catch(r){throw r}},deleteComment:async t=>{try{const{error:s}=await l.from("task_comments").delete().eq("id",t);if(s)throw s;e(e=>({cards:e.cards.map(e=>({...e,comments:(e.comments||[]).filter(e=>e.id!==t)})),selectedCard:e.selectedCard?{...e.selectedCard,comments:(e.selectedCard.comments||[]).filter(e=>e.id!==t)}:null}))}catch(s){throw s}},addAssignee:async(t,s)=>{try{const{error:a}=await l.from("task_card_assignees").insert({card_id:t,user_id:s});if(a&&!a.message.includes("duplicate"))throw a;const{data:r}=await l.from("users").select("id, name, avatar_url").eq("id",s).single(),i={user_id:s,users:r};e(e=>({cards:e.cards.map(e=>{if(e.id!==t)return e;const a=e.assignees?.some(e=>e.user_id===s);return a?e:{...e,assignees:[...e.assignees||[],i]}}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,assignees:[...e.selectedCard.assignees||[],i]}:e.selectedCard}))}catch(a){throw a}},removeAssignee:async(t,s)=>{try{const{error:a}=await l.from("task_card_assignees").delete().eq("card_id",t).eq("user_id",s);if(a)throw a;e(e=>({cards:e.cards.map(e=>e.id!==t?e:{...e,assignees:(e.assignees||[]).filter(e=>e.user_id!==s)}),selectedCard:e.selectedCard?.id===t?{...e.selectedCard,assignees:(e.selectedCard.assignees||[]).filter(e=>e.user_id!==s)}:e.selectedCard}))}catch(a){throw a}},setDraggedCard:t=>e({draggedCard:t}),setDraggedList:t=>e({draggedList:t}),setDragOverList:t=>e({dragOverList:t}),setDragOverCard:t=>e({dragOverCard:t}),clearDragState:()=>e({draggedCard:null,draggedList:null,dragOverList:null,dragOverCard:null}),openCardDetail:t=>e({selectedCard:t,cardDetailOpen:!0}),closeCardDetail:()=>e({selectedCard:null,cardDetailOpen:!1}),getListCards:e=>{const{cards:s}=t();return s.filter(t=>t.list_id===e).sort((e,t)=>e.position-t.position)},getCardLabel:e=>{const{labels:s}=t();return s.find(t=>t.id===e)},getChecklistProgress:e=>{if(!e?.checklists?.length)return null;let t=0,s=0;return e.checklists.forEach(e=>{e.items?.forEach(e=>{t++,e.is_complete&&s++})}),t>0?{total:t,completed:s,percent:Math.round(s/t*100)}:null}}))),R=e=>{if(!e)return null;const t=new Date(e),s=new Date,a=Math.ceil((t-s)/864e5);return a<0?{text:"Overdue",status:"overdue"}:0===a?{text:"Today",status:"due-soon"}:1===a?{text:"Tomorrow",status:"due-soon"}:a<=7?{text:t.toLocaleDateString("en-US",{weekday:"short"}),status:"upcoming"}:{text:t.toLocaleDateString("en-US",{month:"short",day:"numeric"}),status:"normal"}},U=({cardId:t,cardLabels:a,labels:r,onClose:l})=>{const{addLabelToCard:d,removeLabelFromCard:n,updateLabel:o}=P(),[c,x]=s.useState(null),[m,u]=s.useState(""),p=e=>a?.some(t=>t.label_id===e);return e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-64 bg-white rounded-lg shadow-xl border z-30",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Labels"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:16})})]}),e.jsx("div",{className:"p-3 space-y-2",children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"Label name",className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{c&&(o(c.id,{name:m}),x(null),u(""))},className:"flex-1 px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:()=>x(null),className:"px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded",children:"Cancel"})]})]}):r.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{return e=s.id,void(p(e)?n(t,e):d(t,e));var e},className:"flex-1 h-8 rounded flex items-center px-3 "+(p(s.id)?"ring-2 ring-blue-500 ring-offset-1":""),style:{backgroundColor:I[s.color]?.color},children:e.jsx("span",{className:"text-white text-sm font-medium",children:s.name||I[s.color]?.label})}),e.jsx("button",{onClick:()=>(e=>{x(e),u(e.name||"")})(s),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(v,{size:14,className:"text-gray-500"})})]},s.id))})]})},H=({cardId:t,currentDate:a,onClose:r})=>{const{updateCard:l}=P(),[d,n]=s.useState(a?new Date(a).toISOString().split("T")[0]:""),[o,c]=s.useState(a?new Date(a).toTimeString().slice(0,5):"12:00");return e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-72 bg-white rounded-lg shadow-xl border z-30",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Due Date"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:16})})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Date"}),e.jsx("input",{type:"date",value:d,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Time"}),e.jsx("input",{type:"time",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const e=d?new Date(`${d}T${o}`).toISOString():null;l(t,{due_date:e}),r()},className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"}),a&&e.jsx("button",{onClick:()=>{l(t,{due_date:null}),r()},className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded",children:"Remove"})]})]})]})},K=({cardId:t,currentPriority:s,onClose:a})=>{const{updateCard:r}=P();return e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-48 bg-white rounded-lg shadow-xl border z-30",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Priority"}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:16})})]}),e.jsx("div",{className:"p-2",children:Object.values(M).map(l=>e.jsxs("button",{onClick:()=>(e=>{r(t,{priority:e}),a()})(l.id),className:"w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-50 "+(s===l.id?"bg-blue-50":""),children:[e.jsx("span",{style:{color:l.color},children:l.icon}),e.jsx("span",{className:"text-gray-900",children:l.label})]},l.id))})]})},$=({cardId:t,lists:s,currentListId:a,onClose:r})=>{const{moveCard:l}=P();return e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-64 bg-white rounded-lg shadow-xl border z-30",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Move to..."}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:16})})]}),e.jsx("div",{className:"p-2 max-h-64 overflow-y-auto",children:s.map(s=>e.jsxs("button",{onClick:()=>{return(e=s.id)!==a&&l(t,e,0),void r();var e},className:"w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-50 "+(a===s.id?"bg-blue-50 text-blue-700":"text-gray-900"),children:[s.title,a===s.id&&e.jsx("span",{className:"text-xs",children:"(current)"})]},s.id))})]})},V=({cardId:t,card:a,onClose:r})=>{const{updateCard:l}=P(),d=c(e=>e.projects),n=x(e=>e.opportunities),o=m(e=>e.clients),[p,h]=s.useState("project"),[g,b]=s.useState(""),f=d.filter(e=>e.name?.toLowerCase().includes(g.toLowerCase())||e.client?.toLowerCase().includes(g.toLowerCase())),j=n.filter(e=>e.name?.toLowerCase().includes(g.toLowerCase())||e.company?.toLowerCase().includes(g.toLowerCase())),v=o.filter(e=>e.company?.toLowerCase().includes(g.toLowerCase())),w=e=>{"project"===e?l(t,{project_id:null}):"opportunity"===e?l(t,{opportunity_id:null}):"client"===e&&l(t,{client_id:null})};return e.jsxs("div",{className:"absolute left-0 top-full mt-2 w-80 bg-white rounded-lg shadow-xl border z-30",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Link to..."}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:16})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>h("project"),className:"flex-1 px-3 py-2 text-sm font-medium "+("project"===p?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:[e.jsx(y,{size:14,className:"inline mr-1"}),"Project"]}),e.jsxs("button",{onClick:()=>h("opportunity"),className:"flex-1 px-3 py-2 text-sm font-medium "+("opportunity"===p?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:[e.jsx(L,{size:14,className:"inline mr-1"}),"Opportunity"]}),e.jsxs("button",{onClick:()=>h("client"),className:"flex-1 px-3 py-2 text-sm font-medium "+("client"===p?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:[e.jsx(u,{size:14,className:"inline mr-1"}),"Client"]})]}),e.jsx("div",{className:"p-2 border-b",children:e.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value),placeholder:`Search ${p}s...`,className:"w-full px-3 py-2 text-sm border rounded focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{className:"max-h-64 overflow-y-auto p-2",children:["project"===p&&e.jsxs(e.Fragment,{children:[a.project_id&&e.jsxs("button",{onClick:()=>w("project"),className:"w-full flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm mb-2",children:[e.jsx(i,{size:14}),"Remove project link"]}),0===f.length?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No projects found"}):f.slice(0,20).map(s=>e.jsxs("button",{onClick:()=>{return e=s.id,l(t,{project_id:e}),void r();var e},className:"w-full flex items-center gap-2 px-3 py-2 rounded text-left hover:bg-gray-50 "+(a.project_id===s.id?"bg-blue-50 ring-1 ring-blue-500":""),children:[e.jsx(y,{size:14,className:"text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.client})]}),a.project_id===s.id&&e.jsx("span",{className:"text-xs text-blue-600",children:"Linked"})]},s.id))]}),"opportunity"===p&&e.jsxs(e.Fragment,{children:[a.opportunity_id&&e.jsxs("button",{onClick:()=>w("opportunity"),className:"w-full flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm mb-2",children:[e.jsx(i,{size:14}),"Remove opportunity link"]}),0===j.length?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No opportunities found"}):j.slice(0,20).map(s=>e.jsxs("button",{onClick:()=>{return e=s.id,l(t,{opportunity_id:e}),void r();var e},className:"w-full flex items-center gap-2 px-3 py-2 rounded text-left hover:bg-gray-50 "+(a.opportunity_id===s.id?"bg-blue-50 ring-1 ring-blue-500":""),children:[e.jsx(L,{size:14,className:"text-yellow-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:[s.company," - ",s.stage]})]}),a.opportunity_id===s.id&&e.jsx("span",{className:"text-xs text-blue-600",children:"Linked"})]},s.id))]}),"client"===p&&e.jsxs(e.Fragment,{children:[a.client_id&&e.jsxs("button",{onClick:()=>w("client"),className:"w-full flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm mb-2",children:[e.jsx(i,{size:14}),"Remove client link"]}),0===v.length?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No clients found"}):v.slice(0,20).map(s=>e.jsxs("button",{onClick:()=>{return e=s.id,l(t,{client_id:e}),void r();var e},className:"w-full flex items-center gap-2 px-3 py-2 rounded text-left hover:bg-gray-50 "+(a.client_id===s.id?"bg-blue-50 ring-1 ring-blue-500":""),children:[e.jsx(u,{size:14,className:"text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.company}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.contact})]}),a.client_id===s.id&&e.jsx("span",{className:"text-xs text-blue-600",children:"Linked"})]},s.id))]})]})]})},G=({card:t})=>{const s=c(e=>e.projects),a=x(e=>e.opportunities),r=m(e=>e.clients),l=t.project_id?s.find(e=>e.id===t.project_id):null,i=t.opportunity_id?a.find(e=>e.id===t.opportunity_id):null,d=t.client_id?r.find(e=>e.id===t.client_id):null;return l||i||d?e.jsxs("div",{className:"mb-4 ml-9",children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-2",children:"Linked to"}),e.jsxs("div",{className:"space-y-2",children:[l&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 rounded-lg",children:[e.jsx(y,{size:14,className:"text-blue-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500",children:l.client})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded",children:"Project"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-yellow-50 rounded-lg",children:[e.jsx(L,{size:14,className:"text-yellow-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:i.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.company," - ",i.stage]})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded",children:"Opportunity"})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg",children:[e.jsx(u,{size:14,className:"text-gray-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:d.company}),e.jsx("p",{className:"text-xs text-gray-500",children:d.contact})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 text-gray-700 rounded",children:"Client"})]})]})]}):null},Y=({checklist:t})=>{const[a,r]=s.useState(""),[l,d]=s.useState(!1),{updateChecklistItem:n,deleteChecklistItem:o,addChecklistItem:c,deleteChecklist:x}=P(),m=t.items||[],u=m.filter(e=>e.is_complete).length,p=m.length,h=p>0?Math.round(u/p*100):0,g=()=>{a.trim()&&(c(t.id,a),r(""))};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:18,className:"text-gray-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:t.title})]}),e.jsx("button",{onClick:()=>x(t.id),className:"text-sm text-gray-500 hover:text-red-600 px-2 py-1 hover:bg-gray-100 rounded",children:"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-8",children:[h,"%"]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-2 rounded-full transition-all "+(100===h?"bg-green-500":"bg-blue-500"),style:{width:`${h}%`}})})]}),e.jsx("div",{className:"space-y-2 ml-6",children:m.sort((e,t)=>e.position-t.position).map(t=>e.jsxs("div",{className:"flex items-start gap-2 group",children:[e.jsx("input",{type:"checkbox",checked:t.is_complete,onChange:()=>n(t.id,{is_complete:!t.is_complete}),className:"mt-1 w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"flex-1 text-sm "+(t.is_complete?"line-through text-gray-400":"text-gray-700"),children:t.text}),e.jsx("button",{onClick:()=>o(t.id),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-100 rounded",children:e.jsx(i,{size:14,className:"text-gray-400"})})]},t.id))}),l?e.jsxs("div",{className:"mt-3 ml-6",children:[e.jsx("input",{type:"text",value:a,onChange:e=>r(e.target.value),placeholder:"Add an item...",className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500 text-sm",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&g(),"Escape"===e.key&&d(!1)}}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:g,className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Add"}),e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-1.5 text-gray-600 hover:bg-gray-100 text-sm rounded",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>d(!0),className:"mt-2 ml-6 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 px-3 py-1.5 rounded",children:"Add an item"})]})},J=({cardId:t,comments:a})=>{const[r,l]=s.useState(""),{addComment:i,deleteComment:d}=P();return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(j,{size:18,className:"text-gray-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Activity"})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium",children:"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:r,onChange:e=>l(e.target.value),placeholder:"Write a comment...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm resize-none",rows:2}),r&&e.jsx("button",{onClick:()=>{r.trim()&&(i(t,r,"demo-user-id"),l(""))},className:"mt-2 px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Save"})]})]}),e.jsx("div",{className:"space-y-4",children:(a||[]).map(t=>e.jsxs("div",{className:"flex gap-3 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 text-sm font-medium",children:t.user?.name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 text-sm",children:t.user?.name||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:t.text}),e.jsx("button",{onClick:()=>d(t.id),className:"opacity-0 group-hover:opacity-100 text-xs text-red-600 hover:underline mt-1",children:"Delete"})]})]},t.id))})]})},W=({card:t,labels:a,lists:r,onClose:l})=>{const[c,x]=s.useState(t.title),[m,u]=s.useState(t.description||""),[p,h]=s.useState(!1),[y,j]=s.useState(!1),[v,w]=s.useState(!1),[N,C]=s.useState(!1),[k,_]=s.useState(!1),[D,z]=s.useState(!1),{updateCard:L,deleteCard:B,duplicateCard:F,addChecklist:q}=P(),T=s.useRef(null),W=R(t.due_date),Q=t.card_labels?.map(e=>a.find(t=>t.id===e.label_id)).filter(Boolean)||[],X=M[t.priority],Z=r.find(e=>e.id===t.list_id);s.useEffect(()=>{const e=e=>{"Escape"===e.key&&l()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l]);return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:l}),e.jsxs("div",{className:"relative bg-gray-100 rounded-xl w-full max-w-3xl shadow-2xl",children:[t.cover_color&&e.jsx("div",{className:"h-24 rounded-t-xl",style:{backgroundColor:t.cover_color}}),e.jsx("button",{onClick:l,className:"absolute top-3 right-3 p-2 bg-gray-200/80 hover:bg-gray-300 rounded-full",children:e.jsx(i,{size:18})}),e.jsxs("div",{className:"flex gap-4 p-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(d,{size:24,className:"text-gray-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:T,type:"text",value:c,onChange:e=>x(e.target.value),onBlur:()=>{c.trim()&&c!==t.title&&L(t.id,{title:c})},className:"w-full text-xl font-semibold text-gray-900 bg-transparent border-none focus:outline-none focus:ring-0"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["in list ",e.jsx("span",{className:"font-medium underline",children:Z?.title})]})]})]}),Q.length>0&&e.jsxs("div",{className:"mb-4 ml-9",children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-2",children:"Labels"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map(t=>e.jsx("span",{className:"px-3 py-1 rounded text-sm font-medium text-white",style:{backgroundColor:I[t.color]?.color},children:t.name||I[t.color]?.label},t.id))})]}),e.jsx(G,{card:t}),e.jsxs("div",{className:"flex gap-4 mb-4 ml-9",children:[W&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-1",children:"Due date"}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm "+("overdue"===W.status?"bg-red-500 text-white":"due-soon"===W.status?"bg-yellow-500 text-white":"bg-gray-200 text-gray-700"),children:[e.jsx(n,{size:14}),new Date(t.due_date).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]}),X&&"none"!==X.id&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-1",children:"Priority"}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:X.color+"20",color:X.color},children:[X.icon," ",X.label]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{size:18,className:"text-gray-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Description"})]}),p?e.jsxs("div",{className:"ml-6",children:[e.jsx("textarea",{value:m,onChange:e=>u(e.target.value),placeholder:"Add a more detailed description...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm resize-none",rows:6,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>{L(t.id,{description:m}),h(!1)},className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:()=>{u(t.description||""),h(!1)},className:"px-3 py-1.5 text-gray-600 hover:bg-gray-200 text-sm rounded",children:"Cancel"})]})]}):e.jsx("div",{onClick:()=>h(!0),className:"ml-6 min-h-[60px] p-3 bg-gray-200 rounded-lg cursor-pointer hover:bg-gray-300 text-sm text-gray-700",children:m||"Add a more detailed description..."})]}),t.checklists?.map(t=>e.jsx(Y,{checklist:t},t.id)),e.jsx(J,{cardId:t.id,comments:t.comments})]}),e.jsxs("div",{className:"w-48 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Add to card"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>j(!y),className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(A,{size:14}),"Labels"]}),y&&e.jsx(U,{cardId:t.id,cardLabels:t.card_labels,labels:a,onClose:()=>j(!1)})]}),e.jsxs("button",{onClick:()=>{q(t.id,"Checklist")},className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(O,{size:14}),"Checklist"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>w(!v),className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(n,{size:14}),"Due date"]}),v&&e.jsx(H,{cardId:t.id,currentDate:t.due_date,onClose:()=>w(!1)})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(!N),className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(S,{size:14}),"Priority"]}),N&&e.jsx(K,{cardId:t.id,currentPriority:t.priority,onClose:()=>C(!1)})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>z(!D),className:"w-full flex items-center gap-2 px-3 py-2 rounded text-sm "+(t.project_id||t.opportunity_id||t.client_id?"bg-blue-100 hover:bg-blue-200 text-blue-700":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:[e.jsx(g,{size:14}),"Link",(t.project_id||t.opportunity_id||t.client_id)&&e.jsx("span",{className:"ml-auto text-xs bg-blue-500 text-white px-1.5 rounded",children:[t.project_id,t.opportunity_id,t.client_id].filter(Boolean).length})]}),D&&e.jsx(V,{cardId:t.id,card:t,onClose:()=>z(!1)})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Actions"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>_(!k),className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(o,{size:14}),"Move"]}),k&&e.jsx($,{cardId:t.id,lists:r,currentListId:t.list_id,onClose:()=>_(!1)})]}),e.jsxs("button",{onClick:async()=>{await F(t.id),l()},className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm text-gray-700",children:[e.jsx(b,{size:14}),"Copy"]}),e.jsxs("button",{onClick:()=>{confirm("Delete this card? This cannot be undone.")&&(B(t.id),l())},className:"w-full flex items-center gap-2 px-3 py-2 bg-red-100 hover:bg-red-200 rounded text-sm text-red-700",children:[e.jsx(f,{size:14}),"Delete"]})]})]})]})]})]})]})},Q=({boards:t,currentBoard:a,onSelect:r,onCreate:l})=>{const[i,d]=s.useState(!1),[n,o]=s.useState(!1),[c,x]=s.useState(""),[m,u]=s.useState("blue");return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!i),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:[e.jsx(B,{size:18}),e.jsx("span",{className:"font-medium",children:a?.name||"Select Board"}),e.jsx(k,{size:16})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>d(!1)}),e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-72 bg-white rounded-lg shadow-xl border z-20",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Your Boards"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(t=>e.jsxs("button",{onClick:()=>{r(t.id),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-gray-50 "+(a?.id===t.id?"bg-blue-50":""),children:[e.jsx("div",{className:"w-8 h-6 rounded",style:{backgroundColor:q[t.background]?.color||"#0079BF"}}),e.jsx("span",{className:"text-gray-900",children:t.name})]},t.id))}),e.jsx("div",{className:"p-2 border-t",children:n?e.jsxs("div",{className:"p-2 space-y-3",children:[e.jsx("input",{type:"text",value:c,onChange:e=>x(e.target.value),placeholder:"Board name",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Object.values(q).slice(0,6).map(t=>e.jsx("button",{onClick:()=>u(t.id),className:"w-8 h-6 rounded "+(m===t.id?"ring-2 ring-offset-2 ring-blue-500":""),style:{backgroundColor:t.color}},t.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{c.trim()&&(l({name:c,background:m}),x(""),u("blue"),o(!1))},className:"flex-1 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create"}),e.jsx("button",{onClick:()=>o(!1),className:"px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>o(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:[e.jsx(h,{size:18}),"Create new board"]})})]})]})]})},X=({card:t,labels:s,onDragStart:a,onDragEnd:r,onClick:l})=>{const i=R(t.due_date),d=P(e=>e.getChecklistProgress(t)),o=t.card_labels?.map(e=>s.find(t=>t.id===e.label_id)).filter(Boolean)||[],p=M[t.priority],h=c(e=>e.projects),g=x(e=>e.opportunities),b=m(e=>e.clients),f=t.project_id?h.find(e=>e.id===t.project_id):null,j=t.opportunity_id?g.find(e=>e.id===t.opportunity_id):null,v=t.client_id?b.find(e=>e.id===t.client_id):null,w=f||j||v;return e.jsxs("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("cardId",t.id),a(t)},onDragEnd:r,onClick:()=>l(t),className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:border-gray-300 cursor-pointer group transition-all hover:shadow-md",children:[t.cover_color&&e.jsx("div",{className:"h-8 rounded-t-lg",style:{backgroundColor:t.cover_color}}),e.jsxs("div",{className:"p-3",children:[w&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[f&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded",title:f.name,children:[e.jsx(y,{size:10}),f.name?.substring(0,15),f.name?.length>15?"...":""]}),j&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-1.5 py-0.5 bg-yellow-50 text-yellow-700 rounded",title:j.name,children:[e.jsx(L,{size:10}),j.name?.substring(0,15),j.name?.length>15?"...":""]}),v&&!f&&!j&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded",title:v.company,children:[e.jsx(u,{size:10}),v.company?.substring(0,15),v.company?.length>15?"...":""]})]}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:o.map(t=>e.jsx("div",{className:"h-2 w-10 rounded-full",style:{backgroundColor:I[t.color]?.color},title:t.name||I[t.color]?.label},t.id))}),e.jsx("h4",{className:"text-sm text-gray-900 font-medium",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[t.priority&&"none"!==t.priority&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:p?.color+"20",color:p?.color},children:[p?.icon," ",p?.label]}),i&&e.jsxs("span",{className:"flex items-center gap-1 text-xs px-1.5 py-0.5 rounded "+("overdue"===i.status?"bg-red-100 text-red-700":"due-soon"===i.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"),children:[e.jsx(n,{size:12}),i.text]}),t.description&&e.jsx("span",{className:"text-gray-400",children:e.jsx(D,{size:14})}),d&&e.jsxs("span",{className:"flex items-center gap-1 text-xs "+(100===d.percent?"text-green-600":"text-gray-500"),children:[e.jsx(O,{size:12}),d.completed,"/",d.total]}),t.comments?.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(z,{size:12}),t.comments.length]}),t.attachments?.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(N,{size:12}),t.attachments.length]})]}),t.assignees?.length>0&&e.jsxs("div",{className:"flex justify-end mt-2 -space-x-1",children:[t.assignees.slice(0,3).map(t=>e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 border-2 border-white flex items-center justify-center text-xs font-medium text-gray-700",title:t.users?.name,children:t.users?.avatar_url?e.jsx("img",{src:t.users.avatar_url,alt:"",className:"w-full h-full rounded-full"}):t.users?.name?.charAt(0)||"?"},t.user_id)),t.assignees.length>3&&e.jsxs("div",{className:"w-6 h-6 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center text-xs font-medium text-gray-600",children:["+",t.assignees.length-3]})]})]})]})},Z=({list:t,cards:a,labels:r,onCreateCard:l,onCardClick:d})=>{const[n,o]=s.useState(!1),[c,x]=s.useState(""),[m,u]=s.useState(!1),[p,g]=s.useState(!1),[b,y]=s.useState(t.title),j=s.useRef(null),{setDraggedCard:w,clearDragState:N,moveCard:C,updateList:k,deleteList:_}=P(),D=()=>{c.trim()&&(l(t.id,{title:c}),x(""),o(!1))},z=()=>{b.trim()&&b!==t.title&&k(t.id,{title:b}),g(!1)};return s.useEffect(()=>{p&&j.current&&(j.current.focus(),j.current.select())},[p]),e.jsxs("div",{className:"flex-shrink-0 w-72 bg-gray-100 rounded-xl flex flex-col max-h-full",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},onDrop:e=>{e.preventDefault();const s=e.dataTransfer.getData("cardId");if(s){const e=a.length;C(s,t.id,e)}N()},children:[e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[p?e.jsx("input",{ref:j,type:"text",value:b,onChange:e=>y(e.target.value),onBlur:z,onKeyDown:e=>"Enter"===e.key&&z(),className:"flex-1 px-2 py-1 font-semibold text-gray-900 bg-white border-2 border-blue-500 rounded focus:outline-none"}):e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-gray-600",onClick:()=>g(!0),children:t.title}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:a.length}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>u(!m),className:"p-1 hover:bg-gray-200 rounded",children:e.jsx(v,{size:16,className:"text-gray-500"})}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>u(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border z-20",children:[e.jsxs("button",{onClick:()=>{g(!0),u(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-gray-50",children:[e.jsx(F,{size:16}),"Rename list"]}),e.jsxs("button",{onClick:()=>{confirm("Delete this list and all its cards?")&&_(t.id)},className:"w-full flex items-center gap-2 px-3 py-2 text-left text-red-600 hover:bg-red-50",children:[e.jsx(f,{size:16}),"Delete list"]})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-3 pb-3 space-y-2",children:[a.map(t=>e.jsx(X,{card:t,labels:r,onDragStart:w,onDragEnd:N,onClick:d},t.id)),n?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-2",children:[e.jsx("textarea",{value:c,onChange:e=>x(e.target.value),placeholder:"Enter a title for this card...",className:"w-full px-2 py-1.5 text-sm border rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())}}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:D,className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Add card"}),e.jsx("button",{onClick:()=>{o(!1),x("")},className:"p-1.5 hover:bg-gray-100 rounded",children:e.jsx(i,{size:18,className:"text-gray-500"})})]})]}):e.jsxs("button",{onClick:()=>o(!0),className:"w-full flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx(h,{size:18}),"Add a card"]})]})]})},ee=({onAdd:t})=>{const[a,r]=s.useState(!1),[l,d]=s.useState(""),n=()=>{l.trim()&&(t(l),d(""),r(!1))};return a?e.jsxs("div",{className:"flex-shrink-0 w-72 bg-gray-100 rounded-xl p-3",children:[e.jsx("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Enter list title...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&n()}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add list"}),e.jsx("button",{onClick:()=>{r(!1),d("")},className:"p-2 hover:bg-gray-200 rounded-lg",children:e.jsx(i,{size:18,className:"text-gray-500"})})]})]}):e.jsxs("button",{onClick:()=>r(!0),className:"flex-shrink-0 w-72 h-12 flex items-center gap-2 px-4 bg-white/30 hover:bg-white/40 rounded-xl text-white transition-colors",children:[e.jsx(h,{size:18}),"Add another list"]})},te=({labels:t,filters:a,onFilterChange:r})=>{const[l,i]=s.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>i(!l),className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-colors "+(Object.values(a).some(e=>e?.length>0)?"bg-blue-600 text-white":"bg-white/20 hover:bg-white/30 text-white"),children:[e.jsx(_,{size:18}),"Filter"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-white rounded-lg shadow-xl border z-20 p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Filter cards"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Labels"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(t=>e.jsx("button",{onClick:()=>{const e=a.labels||[],s=e.includes(t.id)?e.filter(e=>e!==t.id):[...e,t.id];r({...a,labels:s})},className:"h-6 px-2 rounded text-xs font-medium "+((a.labels||[]).includes(t.id)?"ring-2 ring-offset-1 ring-blue-500":""),style:{backgroundColor:I[t.color]?.color,color:"white"},children:t.name||I[t.color]?.label},t.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.values(M).filter(e=>"none"!==e.id).map(t=>e.jsxs("button",{onClick:()=>{const e=a.priorities||[],s=e.includes(t.id)?e.filter(e=>e!==t.id):[...e,t.id];r({...a,priorities:s})},className:"px-2 py-1 rounded text-xs font-medium "+((a.priorities||[]).includes(t.id)?"ring-2 ring-offset-1 ring-blue-500":""),style:{backgroundColor:t.color+"20",color:t.color},children:[t.icon," ",t.label]},t.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Due date"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"overdue",label:"Overdue"},{id:"today",label:"Due today"},{id:"week",label:"Due this week"},{id:"none",label:"No due date"}].map(t=>e.jsx("button",{onClick:()=>{r({...a,dueDate:a.dueDate===t.id?null:t.id})},className:"px-2 py-1 rounded text-xs "+(a.dueDate===t.id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t.label},t.id))})]}),e.jsx("button",{onClick:()=>r({}),className:"w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg",children:"Clear all filters"})]})]})]})},se=({onCreateBoard:t,embedded:a=!1})=>{const[r,l]=s.useState(""),[i,d]=s.useState("blue");return e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50 "+(a?"min-h-[400px] rounded-xl":""),children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{size:40,className:"text-blue-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create your first board"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Organize your tasks with a Trello-style board. Create lists, add cards, and drag them around."}),e.jsxs("div",{className:"bg-white rounded-xl border p-6 text-left",children:[e.jsx("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Enter board name...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Choose a background"}),e.jsx("div",{className:"flex gap-2",children:Object.values(q).map(t=>e.jsx("button",{onClick:()=>d(t.id),className:"w-10 h-8 rounded-lg "+(i===t.id?"ring-2 ring-offset-2 ring-blue-500":""),style:{backgroundColor:t.color}},t.id))})]}),e.jsx("button",{onClick:()=>{r.trim()&&t({name:r,background:i})},disabled:!r.trim(),className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Create Board"})]})]})})},ae=({embedded:t=!1})=>{const[a,r]=s.useState(""),[l,i]=s.useState({}),{boards:d,currentBoard:n,lists:o,cards:c,labels:x,loading:m,selectedCard:u,cardDetailOpen:h,loadBoards:g,loadBoard:b,createBoard:f,createList:y,createCard:j,openCardDetail:N,closeCardDetail:k}=P();s.useEffect(()=>{g()},[]),s.useEffect(()=>{d.length>0&&!n&&b(d[0].id)},[d,n]);const _=e=>{let t=c.filter(t=>t.list_id===e);if(a){const e=a.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}if(l.labels?.length>0&&(t=t.filter(e=>e.card_labels?.some(e=>l.labels.includes(e.label_id)))),l.priorities?.length>0&&(t=t.filter(e=>l.priorities.includes(e.priority))),l.dueDate){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(s.getTime()+6048e5);t=t.filter(e=>{if("none"===l.dueDate)return!e.due_date;if(!e.due_date)return!1;const t=new Date(e.due_date);return"overdue"===l.dueDate?t<s:"today"===l.dueDate?t>=s&&t<new Date(s.getTime()+864e5):"week"!==l.dueDate||t>=s&&t<a})}return t.sort((e,t)=>e.position-t.position)},D=async e=>{const t=await f(e);b(t.id)},z=async(e,t)=>{await j(e,t)};if(m&&!n)return e.jsx("div",{className:"flex-1 flex items-center justify-center "+(t?"min-h-[400px]":""),children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(0===d.length)return e.jsx(se,{onCreateBoard:D,embedded:t});const S=q[n?.background]?.color||"#0079BF";return e.jsxs("div",{className:"flex-1 flex flex-col "+(t?"min-h-[600px] rounded-xl overflow-hidden":"h-screen"),style:{backgroundColor:S},children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-4 text-white",children:[e.jsx(Q,{boards:d,currentBoard:n,onSelect:b,onCreate:D}),e.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(w,{size:18})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/60"}),e.jsx("input",{type:"text",value:a,onChange:e=>r(e.target.value),placeholder:"Search cards...",className:"w-64 pl-10 pr-4 py-2 bg-white/20 border border-white/20 rounded-lg text-white placeholder-white/60 focus:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40"})]}),e.jsx(te,{labels:x,filters:l,onFilterChange:i}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg",children:[e.jsx(p,{size:18}),"Share"]}),e.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg",children:e.jsx(v,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden px-4 pb-4",children:e.jsxs("div",{className:"flex gap-4 h-full items-start",children:[o.map(t=>e.jsx(Z,{list:t,cards:_(t.id),labels:x,onCreateCard:z,onCardClick:N},t.id)),e.jsx(ee,{onAdd:async e=>{await y(n.id,e)}})]})}),h&&u&&e.jsx(W,{card:u,labels:x,lists:o,onClose:k})]})};export{ae as default};
