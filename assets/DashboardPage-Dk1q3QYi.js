import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{u as s,a as r,b as n,h as a,c as i,n as l,d as o,e as c,R as d,f as x}from"./index-BALy7xcB.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const m=[{id:"draft",label:"Drafts",color:"#9CA3AF",bgColor:"bg-gray-400/10"},{id:"sent",label:"Sent",color:"#0F8B8D",bgColor:"bg-[#0F8B8D]/10"},{id:"won",label:"Won",color:"#22c55e",bgColor:"bg-green-500/10"},{id:"dead",label:"Dead",color:"#F87171",bgColor:"bg-red-400/10"}],p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function u(e,t){if(!e)return null;const s=new Date(e);return s.setDate(s.getDate()+(parseInt(t)||30)),s}function h({onViewQuote:h,onNewQuote:g,onGoToOpportunities:j,onGoToKnowledge:v}){const{savedQuotes:b,clients:f,updateQuoteStatus:N}=s(),{rates:w,ratesUpdated:y,refreshRates:k,ratesLoading:D}=r(),{settings:C,setDashboardPreferences:M}=n(),{opportunities:L}=a(),{getOverdueFollowUps:S,activities:A}=i(),{fragments:F,learnings:U,getStats:B,getPendingReview:W}=l(),[E,q]=t.useState("all"),[R,P]=t.useState((new Date).getFullYear()),[Q,I]=t.useState(null),[O,T]=t.useState(null),V=C.dashboardPreferences||{},H=V.currency||"USD",z=V.collapsedColumns||{},$=V.pipelineMinimized||!1,[_,Y]=t.useState({open:!1,quoteId:null,newStatus:null}),[G,K]=t.useState(""),[J,X]=t.useState(""),Z=e=>{(e=>{const t="function"==typeof e?e(z):e;M({collapsedColumns:t})})(t=>({...t,[e]:!t[e]}))},ee=C?.users?.[0]?.name||"User",te=t.useMemo(()=>{const e=new Set;return b.forEach(t=>{const s=new Date(t.savedAt||t.createdAt);e.add(s.getFullYear())}),Array.from(e).sort((e,t)=>t-e)},[b]),se=t.useMemo(()=>b.filter(e=>{if(!e)return!1;const t=new Date(e.savedAt||e.createdAt),s=t.getFullYear()===R,r="all"===E||t.getMonth()===parseInt(E);return s&&r}).sort((e,t)=>{const s=new Date(e?.updatedAt||e?.savedAt||e?.createdAt||0);return new Date(t?.updatedAt||t?.savedAt||t?.createdAt||0)-s}),[b,E,R]),re=t.useMemo(()=>{const e={};return m.forEach(t=>{e[t.id]=se.filter(e=>(e?.status||"draft")===t.id)}),e},[se]),ne=t.useMemo(()=>{const e={};return m.forEach(t=>{e[t.id]=re[t.id].reduce((e,t)=>{const s=o(t?.sections||{},t?.fees||{});return e+c(s.totalCharge,t.currency||"USD",H,w)},0)}),e},[re,w,H]),ae=t.useMemo(()=>{let e=0,t=0,s=0,r=0,n=0,a=0,i=0,l=0;return se.forEach(d=>{const x=o(d.sections||{},d.fees||{}),m=c(x.totalCharge,d.currency||"USD",H,w),p=c(x.totalCost,d.currency||"USD",H,w);"won"===d.status?(e+=m,t+=m-p,s+=x.margin,r++):"draft"!==d.status&&"sent"!==d.status||(n+=m,a+=m-p,i+=x.margin,l++)}),L.filter(e=>"active"===e.status).forEach(e=>{const t=c(e.value||0,e.currency||"USD",H,w)*((e.probability||0)/100);n+=t,l++}),{won:{revenue:e,profit:t,avgMargin:r>0?s/r:0},pipeline:{revenue:n,profit:a,avgMargin:l>0?i/l:0}}},[se,L,w,H]),ie=t.useMemo(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()+3,e.getDate()),s=new Date(e.getFullYear(),e.getMonth()+6,e.getDate());let r={revenue:0,profit:0},n={revenue:0,profit:0},a={revenue:0,profit:0},i={revenue:0,profit:0},l={revenue:0,weighted:0},d={revenue:0,weighted:0};return b.forEach(l=>{if("dead"===l.status)return;const d=l.project?.startDate?new Date(l.project.startDate):null;if(!d||d<e)return;const x=o(l.sections||{},l.fees||{}),m=c(x.totalCharge,l.currency||"USD",H,w),p=m-c(x.totalCost,l.currency||"USD",H,w),u="won"===l.status||"approved"===l.status;d<=t&&(u?(r.revenue+=m,r.profit+=p):(n.revenue+=m,n.profit+=p)),d<=s&&(u?(a.revenue+=m,a.profit+=p):(i.revenue+=m,i.profit+=p))}),L.filter(e=>"active"===e.status).forEach(r=>{const n=r.expectedCloseDate?new Date(r.expectedCloseDate):null;if(!n||n<e)return;const a=c(r.value||0,r.currency||"USD",H,w),i=a*((r.probability||0)/100);n<=t&&(l.revenue+=a,l.weighted+=i),n<=s&&(d.revenue+=a,d.weighted+=i)}),{threeMonth:{won:r,pipeline:n,opportunities:l,total:{revenue:r.revenue+n.revenue+l.weighted,profit:r.profit+n.profit}},sixMonth:{won:a,pipeline:i,opportunities:d,total:{revenue:a.revenue+i.revenue+d.weighted,profit:a.profit+i.profit}}}},[b,L,w,H]),le=t.useMemo(()=>{const e=L.filter(e=>"active"===e.status),t=e.reduce((e,t)=>e+c(t.value||0,t.currency||"USD",H,w),0),s=e.reduce((e,t)=>{const s=(t.probability||0)/100;return e+c(t.value||0,t.currency||"USD",H,w)*s},0),r={};Object.keys(d).forEach(t=>{const s=e.filter(e=>e.region===t);r[t]={count:s.length,value:s.reduce((e,t)=>e+c(t.value||0,t.currency||"USD",H,w),0)}});const n=new Date,a=new Date(n.getTime()+6048e5),i=e.filter(e=>{if(!e.nextActionDate)return!1;const t=new Date(e.nextActionDate);return t>=n&&t<=a}).sort((e,t)=>new Date(e.nextActionDate)-new Date(t.nextActionDate)).slice(0,5);return{totalCount:e.length,totalValue:t,weightedValue:s,wonCount:L.filter(e=>"won"===e.status).length,lostCount:L.filter(e=>"lost"===e.status).length,byRegion:r,upcomingActions:i}},[L,H,w]),oe=t.useMemo(()=>{const e=new Date,t=b.filter(t=>{if("sent"!==t.status)return!1;const s=u(t.quoteDate,t.validityDays);if(!s)return!1;const r=Math.ceil((s-e)/864e5);return r>0&&r<=7}).map(t=>{const s=u(t.quoteDate,t.validityDays),r=Math.ceil((s-e)/864e5);return{...t,daysUntilExpiry:r,expiryDate:s}}).sort((e,t)=>e.daysUntilExpiry-t.daysUntilExpiry),s=S().map(t=>{const s=f.find(e=>e.id===t.clientId),r=Math.floor((e-new Date(t.followUpDate))/864e5);return{...t,clientName:s?.company||"Unknown Client",daysOverdue:r}});return{expiringQuotes:t,overdueFollowUps:s,totalCount:t.length+s.length}},[b,f,S]),ce=t.useMemo(()=>{const e=B(),t=W(),s={market_insight:"Market Insights",pricing_strategy:"Pricing Strategy",client_preference:"Client Preferences",competitor_intel:"Competitor Intel",process_tip:"Process Tips",regional_pattern:"Regional Patterns"},r=Object.entries(e.byType||{}).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e,t])=>({type:e,label:s[e]||e,count:t}));return{...e,pendingCount:t.totalCount,pendingFragments:t.fragments.length,pendingLearnings:t.learnings.length,topTypes:r}},[F,U,B,W]),de=e=>{if(e.client?.company)return e.client.company;const t=f.find(t=>t.id===e.clientId);return t?.company||"Unknown"},xe=()=>{},me=()=>{I(null),T(null)};return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-dark-bg border-b border-dark-border p-3 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-semibold text-gray-100",children:["Welcome back, ",ee]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-400 mt-0.5",children:"Pipeline Dashboard"})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-3",children:e.jsxs("button",{onClick:()=>g&&g(),className:"btn-primary flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"New Quote"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 hidden sm:inline",children:"Filters:"}),e.jsxs("select",{value:R,onChange:e=>P(parseInt(e.target.value)),className:"input-sm text-sm w-20 sm:w-32 min-h-[40px]",children:[0===te.length&&e.jsx("option",{value:(new Date).getFullYear(),children:(new Date).getFullYear()}),te.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:E,onChange:e=>q(e.target.value),className:"input-sm text-sm w-24 sm:w-40 min-h-[40px]",children:[e.jsx("option",{value:"all",children:"All Months"}),p.map((t,s)=>e.jsx("option",{value:s,children:t},t))]}),e.jsx("div",{className:"hidden sm:block h-4 w-px bg-dark-border mx-2"}),e.jsx("span",{className:"text-sm text-gray-400 hidden sm:inline",children:"View:"}),e.jsxs("select",{value:H,onChange:e=>{return t=e.target.value,void M({currency:t});var t},className:"input-sm text-sm w-20 sm:w-24 min-h-[40px]",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"AED",children:"AED"}),e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"QAR",children:"QAR"}),e.jsx("option",{value:"KWD",children:"KWD"})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-4",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Rates: ",y?new Date(y).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never"]}),e.jsx("button",{onClick:k,disabled:D,className:"p-2 min-w-[32px] min-h-[32px] hover:text-white transition-colors "+(D?"animate-spin":""),title:"Refresh Exchange Rates",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[se.length," quotes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-900/30 to-green-950/20 border-green-800/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-[10px] font-medium text-green-400/90 uppercase tracking-wide",children:"Won"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:x(ae.won.revenue,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-green-400 tabular-nums",children:x(ae.won.profit,H,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-[#0F8B8D]/10 to-[#143642]/10 border-[#0F8B8D]/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#0F8B8D]"}),e.jsx("span",{className:"text-[10px] font-medium text-[#0F8B8D]/90 uppercase tracking-wide",children:"Pipeline"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-200 tabular-nums",children:x(ae.pipeline.revenue,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Profit"}),e.jsx("p",{className:"text-sm font-semibold text-gray-300 tabular-nums",children:x(ae.pipeline.profit,H,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-amber-900/20 to-amber-950/10 border-amber-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-[10px] font-medium text-amber-400/90 uppercase tracking-wide",children:"3-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:x(ie.threeMonth.won.revenue,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:x(ie.threeMonth.pipeline.revenue,H,0)})]}),ie.threeMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:x(ie.threeMonth.opportunities.weighted,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-amber-800/30",children:[e.jsx("p",{className:"text-[10px] text-amber-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-amber-400 tabular-nums",children:x(ie.threeMonth.total.revenue,H,0)})]})]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-900/20 to-purple-950/10 border-purple-800/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-[10px] font-medium text-purple-400/90 uppercase tracking-wide",children:"6-Month Forecast"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-green-500",children:"Won"}),e.jsx("p",{className:"text-xs font-medium text-green-400 tabular-nums",children:x(ie.sixMonth.won.revenue,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"Quotes"}),e.jsx("p",{className:"text-xs font-medium text-gray-400 tabular-nums",children:x(ie.sixMonth.pipeline.revenue,H,0)})]}),ie.sixMonth.opportunities.weighted>0&&e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-[10px] text-cyan-500",children:"Opps"}),e.jsx("p",{className:"text-xs font-medium text-cyan-400 tabular-nums",children:x(ie.sixMonth.opportunities.weighted,H,0)})]}),e.jsxs("div",{className:"flex justify-between items-baseline pt-1 border-t border-purple-800/30",children:[e.jsx("p",{className:"text-[10px] text-purple-400",children:"Total"}),e.jsx("p",{className:"text-sm font-semibold text-purple-400 tabular-nums",children:x(ie.sixMonth.total.revenue,H,0)})]})]})]})]}),e.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0 sm:overflow-visible",children:m.map(t=>e.jsx("div",{className:`flex-shrink-0 sm:flex-1 min-w-[140px] sm:min-w-0 rounded-lg px-3 py-2 ${t.bgColor} border border-white/5`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:t.label}),e.jsxs("span",{className:"text-xs text-gray-600 tabular-nums",children:["(",re[t.id].length,")"]})]}),e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:x(ne[t.id],H)})]})},t.id))}),oe.totalCount>0&&e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-red-900/20 to-orange-950/10 border-red-800/20",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-red-400",children:"Action Required"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",oe.totalCount," items)"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[oe.expiringQuotes.length>0&&e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-xs font-medium text-amber-400 uppercase tracking-wide",children:"Expiring Soon"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",oe.expiringQuotes.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[oe.expiringQuotes.slice(0,5).map(t=>e.jsxs("button",{onClick:()=>h&&h(t),className:"w-full flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors text-left group",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-gray-200 truncate group-hover:text-white",children:t.quoteNumber}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:de(t)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded "+(t.daysUntilExpiry<=2?"bg-red-500/20 text-red-400":"bg-amber-500/20 text-amber-400"),children:1===t.daysUntilExpiry?"1 day":`${t.daysUntilExpiry} days`}),e.jsx("svg",{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},t.id)),oe.expiringQuotes.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-1",children:["+",oe.expiringQuotes.length-5," more"]})]})]}),oe.overdueFollowUps.length>0&&e.jsxs("div",{className:"bg-dark-bg/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),e.jsx("span",{className:"text-xs font-medium text-orange-400 uppercase tracking-wide",children:"Overdue Follow-ups"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",oe.overdueFollowUps.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[oe.overdueFollowUps.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-gray-200 truncate",children:t.title||"Follow-up"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.clientName})]}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded ml-2 "+(t.daysOverdue>7?"bg-red-500/20 text-red-400":"bg-orange-500/20 text-orange-400"),children:0===t.daysOverdue?"Today":1===t.daysOverdue?"1 day ago":`${t.daysOverdue}d overdue`})]},t.id)),oe.overdueFollowUps.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-1",children:["+",oe.overdueFollowUps.length-5," more"]})]})]})]})]}),L.length>0&&e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-cyan-900/20 to-cyan-950/10 border-cyan-800/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("span",{className:"text-sm font-semibold text-cyan-400",children:"Opportunities Pipeline"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",le.totalCount," active)"]})]}),e.jsxs("button",{onClick:()=>j&&j(),className:"text-xs text-cyan-400 hover:text-cyan-300 flex items-center gap-1",children:["View All",e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Pipeline"}),e.jsx("p",{className:"text-lg font-bold text-cyan-400",children:x(le.totalValue,H,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Weighted"}),e.jsx("p",{className:"text-lg font-bold text-amber-400",children:x(le.weightedValue,H,0)})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Won"}),e.jsx("p",{className:"text-lg font-bold text-green-400",children:le.wonCount})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Lost"}),e.jsx("p",{className:"text-lg font-bold text-red-400",children:le.lostCount})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(le.byRegion).map(([t,s])=>s.count>0&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-dark-bg/30 rounded text-xs",children:[e.jsx("span",{className:"text-gray-400",children:t}),e.jsxs("span",{className:"text-gray-500",children:["(",s.count,")"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:x(s.value,H,0)})]},t))}),le.upcomingActions.length>0&&e.jsxs("div",{className:"border-t border-cyan-800/20 pt-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider mb-2",children:"Upcoming Actions"}),e.jsx("div",{className:"space-y-1",children:le.upcomingActions.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-300 truncate max-w-[200px]",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-cyan-400",children:t.nextAction}),e.jsx("span",{className:"text-gray-500",children:new Date(t.nextActionDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]},t.id))})]})]}),e.jsxs("div",{className:"mt-6 card bg-gradient-to-br from-violet-900/20 to-violet-950/10 border-violet-800/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-violet-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-violet-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-violet-400",children:"AI Knowledge Base"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Commercial intelligence for better quotes"})]})]}),e.jsxs("button",{onClick:()=>v&&v(),className:"text-xs text-violet-400 hover:text-violet-300 flex items-center gap-1",children:["Manage",e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Knowledge"}),e.jsx("p",{className:"text-lg font-bold text-violet-400",children:ce.totalFragments}),e.jsxs("p",{className:"text-[9px] text-gray-600",children:[ce.verifiedFragments," verified"]})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Learnings"}),e.jsx("p",{className:"text-lg font-bold text-indigo-400",children:ce.totalLearnings}),e.jsxs("p",{className:"text-[9px] text-gray-600",children:[ce.verifiedLearnings," applied"]})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Confidence"}),e.jsx("p",{className:"text-lg font-bold text-emerald-400",children:ce.avgConfidence>0?`${(100*ce.avgConfidence).toFixed(0)}%`:"-"}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"avg score"})]}),e.jsxs("div",{className:"text-center p-2 bg-dark-bg/50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Pending"}),e.jsx("p",{className:"text-lg font-bold "+(ce.pendingCount>0?"text-amber-400":"text-gray-500"),children:ce.pendingCount}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"to review"})]})]}),ce.topTypes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:ce.topTypes.map(({type:t,label:s,count:r})=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-dark-bg/30 rounded text-xs",children:[e.jsx("span",{className:"text-gray-400",children:s}),e.jsx("span",{className:"text-violet-400 font-medium",children:r})]},t))}),0===ce.totalFragments&&e.jsxs("div",{className:"border-t border-violet-800/20 pt-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Start building your commercial intelligence by capturing market insights, pricing strategies, and client preferences."}),e.jsxs("button",{onClick:()=>v&&v(),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-violet-400 hover:text-white bg-violet-500/10 hover:bg-violet-500/20 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add First Knowledge"]})]}),ce.pendingCount>0&&e.jsx("div",{className:"border-t border-violet-800/20 pt-3",children:e.jsxs("button",{onClick:()=>v&&v(),className:"w-full flex items-center justify-between p-2 rounded-lg bg-amber-500/10 hover:bg-amber-500/15 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("span",{className:"text-xs text-amber-400",children:[ce.pendingFragments>0&&`${ce.pendingFragments} knowledge items`,ce.pendingFragments>0&&ce.pendingLearnings>0&&" and ",ce.pendingLearnings>0&&`${ce.pendingLearnings} learnings`," ","awaiting review"]})]}),e.jsx("svg",{className:"w-4 h-4 text-gray-600 group-hover:text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("button",{onClick:()=>{M({pipelineMinimized:!$})},className:"flex items-center gap-2 text-sm font-semibold text-gray-400 mb-3 hover:text-white transition-colors min-h-[44px]",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform "+($?"":"rotate-90"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Pipeline Board",e.jsxs("span",{className:"text-xs text-gray-600 font-normal",children:["(",se.length," quotes)"]})]}),!$&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 items-start",children:m.map(t=>{const r=z[t.id];return e.jsxs("div",{className:"space-y-2 rounded-xl transition-colors "+(O===t.id?"bg-white/5 ring-2 ring-[#0F8B8D]/30":""),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",O!==t&&T(t)})(e,t.id),onDrop:e=>((e,t)=>{e.preventDefault(),T(null),I(null);const s=e.dataTransfer.getData("quoteId");s&&("rejected"===t||"expired"===t||"dead"===t?Y({open:!0,quoteId:s,newStatus:t}):N(s,t))})(e,t.id),onDragLeave:xe,children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer",style:{backgroundColor:`${t.color}20`},onClick:()=>Z(t.id),title:r?"Expand column":"Collapse column",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:t.label}),r?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]}),!r&&e.jsx("div",{className:"space-y-3 px-1 pb-3",children:0===re[t.id].length?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-dark-border/50 rounded-xl bg-dark-bg/30",children:[e.jsx("svg",{className:"w-10 h-10 mx-auto mb-3 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsxs("p",{className:"text-gray-400 text-sm mb-3",children:["No ",t.label.toLowerCase()," quotes"]}),"draft"===t.id&&e.jsxs("button",{onClick:()=>g&&g(),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-brand-teal hover:text-white bg-brand-teal/10 hover:bg-brand-teal/20 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create your first quote"]}),"draft"!==t.id&&e.jsx("p",{className:"text-xs text-gray-500",children:"Drag quotes here to update status"})]}):re[t.id].map(r=>{const n=o(r.sections||{},r.fees||{}),a=c(n.totalCharge,r.currency||"USD",H,w),i=function(e,t){const s=u(e,t);return!!s&&new Date>s}(r.quoteDate,r.validityDays),l=!i&&function(e,t,s=7){const r=u(e,t);if(!r)return!1;const n=new Date,a=Math.ceil((r-n)/864e5);return a>0&&a<=s}(r.quoteDate,r.validityDays),d=!!(m=r.nextFollowUpDate)&&new Date(m)<new Date;var m;const p=l||d;return e.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{I(t),e.dataTransfer.setData("quoteId",t),e.dataTransfer.effectAllowed="move"})(e,r.id),onDragEnd:me,onClick:()=>h&&h(r),className:`w-full card text-left hover:border-white/15 transition-all cursor-move\n                                                            ${Q===r.id?"opacity-50 scale-95":"opacity-100"}\n                                                            ${p?"border-amber-500/30 bg-amber-500/5":""}\n                                                            ${i?"border-red-500/30 bg-red-500/5 opacity-60":""}\n                                                            active:cursor-grabbing hover:shadow-lg group relative`,children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete this quote?")&&s.getState().deleteQuote(r.id)},className:"p-2 min-w-[36px] min-h-[36px] text-gray-500 hover:text-red-400 bg-dark-card rounded shadow-sm border border-dark-border flex items-center justify-center",title:"Delete Quote",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"flex justify-between items-start mb-1.5 pr-6 gap-2",children:[e.jsx("p",{className:"text-[11px] text-gray-500 font-mono tracking-tight",children:r.quoteNumber}),e.jsxs("div",{className:"flex gap-1 items-center flex-wrap",children:[i&&e.jsx("span",{className:"text-[9px] bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded font-medium",title:"Quote has expired",children:"EXPIRED"}),l&&e.jsx("span",{className:"text-[9px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded font-medium",title:"Expires within 7 days",children:"EXPIRING"}),d&&e.jsxs("span",{className:"text-[9px] bg-orange-500/20 text-orange-400 px-1.5 py-0.5 rounded font-medium flex items-center gap-0.5",title:`Follow-up was due on ${new Date(r.nextFollowUpDate).toLocaleDateString()}`,children:[e.jsx("svg",{className:"w-2.5 h-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),"DUE"]}),r.project?.startDate&&e.jsx("span",{className:"text-[10px] bg-dark-bg/70 px-1.5 py-0.5 rounded text-gray-500",children:new Date(r.project.startDate).toLocaleDateString([],{month:"short",day:"numeric"})})]})]}),e.jsx("p",{className:"text-sm font-medium text-gray-200 mb-0.5 truncate",children:de(r)}),r.project?.title&&e.jsx("p",{className:"text-xs text-gray-500 truncate mb-2",children:r.project.title}),e.jsx("div",{className:"flex items-center justify-between pt-1 border-t border-white/5",children:e.jsx("span",{className:"text-sm font-semibold tabular-nums",style:{color:t.color},children:x(a,H)})})]},r.id)})})]},t.id)})})]}),_.open&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-2",children:"rejected"===_.newStatus?"Quote Rejected":"expired"===_.newStatus?"Quote Expired":"Quote Lost"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Help us track why this opportunity didn't close"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Reason"}),e.jsxs("select",{value:G,onChange:e=>K(e.target.value),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"price",children:"Price too high"}),e.jsx("option",{value:"timing",children:"Wrong timing"}),e.jsx("option",{value:"lost_to_competitor",children:"Lost to competitor"}),e.jsx("option",{value:"no_budget",children:"No budget"}),e.jsx("option",{value:"requirements_mismatch",children:"Requirements didn't match"}),e.jsx("option",{value:"client_unresponsive",children:"Client unresponsive"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{value:J,onChange:e=>X(e.target.value),placeholder:"Any additional context...",rows:3,className:"input resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>{Y({open:!1,quoteId:null,newStatus:null}),K(""),X("")},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{_.quoteId&&_.newStatus&&N(_.quoteId,_.newStatus,J,G,J),Y({open:!1,quoteId:null,newStatus:null}),K(""),X("")},disabled:!G,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Update Status"})]})]})})]})}export{h as default};
