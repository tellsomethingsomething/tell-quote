import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{i as s,c as a,u as l,g as r,a as i,f as n,R as c,h as o}from"./index-qIMeUE46.js";import{A as d}from"./ActivityTimeline-Bm7xZSh3.js";import{L as x}from"./LogActivityModal-BZwTrHA2.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";import"./contactStore-DEZO6BUG.js";const m={high:"bg-red-500/20 text-red-400 border-red-500/30",medium:"bg-amber-500/20 text-amber-400 border-amber-500/30",low:"bg-blue-500/20 text-blue-400 border-blue-500/30"},h={new_opportunity:"New Lead",discovery:"Discovery",proposal:"Proposal",follow_up:"Follow Up",negotiation:"Negotiation",at_risk:"At Risk",closing:"Closing"};function p({opportunity:r}){const{getSmartTasks:i,completeTask:n,skipTask:c,addSuggestedTask:o,getContext:d}=s(),{activities:x}=a(),{savedQuotes:p}=l(),[u,j]=t.useState(null),[g,b]=t.useState(!1),v=t.useMemo(()=>i(r,x,p),[r,x,p,i]),y=d(r?.id),N=(y?.completedTasks||[]).slice(-5).reverse();if(!r||"won"===r.status||"lost"===r.status)return null;const f=v[0]?.stage;return e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Suggested Next Steps"}),f&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Stage: ",h[f]||f]})]})]}),N.length>0&&e.jsxs("button",{onClick:()=>b(!g),className:"text-xs text-gray-500 hover:text-gray-300",children:[g?"Hide":"Show"," completed (",N.length,")"]})]}),0===v.length?e.jsxs("div",{className:"text-center py-6 text-gray-500 text-sm",children:[e.jsx("svg",{className:"w-8 h-8 mx-auto mb-2 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{children:"All caught up! No pending tasks."}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Tasks will appear as the deal progresses"})]}):e.jsx("div",{className:"space-y-2",children:v.map((t,s)=>e.jsxs("div",{className:"border rounded-lg transition-all "+(u===t.id?"border-purple-500/50 bg-purple-500/5":"border-dark-border hover:border-gray-600"),children:[e.jsx("button",{onClick:()=>j(u===t.id?null:t.id),className:"w-full p-3 text-left",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`mt-0.5 px-1.5 py-0.5 text-[10px] font-bold rounded border ${m[t.priority]}`,children:s+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-200",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-1",children:t.description})]}),e.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(u===t.id?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),u===t.id&&e.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-dark-border",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>(e=>{y.suggestedTasks.find(t=>t.id===e.id)||o(r.id,e),setTimeout(()=>n(r.id,e.id),100),j(null)})(t),className:"flex-1 py-2 text-xs font-medium bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Done"]}),e.jsx("button",{onClick:()=>((e,t="")=>{y.suggestedTasks.find(t=>t.id===e.id)||o(r.id,e),setTimeout(()=>c(r.id,e.id,t),100),j(null)})(t,"not relevant"),className:"py-2 px-3 text-xs text-gray-500 hover:text-gray-300 hover:bg-white/5 rounded-lg transition-colors",children:"Skip"})]})]})]},t.id))}),g&&N.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-2",children:"Recently Completed"}),e.jsx("div",{className:"space-y-1",children:N.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"line-through",children:t.title}),e.jsx("span",{className:"text-gray-600",children:new Date(t.completedAt).toLocaleDateString()})]},s))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-dark-border flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Tasks adapt based on deal stage and your completion patterns"})]})]})}const u={active:"bg-blue-400/20 text-blue-400",won:"bg-green-500/20 text-green-500",lost:"bg-red-500/20 text-red-500"};function j({opportunityId:s,onBack:m,onConvertToQuote:h}){const{getOpportunity:j,updateOpportunity:g,deleteOpportunity:b,addContact:v,updateContact:y,deleteContact:N}=r(),{clients:f}=l(),{loadQuoteData:w,setClient:k,setProject:C,setFees:A}=i(),{getOpportunityActivities:D,deleteActivity:L,completeTask:S,initialize:M}=a(),B=j(s),W=D(s);t.useEffect(()=>{M()},[M]);const[I,P]=t.useState(!1),[T,E]=t.useState({}),[R,z]=t.useState(!1),[O,V]=t.useState(null),[U,F]=t.useState({}),[H,G]=t.useState(!1);if(t.useEffect(()=>{const e=e=>{"Escape"===e.key&&(R?z(!1):I&&P(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R,I]),!B)return e.jsx("div",{className:"h-[calc(100vh-60px)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400",children:"Opportunity not found"}),e.jsx("button",{onClick:m,className:"btn-ghost mt-4",children:"Back to Opportunities"})]})});const $=(e=null)=>{e?(V(e.id),F({...e})):(V(null),F({name:"",role:"",email:"",phone:"",isPrimary:!1})),z(!0)},Q=B.contacts||[],q=Q.find(e=>e.isPrimary);return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-y-auto p-6 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:m,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-white/5 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:B.title||"Untitled Opportunity"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${u[B.status]}`,children:B.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("span",{children:B.country}),e.jsx("span",{children:"•"}),e.jsx("span",{children:B.region}),B.client?.company&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:B.client.company})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["active"===B.status&&e.jsx("button",{onClick:()=>{const e=(B.clientId?f.find(e=>e.id===B.clientId):null)||B.client||{},t=B.contacts?.find(e=>e.isPrimary)||B.contacts?.[0];h&&h({client:{company:e.company||"",contact:t?.name||e.contact||"",email:t?.email||e.email||"",phone:t?.phone||e.phone||"",address:e.address||""},project:{title:B.title,description:B.brief,startDate:B.expectedCloseDate},opportunityId:B.id,estimatedValue:B.value||0,currency:B.currency||"USD",country:B.country,region:B.region,contacts:B.contacts||[]}),g(B.id,{status:"won"})},className:"btn-primary text-sm",children:"Convert to Quote"}),e.jsx("button",{onClick:()=>{E({title:B.title||"",clientId:B.clientId||"",newClientName:"",clientWebsite:"",clientLocation:"",clientAddress:"",country:B.country||"",value:B.value||0,currency:B.currency||"USD",probability:B.probability||50,source:B.source||"",competitors:(B.competitors||[]).join(", "),brief:B.brief||"",notes:B.notes||"",nextAction:B.nextAction||"",nextActionDate:B.nextActionDate||"",expectedCloseDate:B.expectedCloseDate||""}),P(!0)},className:"btn-ghost text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this opportunity?")&&(b(B.id),m())},className:"p-2 text-gray-500 hover:text-red-400 rounded-lg hover:bg-white/5",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Deal Value"}),e.jsxs("select",{value:B.status,onChange:e=>{return t=e.target.value,void g(B.id,{status:t});var t},className:"input-sm text-sm bg-dark-bg",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Value"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n(B.value||0,B.currency||"USD",0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Probability"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[B.probability||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Weighted Value"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:n((B.value||0)*((B.probability||0)/100),B.currency||"USD",0)})]})]})]}),B.brief&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Brief"}),e.jsx("p",{className:"text-gray-400 whitespace-pre-wrap",children:B.brief})]}),(B.nextAction||B.nextActionDate)&&e.jsxs("div",{className:"card bg-amber-900/10 border-amber-500/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-400 mb-3",children:"Next Action"}),e.jsx("p",{className:"text-gray-300",children:B.nextAction||"No action specified"}),B.nextActionDate&&e.jsxs("p",{className:"text-sm text-amber-400 mt-2",children:["Due: ",new Date(B.nextActionDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Contacts"}),e.jsx("button",{onClick:()=>$(),className:"btn-ghost text-sm",children:"Add Contact"})]}),0===Q.length?e.jsx("p",{className:"text-gray-500 italic",children:"No contacts added"}):e.jsx("div",{className:"space-y-3",children:Q.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg/50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/20 text-accent-primary flex items-center justify-center font-bold",children:t.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200",children:t.name}),t.isPrimary&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:"Primary"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.role||"No role"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.email&&e.jsx("a",{href:`mailto:${t.email}`,className:"text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),t.phone&&e.jsx("a",{href:`tel:${t.phone}`,className:"text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),e.jsx("button",{onClick:()=>$(t),className:"text-gray-500 hover:text-white opacity-0 group-hover:opacity-100",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>{return e=t.id,void(window.confirm("Delete this contact?")&&N(B.id,e));var e},className:"text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))})]}),B.notes&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Notes"}),e.jsx("p",{className:"text-gray-400 whitespace-pre-wrap",children:B.notes})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Activity History"}),e.jsxs("button",{onClick:()=>G(!0),className:"btn-ghost text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Log Activity"]})]}),e.jsx(d,{activities:W,onDelete:L,onCompleteTask:S,emptyMessage:"No activities logged yet. Track your interactions with this opportunity.",maxItems:20})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{opportunity:B}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Country"}),e.jsx("p",{className:"text-gray-200",children:B.country||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Region"}),e.jsx("p",{className:"text-gray-200",children:B.region||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Source"}),e.jsx("p",{className:"text-gray-200",children:B.source||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Expected Close"}),e.jsx("p",{className:"text-gray-200",children:B.expectedCloseDate?new Date(B.expectedCloseDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Created"}),e.jsx("p",{className:"text-gray-200",children:new Date(B.createdAt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})]})]}),B.competitors&&B.competitors.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Competitors"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.competitors.map((t,s)=>e.jsx("span",{className:"px-2 py-1 bg-red-500/10 text-red-400 rounded text-sm",children:t},s))})]}),q&&e.jsxs("div",{className:"card bg-accent-primary/5 border-accent-primary/20",children:[e.jsx("h2",{className:"text-sm font-semibold text-accent-primary mb-3",children:"Primary Contact"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/20 text-accent-primary flex items-center justify-center font-bold",children:q.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-200",children:q.name}),e.jsx("p",{className:"text-xs text-gray-500",children:q.role||"No role"})]})]}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[q.email&&e.jsx("a",{href:`mailto:${q.email}`,className:"block text-gray-400 hover:text-white",children:q.email}),q.phone&&e.jsx("a",{href:`tel:${q.phone}`,className:"block text-gray-400 hover:text-white",children:q.phone})]})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>P(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-6",children:"Edit Opportunity"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();let t=T.clientId,s={};if(T.clientId){const e=f.find(e=>e.id===T.clientId);s={company:e?.company||"",id:e?.id}}else if(T.newClientName?.trim()){const e=await l.getState().addClient({company:T.newClientName.trim(),website:T.clientWebsite,location:T.clientLocation,address:T.clientAddress});t=e.id,s={company:T.newClientName.trim(),id:e.id}}g(B.id,{title:T.title,clientId:t||null,client:s,country:T.country,region:o(T.country),value:parseFloat(T.value)||0,currency:T.currency,probability:T.probability,source:T.source,competitors:T.competitors.split(",").map(e=>e.trim()).filter(Boolean),brief:T.brief,notes:T.notes,nextAction:T.nextAction,nextActionDate:T.nextActionDate||null,expectedCloseDate:T.expectedCloseDate||null}),P(!1)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Client"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Select Client"}),e.jsxs("select",{value:T.clientId,onChange:e=>E({...T,clientId:e.target.value,newClientName:""}),className:"input w-full",children:[e.jsx("option",{value:"",children:"-- Select existing client or add new --"}),f.map(t=>e.jsx("option",{value:t.id,children:t.company},t.id))]})]}),!T.clientId&&e.jsxs("div",{className:"space-y-4 p-4 bg-dark-bg/30 rounded-lg border border-dark-border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Or Create New Client"}),e.jsx("input",{type:"text",value:T.newClientName||"",onChange:e=>E({...T,newClientName:e.target.value}),className:"input w-full",placeholder:"Company name..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Website"}),e.jsx("input",{type:"url",value:T.clientWebsite||"",onChange:e=>E({...T,clientWebsite:e.target.value}),className:"input w-full",placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location / City"}),e.jsx("input",{type:"text",value:T.clientLocation||"",onChange:e=>E({...T,clientLocation:e.target.value}),className:"input w-full",placeholder:"e.g. Kuala Lumpur"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address"}),e.jsx("textarea",{value:T.clientAddress||"",onChange:e=>E({...T,clientAddress:e.target.value}),className:"input w-full resize-none",rows:2,placeholder:"Full address..."})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Opportunity Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Title"}),e.jsx("input",{type:"text",value:T.title,onChange:e=>E({...T,title:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsxs("select",{value:T.country,onChange:e=>E({...T,country:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"Select country..."}),Object.entries(c).map(([t,s])=>e.jsx("optgroup",{label:t,children:s.map(t=>e.jsx("option",{value:t,children:t},t))},t))]})]})]}),T.clientId&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Link Contacts from Client"}),(()=>{const t=f.find(e=>e.id===T.clientId),s=t?.contacts||[];return 0===s.length?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No contacts on this client. Add contacts after saving."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"These are the contacts from the selected client. You can add them to this opportunity from the Contacts section after saving."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(t=>e.jsxs("span",{className:"text-xs bg-dark-bg/50 px-2 py-1 rounded text-gray-300",children:[t.name," ",t.role?`(${t.role})`:""]},t.id))})]})})()]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Financials"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Value"}),e.jsx("input",{type:"number",value:T.value,onChange:e=>E({...T,value:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{value:T.currency,onChange:e=>E({...T,currency:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"AED",children:"AED"}),e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"QAR",children:"QAR"}),e.jsx("option",{value:"KWD",children:"KWD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Probability (%)"}),e.jsx("input",{type:"number",value:T.probability,onChange:e=>E({...T,probability:parseInt(e.target.value)||0}),className:"input w-full",min:"0",max:"100"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Sales Info"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Source"}),e.jsxs("select",{value:T.source,onChange:e=>E({...T,source:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"-- Select source --"}),e.jsx("option",{value:"referral",children:"Referral"}),e.jsx("option",{value:"repeat-client",children:"Repeat Client"}),e.jsx("option",{value:"website",children:"Website"}),e.jsx("option",{value:"cold-call",children:"Cold Call"}),e.jsx("option",{value:"event",children:"Event / Trade Show"}),e.jsx("option",{value:"social-media",children:"Social Media"}),e.jsx("option",{value:"partner",children:"Partner"}),e.jsx("option",{value:"tender",children:"Tender / RFP"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Expected Close Date"}),e.jsx("input",{type:"date",value:T.expectedCloseDate,onChange:e=>E({...T,expectedCloseDate:e.target.value}),className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Competitors (comma-separated)"}),e.jsx("input",{type:"text",value:T.competitors,onChange:e=>E({...T,competitors:e.target.value}),className:"input w-full",placeholder:"e.g. Company A, Company B"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Brief / Description"}),e.jsx("textarea",{value:T.brief,onChange:e=>E({...T,brief:e.target.value}),className:"input w-full min-h-[80px] resize-none",placeholder:"Describe the project requirements..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider border-b border-dark-border pb-2",children:"Actions & Notes"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Next Action"}),e.jsx("input",{type:"text",value:T.nextAction,onChange:e=>E({...T,nextAction:e.target.value}),className:"input w-full",placeholder:"e.g. Send proposal, Follow up call"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Next Action Date"}),e.jsx("input",{type:"date",value:T.nextActionDate,onChange:e=>E({...T,nextActionDate:e.target.value}),className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{value:T.notes,onChange:e=>E({...T,notes:e.target.value}),className:"input w-full min-h-[80px] resize-none",placeholder:"Any additional notes..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[e.jsx("button",{type:"button",onClick:()=>P(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Save Changes"})]})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/75 backdrop-blur-md modal-backdrop p-4",children:e.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:O?"Edit Contact":"Add Contact"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),O?y(B.id,O,U):v(B.id,U),z(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:U.name||"",onChange:e=>F({...U,name:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role"}),e.jsx("input",{type:"text",value:U.role||"",onChange:e=>F({...U,role:e.target.value}),className:"input w-full",placeholder:"e.g. Marketing Director"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",value:U.email||"",onChange:e=>F({...U,email:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsx("input",{type:"tel",value:U.phone||"",onChange:e=>F({...U,phone:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:U.isPrimary||!1,onChange:e=>F({...U,isPrimary:e.target.checked}),className:"w-4 h-4 rounded border-gray-600 text-accent-primary focus:ring-accent-primary bg-dark-bg"}),e.jsx("label",{htmlFor:"isPrimary",className:"text-sm text-gray-300",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:O?"Save Changes":"Add Contact"})]})]})]})}),e.jsx(x,{isOpen:H,onClose:()=>G(!1),clientId:B.clientId,opportunityId:s,contacts:B.contacts||[]})]})}export{j as default};
