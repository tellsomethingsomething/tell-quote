import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{u as s,b as a,a as r,c as l,d as n,f as o}from"./index-ByJ_yCEx.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const i=[{id:"all",label:"All Quotes",color:"gray"},{id:"draft",label:"Draft",color:"gray"},{id:"sent",label:"Sent",color:"blue"},{id:"under_review",label:"Under Review",color:"amber"},{id:"approved",label:"Approved",color:"emerald"},{id:"won",label:"Won",color:"green"},{id:"rejected",label:"Rejected",color:"red"},{id:"expired",label:"Expired",color:"gray"},{id:"dead",label:"Dead",color:"red"}];function c({onEditQuote:c,onNewQuote:d}){const{savedQuotes:x,updateQuoteStatus:u,deleteQuote:p}=s(),{settings:m}=a(),{rates:h}=r(),[j,g]=t.useState(""),[b,v]=t.useState("all"),[f,N]=t.useState(""),[y,w]=t.useState(""),[k,C]=t.useState(""),[S,q]=t.useState(""),[D,L]=t.useState("USD"),[A,E]=t.useState("updatedAt"),[M,Q]=t.useState("desc"),[B,P]=t.useState(null),[W,R]=t.useState(""),[U,_]=t.useState({open:!1,quoteId:null,newStatus:null}),[H,z]=t.useState(""),[I,V]=t.useState(""),G=t.useMemo(()=>{const e=new Set;return x.forEach(t=>{t.client?.company&&e.add(t.client.company)}),Array.from(e).sort()},[x]),T=t.useMemo(()=>{const e=new Set;return x.forEach(t=>{(t.tags||[]).forEach(t=>e.add(t))}),Array.from(e).sort()},[x]),F=t.useMemo(()=>{let e=[...x];if(j){const t=j.toLowerCase();e=e.filter(e=>e.quoteNumber?.toLowerCase().includes(t)||e.client?.company?.toLowerCase().includes(t)||e.client?.contact?.toLowerCase().includes(t)||e.project?.title?.toLowerCase().includes(t)||(e.tags||[]).some(e=>e.toLowerCase().includes(t)))}return"all"!==b&&(e=e.filter(e=>e.status===b)),f&&(e=e.filter(e=>e.client?.company===f)),y&&(e=e.filter(e=>(e.tags||[]).includes(y))),k&&(e=e.filter(e=>e.quoteDate>=k)),S&&(e=e.filter(e=>e.quoteDate<=S)),e.sort((e,t)=>{let s,a;switch(A){case"quoteNumber":s=e.quoteNumber||"",a=t.quoteNumber||"";break;case"client":s=e.client?.company||"",a=t.client?.company||"";break;case"project":s=e.project?.title||"",a=t.project?.title||"";break;case"total":s=l(e.sections||{},e.fees||{}).totalCharge,a=l(t.sections||{},t.fees||{}).totalCharge;break;case"status":s=e.status||"draft",a=t.status||"draft";break;case"quoteDate":s=e.quoteDate||"",a=t.quoteDate||"";break;default:s=e.updatedAt||"",a=t.updatedAt||""}return"asc"===M?s>a?1:-1:s<a?1:-1}),e},[x,j,b,f,y,k,S,A,M]),Y=e=>{A===e?Q("asc"===M?"desc":"asc"):(E(e),Q("desc"))},$=({field:t})=>A!==t?e.jsx("span",{className:"text-gray-600 ml-1",children:"↕"}):e.jsx("span",{className:"text-accent-primary ml-1",children:"asc"===M?"↑":"↓"}),K=e=>{switch(e){case"sent":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"under_review":return"bg-amber-400/20 text-amber-400 border-amber-400/30";case"approved":return"bg-emerald-500/20 text-emerald-400 border-emerald-500/30";case"won":return"bg-green-500/20 text-green-400 border-green-500/30";case"rejected":case"dead":return"bg-red-500/20 text-red-400 border-red-500/30";case"expired":return"bg-gray-600/20 text-gray-500 border-gray-600/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},O=e=>{const t=m.users?.find(t=>t.id===e);return t?.name||"-"},J=e=>{if(!W.trim())return;const t=x.find(t=>t.id===e);if(t){const a=[...t.tags||[],W.trim()];s.getState().updateQuote(e,{tags:a})}R("")},X=(e,t)=>{"rejected"===t||"expired"===t||"dead"===t?_({open:!0,quoteId:e,newStatus:t}):u(e,t)},Z=t.useMemo(()=>{let e=0,t=0,s=0;return F.forEach(a=>{const r=l(a.sections||{},a.fees||{}).totalCharge,o=n(r,a.currency||"USD",D,h);e+=o,"won"===a.status&&(t+=o),"sent"!==a.status&&"draft"!==a.status||(s+=o)}),{total:e,won:t,pipeline:s,count:F.length}},[F,D,h]);return e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-dark-border bg-dark-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-100",children:"Quotes"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-400",children:[Z.count," quotes found"]})]}),e.jsx("button",{onClick:()=>d(),className:"btn-primary min-h-[44px] text-sm sm:text-base",children:"+ New Quote"})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:j,onChange:e=>g(e.target.value),placeholder:"Search quotes, clients, tags...",className:"input pl-10 w-full min-h-[44px]"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("select",{value:b,onChange:e=>v(e.target.value),className:"input min-h-[44px] w-full sm:w-36",children:i.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsxs("select",{value:f,onChange:e=>N(e.target.value),className:"input min-h-[44px] w-full sm:w-44",children:[e.jsx("option",{value:"",children:"All Clients"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:y,onChange:e=>w(e.target.value),className:"input min-h-[44px] w-full sm:w-36 hidden sm:block",children:[e.jsx("option",{value:"",children:"All Tags"}),T.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:D,onChange:e=>L(e.target.value),className:"input min-h-[44px] w-full sm:w-24",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"AED",children:"AED"})]})]}),e.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"From:"}),e.jsx("input",{type:"date",value:k,onChange:e=>C(e.target.value),className:"input w-36 text-sm min-h-[36px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"To:"}),e.jsx("input",{type:"date",value:S,onChange:e=>q(e.target.value),className:"input w-36 text-sm min-h-[36px]"})]}),(j||"all"!==b||f||y||k||S)&&e.jsx("button",{onClick:()=>{g(""),v("all"),N(""),w(""),C(""),q("")},className:"text-xs text-gray-400 hover:text-gray-200 min-h-[36px] px-2",children:"Clear filters"})]}),e.jsxs("div",{className:"flex gap-4 sm:gap-6 mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"flex-1 sm:flex-none",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500",children:"Total"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-gray-200",children:o(Z.total,D)})]}),e.jsxs("div",{className:"flex-1 sm:flex-none",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500",children:"Won"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-green-400",children:o(Z.won,D)})]}),e.jsxs("div",{className:"flex-1 sm:flex-none",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500",children:"Pipeline"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-blue-400",children:o(Z.pipeline,D)})]})]})]}),e.jsx("div",{className:"md:hidden flex-1 overflow-auto p-3 space-y-3",children:0===F.length?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-gray-400 mb-4",children:j||"all"!==b||f?"No quotes match your filters":"No quotes yet"}),e.jsxs("button",{onClick:()=>d(),className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-teal hover:bg-brand-teal-light rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create your first quote"]})]}):F.map(t=>{const s=l(t.sections||{},t.fees||{}).totalCharge,a=n(s,t.currency||"USD",D,h);return e.jsxs("div",{onClick:()=>c(t),className:"bg-dark-card border border-dark-border rounded-lg p-4 cursor-pointer active:bg-dark-card/80 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs text-accent-primary",children:t.quoteNumber||"-"}),e.jsx("h3",{className:"text-sm font-medium text-gray-200 mt-0.5",children:t.client?.company||"-"})]}),e.jsxs("select",{value:t.status||"draft",onChange:e=>{e.stopPropagation(),X(t.id,e.target.value)},onClick:e=>e.stopPropagation(),className:`text-xs px-2 py-1 min-h-[32px] rounded border ${K(t.status)}`,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"dead",children:"Dead"})]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:[t.project?.title&&e.jsx("p",{children:t.project.title}),t.client?.contact&&e.jsx("p",{className:"text-gray-500",children:t.client.contact})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-dark-border",children:[e.jsx("span",{className:"text-sm font-bold text-gray-200",children:o(a,D)}),e.jsx("span",{className:"text-xs text-gray-500",children:t.quoteDate?new Date(t.quoteDate).toLocaleDateString():"-"})]}),(t.tags||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 pt-2 border-t border-dark-border",children:t.tags.map(t=>e.jsx("span",{className:"px-2 py-0.5 bg-accent-primary/20 text-accent-primary text-xs rounded-full",children:t},t))})]},t.id)})}),e.jsx("div",{className:"hidden md:block flex-1 overflow-auto p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 bg-dark-bg",children:e.jsxs("tr",{className:"text-left text-xs text-gray-500 border-b border-dark-border",children:[e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300",onClick:()=>Y("quoteNumber"),children:["Quote # ",e.jsx($,{field:"quoteNumber"})]}),e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300",onClick:()=>Y("client"),children:["Client ",e.jsx($,{field:"client"})]}),e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300",onClick:()=>Y("project"),children:["Project ",e.jsx($,{field:"project"})]}),e.jsx("th",{className:"pb-3 pr-4",children:"Prepared By"}),e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300",onClick:()=>Y("quoteDate"),children:["Date ",e.jsx($,{field:"quoteDate"})]}),e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300 text-right",onClick:()=>Y("total"),children:["Value ",e.jsx($,{field:"total"})]}),e.jsxs("th",{className:"pb-3 pr-4 cursor-pointer hover:text-gray-300",onClick:()=>Y("status"),children:["Status ",e.jsx($,{field:"status"})]}),e.jsx("th",{className:"pb-3 pr-4",children:"Tags"}),e.jsx("th",{className:"pb-3 w-20"})]})}),e.jsx("tbody",{children:0===F.length?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"py-16 text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-gray-400 mb-4",children:j||"all"!==b||f?"No quotes match your filters":"No quotes yet"}),e.jsxs("button",{onClick:()=>d(),className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-teal hover:bg-brand-teal-light rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create your first quote"]})]})}):F.map(t=>{const a=l(t.sections||{},t.fees||{}).totalCharge,r=n(a,t.currency||"USD",D,h);return e.jsxs("tr",{className:"border-b border-dark-border hover:bg-dark-card/50 cursor-pointer transition-colors group",onClick:()=>c(t),children:[e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:"font-mono text-sm text-gray-300",children:t.quoteNumber||"-"})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200",children:t.client?.company||"-"}),e.jsx("p",{className:"text-xs text-gray-500",children:t.client?.contact})]})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200",children:t.project?.title||"-"}),e.jsx("p",{className:"text-xs text-gray-500",children:t.project?.venue})]})}),e.jsx("td",{className:"py-3 pr-4 text-sm text-gray-400",children:O(t.preparedBy)}),e.jsx("td",{className:"py-3 pr-4 text-sm text-gray-400",children:t.quoteDate?new Date(t.quoteDate).toLocaleDateString():"-"}),e.jsxs("td",{className:"py-3 pr-4 text-right",children:[e.jsx("span",{className:"text-sm font-medium text-gray-200",children:o(r,D)}),t.currency!==D&&e.jsx("p",{className:"text-xs text-gray-500",children:o(a,t.currency)})]}),e.jsx("td",{className:"py-3 pr-4",onClick:e=>e.stopPropagation(),children:e.jsxs("select",{value:t.status||"draft",onChange:e=>X(t.id,e.target.value),className:`text-xs px-2 py-1 min-h-[36px] rounded border ${K(t.status)}`,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"dead",children:"Dead"})]})}),e.jsx("td",{className:"py-3 pr-4",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[(t.tags||[]).map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-accent-primary/20 text-accent-primary text-xs rounded-full",children:[a,e.jsx("button",{onClick:()=>((e,t)=>{const a=x.find(t=>t.id===e);if(a){const r=(a.tags||[]).filter(e=>e!==t);s.getState().updateQuote(e,{tags:r})}})(t.id,a),className:"hover:text-red-400 min-w-[20px] min-h-[20px]",children:"×"})]},a)),B===t.id?e.jsx("input",{type:"text",value:W,onChange:e=>R(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(J(t.id),P(null)),"Escape"===e.key&&(P(null),R(""))},onBlur:()=>{W.trim()&&J(t.id),P(null),R("")},placeholder:"Add tag...",className:"w-20 px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded",autoFocus:!0}):e.jsx("button",{onClick:()=>P(t.id),className:"text-gray-600 hover:text-gray-400 text-xs min-h-[28px] px-2",children:"+ tag"})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),c(t)},className:"p-2 min-w-[36px] min-h-[36px] text-gray-600 hover:text-blue-400",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),confirm("Delete this quote?")&&p(t.id)},className:"p-2 min-w-[36px] min-h-[36px] text-gray-600 hover:text-red-400",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},t.id)})})]})}),U.open&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-2",children:"rejected"===U.newStatus?"Quote Rejected":"expired"===U.newStatus?"Quote Expired":"Quote Lost"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Help us track why this opportunity didn't close"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Reason"}),e.jsxs("select",{value:H,onChange:e=>z(e.target.value),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"price",children:"Price too high"}),e.jsx("option",{value:"timing",children:"Wrong timing"}),e.jsx("option",{value:"lost_to_competitor",children:"Lost to competitor"}),e.jsx("option",{value:"no_budget",children:"No budget"}),e.jsx("option",{value:"requirements_mismatch",children:"Requirements didn't match"}),e.jsx("option",{value:"client_unresponsive",children:"Client unresponsive"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{value:I,onChange:e=>V(e.target.value),placeholder:"Any additional context...",rows:3,className:"input resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsx("button",{onClick:()=>{_({open:!1,quoteId:null,newStatus:null}),z(""),V("")},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:()=>{U.quoteId&&U.newStatus&&u(U.quoteId,U.newStatus,I,H,I),_({open:!1,quoteId:null,newStatus:null}),z(""),V("")},disabled:!H,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Update Status"})]})]})})]})}export{c as default};
