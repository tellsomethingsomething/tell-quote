import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as a}from"./zustand-vendor-BohoUguQ.js";import{aG as t,am as s,u as l,ao as r,f as n,aH as i,aI as c}from"./index-DoA-9vkb.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";function d(){const{contracts:d,loading:o,createContract:x,updateContract:p,deleteContract:m,updateStatus:u,getExpiringContracts:h}=t(),{projects:j}=s(),{clients:v}=l(),{crew:g}=r(),[N,y]=a.useState(!1),[b,f]=a.useState(null),[w,C]=a.useState("all"),[D,I]=a.useState("all"),[k,S]=a.useState(""),[L,A]=a.useState({title:"",contractType:"other",projectId:"",clientId:"",crewId:"",partyName:"",partyEmail:"",partyCompany:"",startDate:"",endDate:"",expiresAt:"",value:0,currency:"USD",description:"",notes:""}),E=a.useMemo(()=>d.filter(e=>{if("all"!==w&&e.status!==w)return!1;if("all"!==D&&e.contractType!==D)return!1;if(k){const a=k.toLowerCase();return e.contractRef?.toLowerCase().includes(a)||e.title?.toLowerCase().includes(a)||e.partyName?.toLowerCase().includes(a)||e.partyCompany?.toLowerCase().includes(a)}return!0}),[d,w,D,k]),T=a.useMemo(()=>h(30),[d]),M=a.useMemo(()=>{const e=d;return{total:e.length,draft:e.filter(e=>"draft"===e.status).length,pending:e.filter(e=>["pending_review","sent"].includes(e.status)).length,active:e.filter(e=>["signed","active"].includes(e.status)).length,expiring:T.length,totalValue:e.filter(e=>["signed","active"].includes(e.status)).reduce((e,a)=>e+(a.value||0),0)}},[d,T]),U=()=>{A({title:"",contractType:"other",projectId:"",clientId:"",crewId:"",partyName:"",partyEmail:"",partyCompany:"",startDate:"",endDate:"",expiresAt:"",value:0,currency:"USD",description:"",notes:""}),f(null)},P=e=>{const a=j.find(a=>a.id===e);return a?.name||""},z=e=>{const a=v.find(a=>a.id===e);return a?.company||""},B=e=>{const a=g.find(a=>a.id===e);return a?.name||""};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-100",children:"Contracts"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage crew, vendor, and client agreements"})]}),e.jsxs("button",{onClick:()=>{U(),y(!0)},className:"btn-primary flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Contract"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-6 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:M.total})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Draft"}),e.jsx("p",{className:"text-lg font-semibold text-gray-400",children:M.draft})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-amber-400",children:M.pending})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Active"}),e.jsx("p",{className:"text-lg font-semibold text-green-400",children:M.active})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Expiring"}),e.jsx("p",{className:"text-lg font-semibold text-red-400",children:M.expiring})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Value"}),e.jsx("p",{className:"text-lg font-semibold text-teal-400",children:n(M.totalValue,"USD",0)})]})]}),T.length>0&&e.jsxs("div",{className:"card bg-gradient-to-br from-red-900/20 to-red-950/10 border-red-800/30 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm font-medium text-red-400",children:"Contracts Expiring Soon"})]}),e.jsx("div",{className:"space-y-1",children:T.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-300",children:a.title}),e.jsx("span",{className:"text-gray-500",children:new Date(a.expiresAt).toLocaleDateString()})]},a.id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search contracts...",value:k,onChange:e=>S(e.target.value),className:"input w-full sm:w-64"}),e.jsxs("select",{value:w,onChange:e=>C(e.target.value),className:"input w-full sm:w-40",children:[e.jsx("option",{value:"all",children:"All Statuses"}),Object.entries(i).map(([a,{label:t}])=>e.jsx("option",{value:a,children:t},a))]}),e.jsxs("select",{value:D,onChange:e=>I(e.target.value),className:"input w-full sm:w-40",children:[e.jsx("option",{value:"all",children:"All Types"}),Object.entries(c).map(([a,{label:t}])=>e.jsx("option",{value:a,children:t},a))]})]}),e.jsx("div",{className:"space-y-3",children:0===E.length?e.jsx("div",{className:"card p-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No contracts found"})}):E.map(a=>e.jsx("div",{className:"card p-4 hover:border-white/10 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-mono text-gray-500",children:a.contractRef}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded border ${i[a.status]?.color||"text-gray-400"}`,children:i[a.status]?.label||a.status}),e.jsx("span",{className:"text-xs text-gray-600",children:c[a.contractType]?.label})]}),e.jsx("p",{className:"font-medium text-gray-100 truncate",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1 text-xs text-gray-500",children:[a.partyName&&e.jsx("span",{children:a.partyName}),a.partyCompany&&e.jsxs("span",{children:["(",a.partyCompany,")"]}),a.projectId&&e.jsx("span",{className:"text-cyan-500",children:P(a.projectId)}),a.clientId&&e.jsx("span",{className:"text-blue-500",children:z(a.clientId)}),a.crewId&&e.jsx("span",{className:"text-purple-500",children:B(a.crewId)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[a.value>0&&e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:n(a.value,a.currency)}),a.startDate&&a.endDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(a.startDate).toLocaleDateString()," - ",new Date(a.endDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>(e=>{f(e),A({title:e.title||"",contractType:e.contractType||"other",projectId:e.projectId||"",clientId:e.clientId||"",crewId:e.crewId||"",partyName:e.partyName||"",partyEmail:e.partyEmail||"",partyCompany:e.partyCompany||"",startDate:e.startDate||"",endDate:e.endDate||"",expiresAt:e.expiresAt?e.expiresAt.split("T")[0]:"",value:e.value||0,currency:e.currency||"USD",description:e.description||"",notes:e.notes||""}),y(!0)})(a),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this contract?")&&await m(e)})(a.id),className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})},a.id))}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:b?"Edit Contract":"New Contract"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const a={...L,expiresAt:L.expiresAt?new Date(L.expiresAt).toISOString():null};b?await p(b.id,a):await x(a),y(!1),U()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Title"}),e.jsx("input",{type:"text",value:L.title,onChange:e=>A(a=>({...a,title:e.target.value})),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Type"}),e.jsx("select",{value:L.contractType,onChange:e=>A(a=>({...a,contractType:e.target.value})),className:"input",children:Object.entries(c).map(([a,{label:t}])=>e.jsx("option",{value:a,children:t},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Project"}),e.jsxs("select",{value:L.projectId,onChange:e=>A(a=>({...a,projectId:e.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"None"}),j.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Client"}),e.jsxs("select",{value:L.clientId,onChange:e=>A(a=>({...a,clientId:e.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"None"}),v.map(a=>e.jsx("option",{value:a.id,children:a.company},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Crew Member"}),e.jsxs("select",{value:L.crewId,onChange:e=>A(a=>({...a,crewId:e.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"None"}),g.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Party Name"}),e.jsx("input",{type:"text",value:L.partyName,onChange:e=>A(a=>({...a,partyName:e.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Party Email"}),e.jsx("input",{type:"email",value:L.partyEmail,onChange:e=>A(a=>({...a,partyEmail:e.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Party Company"}),e.jsx("input",{type:"text",value:L.partyCompany,onChange:e=>A(a=>({...a,partyCompany:e.target.value})),className:"input"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Start Date"}),e.jsx("input",{type:"date",value:L.startDate,onChange:e=>A(a=>({...a,startDate:e.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"End Date"}),e.jsx("input",{type:"date",value:L.endDate,onChange:e=>A(a=>({...a,endDate:e.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Expires At"}),e.jsx("input",{type:"date",value:L.expiresAt,onChange:e=>A(a=>({...a,expiresAt:e.target.value})),className:"input"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Contract Value"}),e.jsx("input",{type:"number",value:L.value,onChange:e=>A(a=>({...a,value:parseFloat(e.target.value)||0})),className:"input",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{value:L.currency,onChange:e=>A(a=>({...a,currency:e.target.value})),className:"input",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:L.description,onChange:e=>A(a=>({...a,description:e.target.value})),className:"input resize-none",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{value:L.notes,onChange:e=>A(a=>({...a,notes:e.target.value})),className:"input resize-none",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-border",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),U()},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:b?"Update Contract":"Create Contract"})]})]})]})})})]})}export{d as default};
