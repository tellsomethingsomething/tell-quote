import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{ar as r,l as a,am as s,as as n,at as o}from"./index-g2Iar00F.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";function l({bookings:r,onDateClick:a,selectedDate:s}){const[o,l]=t.useState(new Date),i=(e=>{const t=e.getFullYear(),r=e.getMonth(),a=new Date(t,r,1),s=new Date(t,r+1,0).getDate(),n=a.getDay(),o=[];for(let l=0;l<n;l++)o.push(null);for(let l=1;l<=s;l++)o.push(new Date(t,r,l));return o})(o),d=(new Date).toISOString().split("T")[0],c=o.toLocaleString("default",{month:"long",year:"numeric"});return e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsx("button",{onClick:()=>{l(new Date(o.getFullYear(),o.getMonth()-1,1))},className:"p-2 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:c}),e.jsx("button",{onClick:()=>{l(new Date(o.getFullYear(),o.getMonth()+1,1))},className:"p-2 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-dark-border",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:i.map((t,o)=>{if(!t)return e.jsx("div",{className:"h-24 border-r border-b border-dark-border last:border-r-0 bg-dark-bg/50"},`empty-${o}`);const l=t.toISOString().split("T")[0],i=(e=>{if(!e)return[];const t=e.toISOString().split("T")[0];return r.filter(e=>e.startDate<=t&&e.endDate>=t&&e.status!==n.CANCELLED)})(t),c=l===d,x=l===s;return e.jsxs("div",{onClick:()=>a(l),className:"h-24 border-r border-b border-dark-border last:border-r-0 p-1 cursor-pointer transition-colors hover:bg-white/5 "+(x?"bg-accent-primary/10":""),children:[e.jsx("div",{className:"text-sm font-medium mb-1 "+(c?"text-accent-primary":0===t.getDay()||6===t.getDay()?"text-gray-500":"text-gray-300"),children:t.getDate()}),e.jsxs("div",{className:"space-y-0.5 overflow-hidden",children:[i.slice(0,3).map((t,r)=>e.jsx("div",{className:"text-xs px-1 py-0.5 rounded truncate",style:{backgroundColor:t.categoryColor?`${t.categoryColor}30`:"#3B82F630",color:t.categoryColor||"#3B82F6"},title:`${t.kitCode||t.kitName} - ${t.projectName||t.purpose||"No project"}`,children:t.kitCode||t.kitName?.substring(0,10)},t.id)),i.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 px-1",children:["+",i.length-3," more"]})]})]},l)})})]})}function i({booking:t,onEdit:r,onStatusChange:a}){const s=o[t.status]||o.pending;return e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4 hover:border-gray-600 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:t.categoryColor?`${t.categoryColor}20`:"#3B82F620",color:t.categoryColor||"#3B82F6"},children:t.kitCode||"KIT"}),e.jsx("h3",{className:"font-semibold text-white truncate",children:t.kitName||"Unknown Item"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsxs("span",{children:[new Date(t.startDate).toLocaleDateString()," - ",new Date(t.endDate).toLocaleDateString()]}),e.jsxs("span",{className:"text-gray-600",children:["(",t.totalDays||1," days)"]})]}),(t.projectName||t.purpose)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("span",{children:t.projectName||t.purpose})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.bgClass} ${s.textClass}`,children:t.displayStatus||s.label}),t.daysOverdue>0&&e.jsxs("span",{className:"text-xs text-red-400",children:[t.daysOverdue," days overdue"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t border-dark-border",children:[t.status===n.PENDING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(t.id,n.CONFIRMED),className:"px-3 py-1.5 text-xs font-medium bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors",children:"Confirm"}),e.jsx("button",{onClick:()=>a(t.id,n.CANCELLED),className:"px-3 py-1.5 text-xs font-medium text-gray-400 hover:text-red-400 transition-colors",children:"Cancel"})]}),t.status===n.CONFIRMED&&e.jsx("button",{onClick:()=>a(t.id,n.CHECKED_OUT),className:"px-3 py-1.5 text-xs font-medium bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors",children:"Check Out"}),t.status===n.CHECKED_OUT&&e.jsx("button",{onClick:()=>a(t.id,n.RETURNED),className:"px-3 py-1.5 text-xs font-medium bg-gray-500/20 text-gray-300 rounded-lg hover:bg-gray-500/30 transition-colors",children:"Mark Returned"}),e.jsx("button",{onClick:()=>r(t),className:"px-3 py-1.5 text-xs font-medium text-gray-400 hover:text-white transition-colors ml-auto",children:"Edit"})]})]})}function d({isOpen:a,onClose:s,initialDate:n,kitItems:o,projects:l}){const i=r(e=>e.createBooking),d=r(e=>e.checkAvailability),[c,x]=t.useState(!1),[m,u]=t.useState(null),[h,g]=t.useState({kitItemId:"",quantity:1,startDate:n||(new Date).toISOString().split("T")[0],endDate:n||(new Date).toISOString().split("T")[0],projectId:"",purpose:"",notes:""});t.useEffect(()=>{(async()=>{if(h.kitItemId&&h.startDate&&h.endDate){const e=await d(h.kitItemId,h.startDate,h.endDate,h.quantity);u(e)}else u(null)})()},[h.kitItemId,h.startDate,h.endDate,h.quantity,d]);if(!a)return null;const p=o.find(e=>e.id===h.kitItemId);return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[#1a1f2e] border border-dark-border rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-dark-border",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"New Kit Booking"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h.kitItemId&&h.startDate&&h.endDate){x(!0);try{await i(h),s(!0)}catch(t){alert("Failed to create booking")}finally{x(!1)}}},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Equipment *"}),e.jsxs("select",{value:h.kitItemId,onChange:e=>g({...h,kitItemId:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select equipment..."}),o.filter(e=>"available"===e.status||"on_job"===e.status).map(t=>e.jsxs("option",{value:t.id,children:[t.kitId," - ",t.name," (",t.categoryName,")"]},t.id))]})]}),p&&p.quantity>1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["Quantity (max: ",p.quantityAvailable||p.quantity,")"]}),e.jsx("input",{type:"number",min:"1",max:p.quantityAvailable||p.quantity,value:h.quantity,onChange:e=>g({...h,quantity:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Start Date *"}),e.jsx("input",{type:"date",value:h.startDate,onChange:e=>g({...h,startDate:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"End Date *"}),e.jsx("input",{type:"date",value:h.endDate,min:h.startDate,onChange:e=>g({...h,endDate:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none",required:!0})]})]}),m&&e.jsx("div",{className:"p-3 rounded-lg "+(m.isAvailable?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"),children:m.isAvailable?e.jsxs("p",{className:"text-sm text-green-400",children:["Available (",m.availableQuantity," units)"]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-400 mb-2",children:"Not available for selected dates"}),m.conflicts?.length>0&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Conflicts with ",m.conflicts.length," existing booking(s)"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Project"}),e.jsxs("select",{value:h.projectId,onChange:e=>g({...h,projectId:e.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"No project (standalone)"}),l.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),!h.projectId&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Purpose"}),e.jsx("input",{type:"text",value:h.purpose,onChange:e=>g({...h,purpose:e.target.value}),placeholder:"e.g., Maintenance, Testing, Personal use",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:border-accent-primary focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Notes"}),e.jsx("textarea",{value:h.notes,onChange:e=>g({...h,notes:e.target.value}),rows:2,placeholder:"Any special requirements or notes...",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:border-accent-primary focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c||!h.kitItemId||m&&!m.isAvailable,className:"px-6 py-2 bg-accent-primary text-white rounded-lg font-medium hover:bg-accent-primary/90 transition-colors disabled:opacity-50",children:c?"Creating...":"Create Booking"})]})]})]})})}function c(){const{bookings:o,loading:c,getUpcoming:x,getOverdue:m,getPendingApproval:u,updateBooking:h,getStats:g}=r(),{items:p}=a(),{projects:b}=s(),[j,v]=t.useState("calendar"),[k,y]=t.useState(null),[N,f]=t.useState(!1),[w,C]=t.useState("all"),D=g(),I=x(),S=m(),E=u(),L=t.useMemo(()=>"all"===w?o:"upcoming"===w?I:"overdue"===w?S:"pending"===w?E:o.filter(e=>e.status===w),[o,w,I,S,E]),M=t.useMemo(()=>k?o.filter(e=>e.startDate<=k&&e.endDate>=k&&e.status!==n.CANCELLED):[],[o,k]),O=async(e,t)=>{try{await h(e,{status:t})}catch(r){alert("Failed to update booking status")}},B=e=>{};return e.jsxs("div",{className:"p-4 lg:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Kit Bookings"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Schedule and track equipment usage"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent-primary text-white rounded-lg font-medium hover:bg-accent-primary/90 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Booking"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:D.active}),e.jsx("p",{className:"text-sm text-gray-400",children:"Active"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:D.pending}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pending"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:D.checkedOut}),e.jsx("p",{className:"text-sm text-gray-400",children:"Checked Out"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:D.overdue}),e.jsx("p",{className:"text-sm text-gray-400",children:"Overdue"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:D.upcomingWeek}),e.jsx("p",{className:"text-sm text-gray-400",children:"This Week"})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:D.total}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex bg-dark-card border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>v("calendar"),className:"px-4 py-2 flex items-center gap-2 "+("calendar"===j?"bg-accent-primary/20 text-accent-primary":"text-gray-400 hover:text-white"),children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Calendar"]}),e.jsxs("button",{onClick:()=>v("list"),className:"px-4 py-2 flex items-center gap-2 "+("list"===j?"bg-accent-primary/20 text-accent-primary":"text-gray-400 hover:text-white"),children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),"List"]})]}),"list"===j&&e.jsxs("select",{value:w,onChange:e=>C(e.target.value),className:"px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white focus:border-accent-primary focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Bookings"}),e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"pending",children:"Pending Approval"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:n.CONFIRMED,children:"Confirmed"}),e.jsx("option",{value:n.CHECKED_OUT,children:"Checked Out"}),e.jsx("option",{value:n.RETURNED,children:"Returned"}),e.jsx("option",{value:n.CANCELLED,children:"Cancelled"})]})]}),c&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}),!c&&"calendar"===j&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(l,{bookings:o,onDateClick:y,selectedDate:k})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:k?`Bookings for ${new Date(k).toLocaleDateString()}`:"Select a date to view bookings"}),e.jsx("div",{className:"space-y-4",children:M.length>0?M.map(t=>e.jsx(i,{booking:t,onEdit:B,onStatusChange:O},t.id)):k?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No bookings for this date"}),e.jsx("button",{onClick:()=>f(!0),className:"mt-2 text-accent-primary hover:text-accent-primary/80",children:"Create booking"})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"Click on a date to view bookings"})})})]})]}),!c&&"list"===j&&e.jsx("div",{className:"space-y-4",children:L.length>0?L.map(t=>e.jsx(i,{booking:t,onEdit:B,onStatusChange:O},t.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No bookings found"}),e.jsx("p",{className:"mb-4",children:"Create your first equipment booking to get started"}),e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent-primary text-white rounded-lg font-medium hover:bg-accent-primary/90 transition-colors",children:"New Booking"})]})}),e.jsx(d,{isOpen:N,onClose:e=>{f(!1),e&&y(null)},initialDate:k,kitItems:p,projects:b})]})}export{c as default};
