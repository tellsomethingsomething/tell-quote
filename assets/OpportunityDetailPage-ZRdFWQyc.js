import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{e as s,u as a,a as l,f as r,R as n,g as i}from"./index-BIxG9Rq0.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const c={active:"bg-blue-400/20 text-blue-400",won:"bg-green-500/20 text-green-500",lost:"bg-red-500/20 text-red-500"};function o({opportunityId:o,onBack:d,onConvertToQuote:x}){const{getOpportunity:m,updateOpportunity:h,deleteOpportunity:p,addContact:u,updateContact:j,deleteContact:v}=s(),{clients:b}=a(),{loadQuoteData:g,setClient:y,setProject:N,setFees:f}=l(),C=m(o),[w,k]=t.useState(!1),[D,A]=t.useState({}),[L,S]=t.useState(!1),[B,P]=t.useState(null),[E,M]=t.useState({});if(t.useEffect(()=>{const e=e=>{"Escape"===e.key&&(L?S(!1):w&&k(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[L,w]),!C)return e.jsx("div",{className:"h-[calc(100vh-60px)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400",children:"Opportunity not found"}),e.jsx("button",{onClick:d,className:"btn-ghost mt-4",children:"Back to Opportunities"})]})});const R=(e=null)=>{e?(P(e.id),M({...e})):(P(null),M({name:"",role:"",email:"",phone:"",isPrimary:!1})),S(!0)},W=C.contacts||[],I=W.find(e=>e.isPrimary);return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-y-auto p-6 relative",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-white/5 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:C.title||"Untitled Opportunity"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${c[C.status]}`,children:C.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("span",{children:C.country}),e.jsx("span",{children:"•"}),e.jsx("span",{children:C.region}),C.client?.company&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:C.client.company})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["active"===C.status&&e.jsx("button",{onClick:()=>{const e=C.client||{};x&&x({client:e,project:{title:C.title,description:C.brief},opportunityId:C.id,estimatedValue:C.value}),h(C.id,{status:"won"})},className:"btn-primary text-sm",children:"Convert to Quote"}),e.jsx("button",{onClick:()=>{A({title:C.title||"",clientId:C.clientId||"",country:C.country||"",value:C.value||0,currency:C.currency||"USD",probability:C.probability||50,source:C.source||"",competitors:(C.competitors||[]).join(", "),brief:C.brief||"",notes:C.notes||"",nextAction:C.nextAction||"",nextActionDate:C.nextActionDate||"",expectedCloseDate:C.expectedCloseDate||""}),k(!0)},className:"btn-ghost text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this opportunity?")&&(p(C.id),d())},className:"p-2 text-gray-500 hover:text-red-400 rounded-lg hover:bg-white/5",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Deal Value"}),e.jsxs("select",{value:C.status,onChange:e=>{return t=e.target.value,void h(C.id,{status:t});var t},className:"input-sm text-sm bg-dark-bg",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Value"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:r(C.value||0,C.currency||"USD",0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Probability"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[C.probability||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Weighted Value"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:r((C.value||0)*((C.probability||0)/100),C.currency||"USD",0)})]})]})]}),C.brief&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Brief"}),e.jsx("p",{className:"text-gray-400 whitespace-pre-wrap",children:C.brief})]}),(C.nextAction||C.nextActionDate)&&e.jsxs("div",{className:"card bg-amber-900/10 border-amber-500/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-amber-400 mb-3",children:"Next Action"}),e.jsx("p",{className:"text-gray-300",children:C.nextAction||"No action specified"}),C.nextActionDate&&e.jsxs("p",{className:"text-sm text-amber-400 mt-2",children:["Due: ",new Date(C.nextActionDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Contacts"}),e.jsx("button",{onClick:()=>R(),className:"btn-ghost text-sm",children:"Add Contact"})]}),0===W.length?e.jsx("p",{className:"text-gray-500 italic",children:"No contacts added"}):e.jsx("div",{className:"space-y-3",children:W.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg/50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/20 text-accent-primary flex items-center justify-center font-bold",children:t.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200",children:t.name}),t.isPrimary&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:"Primary"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.role||"No role"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.email&&e.jsx("a",{href:`mailto:${t.email}`,className:"text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),t.phone&&e.jsx("a",{href:`tel:${t.phone}`,className:"text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),e.jsx("button",{onClick:()=>R(t),className:"text-gray-500 hover:text-white opacity-0 group-hover:opacity-100",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>{return e=t.id,void(window.confirm("Delete this contact?")&&v(C.id,e));var e},className:"text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))})]}),C.notes&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Notes"}),e.jsx("p",{className:"text-gray-400 whitespace-pre-wrap",children:C.notes})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Country"}),e.jsx("p",{className:"text-gray-200",children:C.country||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Region"}),e.jsx("p",{className:"text-gray-200",children:C.region||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Source"}),e.jsx("p",{className:"text-gray-200",children:C.source||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Expected Close"}),e.jsx("p",{className:"text-gray-200",children:C.expectedCloseDate?new Date(C.expectedCloseDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Created"}),e.jsx("p",{className:"text-gray-200",children:new Date(C.createdAt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})]})]}),C.competitors&&C.competitors.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200 mb-3",children:"Competitors"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.competitors.map((t,s)=>e.jsx("span",{className:"px-2 py-1 bg-red-500/10 text-red-400 rounded text-sm",children:t},s))})]}),I&&e.jsxs("div",{className:"card bg-accent-primary/5 border-accent-primary/20",children:[e.jsx("h2",{className:"text-sm font-semibold text-accent-primary mb-3",children:"Primary Contact"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/20 text-accent-primary flex items-center justify-center font-bold",children:I.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-200",children:I.name}),e.jsx("p",{className:"text-xs text-gray-500",children:I.role||"No role"})]})]}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[I.email&&e.jsx("a",{href:`mailto:${I.email}`,className:"block text-gray-400 hover:text-white",children:I.email}),I.phone&&e.jsx("a",{href:`tel:${I.phone}`,className:"block text-gray-400 hover:text-white",children:I.phone})]})]})]})]}),w&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/60 backdrop-blur-md p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>k(!1),className:"absolute top-4 right-4 p-1 text-gray-500 hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-6",children:"Edit Opportunity"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=b.find(e=>e.id===D.clientId);h(C.id,{title:D.title,clientId:D.clientId||null,client:t?{company:t.company,id:t.id}:{},country:D.country,region:i(D.country),value:parseFloat(D.value)||0,currency:D.currency,probability:D.probability,source:D.source,competitors:D.competitors.split(",").map(e=>e.trim()).filter(Boolean),brief:D.brief,notes:D.notes,nextAction:D.nextAction,nextActionDate:D.nextActionDate||null,expectedCloseDate:D.expectedCloseDate||null}),k(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Title"}),e.jsx("input",{type:"text",value:D.title,onChange:e=>A({...D,title:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsxs("select",{value:D.country,onChange:e=>A({...D,country:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"Select country..."}),e.jsx("optgroup",{label:"GCC",children:n.GCC.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"Central Asia",children:n["Central Asia"].map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Client"}),e.jsxs("select",{value:D.clientId,onChange:e=>A({...D,clientId:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"No client linked"}),b.map(t=>e.jsx("option",{value:t.id,children:t.company},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Value"}),e.jsx("input",{type:"number",value:D.value,onChange:e=>A({...D,value:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{value:D.currency,onChange:e=>A({...D,currency:e.target.value}),className:"input w-full",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"MYR",children:"MYR"}),e.jsx("option",{value:"SGD",children:"SGD"}),e.jsx("option",{value:"AED",children:"AED"}),e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"QAR",children:"QAR"}),e.jsx("option",{value:"KWD",children:"KWD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Probability (%)"}),e.jsx("input",{type:"number",value:D.probability,onChange:e=>A({...D,probability:parseInt(e.target.value)||0}),className:"input w-full",min:"0",max:"100"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Source"}),e.jsx("input",{type:"text",value:D.source,onChange:e=>A({...D,source:e.target.value}),className:"input w-full",placeholder:"e.g. Referral, Website"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Competitors (comma-separated)"}),e.jsx("input",{type:"text",value:D.competitors,onChange:e=>A({...D,competitors:e.target.value}),className:"input w-full",placeholder:"e.g. Company A, Company B"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Brief"}),e.jsx("textarea",{value:D.brief,onChange:e=>A({...D,brief:e.target.value}),className:"input w-full min-h-[80px] resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Next Action"}),e.jsx("input",{type:"text",value:D.nextAction,onChange:e=>A({...D,nextAction:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Next Action Date"}),e.jsx("input",{type:"date",value:D.nextActionDate,onChange:e=>A({...D,nextActionDate:e.target.value}),className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Expected Close Date"}),e.jsx("input",{type:"date",value:D.expectedCloseDate,onChange:e=>A({...D,expectedCloseDate:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{value:D.notes,onChange:e=>A({...D,notes:e.target.value}),className:"input w-full min-h-[80px] resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Save Changes"})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/60 backdrop-blur-md p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 w-full max-w-md shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:B?"Edit Contact":"Add Contact"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),B?j(C.id,B,E):u(C.id,E),S(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:E.name||"",onChange:e=>M({...E,name:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role"}),e.jsx("input",{type:"text",value:E.role||"",onChange:e=>M({...E,role:e.target.value}),className:"input w-full",placeholder:"e.g. Marketing Director"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",value:E.email||"",onChange:e=>M({...E,email:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsx("input",{type:"tel",value:E.phone||"",onChange:e=>M({...E,phone:e.target.value}),className:"input w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:E.isPrimary||!1,onChange:e=>M({...E,isPrimary:e.target.checked}),className:"w-4 h-4 rounded border-gray-600 text-accent-primary focus:ring-accent-primary bg-dark-bg"}),e.jsx("label",{htmlFor:"isPrimary",className:"text-sm text-gray-300",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[e.jsx("button",{type:"button",onClick:()=>S(!1),className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:B?"Save Changes":"Add Contact"})]})]})]})})]})}export{o as default};
