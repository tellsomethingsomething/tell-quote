import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{ay as s,u as r,f as a,az as n}from"./index-Civi5K2Q.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const l=e=>{if(!e)return"-";return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})};function d({status:t}){const s=n[t]||n.draft;return e.jsx("span",{className:`text-xs px-2 py-1 rounded border ${s.color}`,children:s.label})}function i({invoice:s,onSelect:r,onUpdateStatus:n,onDelete:i,clients:o}){const[c,x]=t.useState(!1),u=o.find(e=>e.id===s.clientId),m="paid"!==s.status&&"cancelled"!==s.status&&s.dueDate&&new Date(s.dueDate)<new Date;return e.jsxs("tr",{className:"border-b border-dark-border hover:bg-dark-card/50 cursor-pointer transition-colors",onClick:()=>r(s.id),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm text-accent-primary",children:s.invoiceNumber})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-gray-200",children:u?.company||s.clientName||"Unknown"}),s.quoteNumber&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Quote: ",s.quoteNumber]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(d,{status:m&&"sent"===s.status?"overdue":s.status})}),e.jsx("td",{className:"px-4 py-3 text-right font-medium text-gray-200",children:a(s.total,s.currency)}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:l(s.issueDate)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:m?"text-red-400":"text-gray-400",children:l(s.dueDate)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),x(!c)},className:"p-1 text-gray-400 hover:text-gray-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),c&&e.jsxs("div",{className:"absolute right-0 top-8 w-40 bg-dark-card border border-dark-border rounded-lg shadow-xl z-10",onClick:e=>e.stopPropagation(),children:["draft"===s.status&&e.jsxs("button",{onClick:()=>{n(s.id,"sent"),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-bg flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Mark as Sent"]}),("sent"===s.status||"overdue"===s.status)&&e.jsxs("button",{onClick:()=>{n(s.id,"paid"),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-bg flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Mark as Paid"]}),e.jsxs("button",{onClick:()=>{i(s.id),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-dark-bg flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]})})]})}function o({label:t,value:s,subValue:r,icon:a,color:n}){return e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:t}),e.jsx("div",{className:`text-2xl font-bold ${n}`,children:s}),r&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r})]}),e.jsx("div",{className:`p-3 rounded-lg ${n.replace("text-","bg-").replace("400","500/10")}`,children:a})]})})}function c({isOpen:s,onClose:r,onCreateFromQuote:n,quotes:l,clients:d}){const[i,o]=t.useState(""),[c,x]=t.useState(""),u=l.filter(e=>"won"===e.status||"Won"===e.status||"accepted"===e.status),m=u.find(e=>e.id===i),h=m?d.find(e=>e.id===m.clientId):d.find(e=>e.id===c);return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-200 mb-4",children:"Create Invoice"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"From Won Quote"}),e.jsxs("select",{value:i,onChange:e=>o(e.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-gray-200",children:[e.jsx("option",{value:"",children:"Select a quote..."}),u.map(t=>{const s=d.find(e=>e.id===t.clientId);return e.jsxs("option",{value:t.id,children:[t.quote_number||t.quoteNumber," - ",s?.company||"Unknown"," (",a(t.grandTotal||t.total,t.currency),")"]},t.id)})]})]}),m&&e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-dark-border",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Quote Details"}),e.jsx("div",{className:"text-gray-200 font-medium",children:h?.company||"Unknown Client"}),e.jsx("div",{className:"text-accent-primary font-semibold",children:a(m.grandTotal||m.total,m.currency)})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-dark-bg border border-dark-border text-gray-300 rounded-lg hover:bg-dark-border transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{m&&(n(m,h),r())},disabled:!m,className:"flex-1 px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Invoice"})]})]})}):null}function x({invoice:t,onClose:s,onUpdateStatus:r,clients:n}){if(!t)return null;const i=n.find(e=>e.id===t.clientId);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-dark-border",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-200",children:["Invoice ",t.invoiceNumber]}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:i?.company||t.clientName||"Unknown Client"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{status:t.status}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"Issue Date"}),e.jsx("div",{className:"text-gray-200",children:l(t.issueDate)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"Due Date"}),e.jsx("div",{className:"text-gray-200",children:l(t.dueDate)})]}),t.paidDate&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"Paid Date"}),e.jsx("div",{className:"text-green-400",children:l(t.paidDate)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-300 mb-3",children:"Line Items"}),e.jsx("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-card/50",children:[e.jsx("th",{className:"text-left px-4 py-2 text-gray-400 font-medium",children:"Description"}),e.jsx("th",{className:"text-right px-4 py-2 text-gray-400 font-medium w-20",children:"Qty"}),e.jsx("th",{className:"text-right px-4 py-2 text-gray-400 font-medium w-20",children:"Days"}),e.jsx("th",{className:"text-right px-4 py-2 text-gray-400 font-medium w-24",children:"Rate"}),e.jsx("th",{className:"text-right px-4 py-2 text-gray-400 font-medium w-28",children:"Total"})]})}),e.jsx("tbody",{children:t.lineItems?.map((s,r)=>e.jsxs("tr",{className:"border-t border-dark-border",children:[e.jsx("td",{className:"px-4 py-2 text-gray-200",children:s.description}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-400",children:s.quantity}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-400",children:s.days}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-400",children:a(s.rate,t.currency)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-200",children:a(s.total,t.currency)})]},r))})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:a(t.subtotal,t.currency)})]}),t.taxRate>0&&e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsxs("span",{children:["Tax (",t.taxRate,"%)"]}),e.jsx("span",{children:a(t.taxAmount,t.currency)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold text-gray-200 pt-2 border-t border-dark-border",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:a(t.total,t.currency)})]})]})}),t.notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-300 mb-2",children:"Notes"}),e.jsx("div",{className:"text-sm text-gray-400 bg-dark-bg rounded-lg p-3 border border-dark-border whitespace-pre-wrap",children:t.notes})]})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-dark-border bg-dark-bg/50",children:["draft"===t.status&&e.jsxs("button",{onClick:()=>r(t.id,"sent"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Mark as Sent"]}),("sent"===t.status||"overdue"===t.status)&&e.jsxs("button",{onClick:()=>r(t.id,"paid"),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Mark as Paid"]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-dark-bg border border-dark-border text-gray-300 rounded-lg hover:bg-dark-border transition-colors ml-auto",children:"Close"})]})]})})}function u(){const{invoices:n,loading:l,getStats:d,updateStatus:u,deleteInvoice:m,createFromQuote:h,initialize:p}=s(),{clients:j,savedQuotes:g}=r(),b=g||[],[v,y]=t.useState(!1),[f,N]=t.useState(null),[k,w]=t.useState("all"),[C,L]=t.useState("");t.useEffect(()=>{p()},[p]);const D=t.useMemo(()=>d(),[n,d]),M=t.useMemo(()=>{let e=n;if("all"!==k)if("overdue"===k){const t=new Date;e=e.filter(e=>"paid"!==e.status&&"cancelled"!==e.status&&e.dueDate&&new Date(e.dueDate)<t)}else e=e.filter(e=>e.status===k);if(C){const t=C.toLowerCase();e=e.filter(e=>e.invoiceNumber?.toLowerCase().includes(t)||e.clientName?.toLowerCase().includes(t)||e.quoteNumber?.toLowerCase().includes(t))}return e},[n,k,C]),S=n.find(e=>e.id===f),z=async e=>{window.confirm("Are you sure you want to delete this invoice?")&&await m(e)};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"Invoices"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Manage invoices and track payments"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Invoice"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{label:"Total Revenue",value:a(D.totalRevenue,"USD",0),subValue:`${D.paid} paid invoices`,color:"text-green-400",icon:e.jsx("svg",{className:"w-6 h-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx(o,{label:"Outstanding",value:a(D.totalOutstanding,"USD",0),subValue:`${D.sent} awaiting payment`,color:"text-blue-400",icon:e.jsx("svg",{className:"w-6 h-6 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx(o,{label:"Overdue",value:D.overdue,subValue:"Need follow-up",color:"text-red-400",icon:e.jsx("svg",{className:"w-6 h-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx(o,{label:"Draft",value:D.draft,subValue:"Ready to send",color:"text-gray-400",icon:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Search invoices...",value:C,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:border-accent-primary"})]}),e.jsx("div",{className:"flex gap-2",children:["all","draft","sent","paid","overdue"].map(t=>e.jsx("button",{onClick:()=>w(t),className:"px-3 py-1.5 rounded-lg text-sm transition-colors "+(k===t?"bg-accent-primary text-white":"bg-dark-bg border border-dark-border text-gray-400 hover:text-gray-200"),children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-xl overflow-hidden",children:l?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading invoices..."}):0===M.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-600 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("div",{className:"text-gray-400 mb-2",children:"No invoices found"}),e.jsx("button",{onClick:()=>y(!0),className:"text-accent-primary hover:underline",children:"Create your first invoice"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-bg/50 border-b border-dark-border",children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Invoice #"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Client"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Status"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Issued"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs text-gray-400 font-medium uppercase",children:"Due"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:M.map(t=>e.jsx(i,{invoice:t,onSelect:N,onUpdateStatus:u,onDelete:z,clients:j},t.id))})]})}),e.jsx(c,{isOpen:v,onClose:()=>y(!1),onCreateFromQuote:async(e,t)=>{const s=await h(e,t);s&&N(s.id)},quotes:b,clients:j}),e.jsx(x,{invoice:S,onClose:()=>N(null),onUpdateStatus:(e,t)=>{u(e,t)},clients:j})]})}export{u as default};
