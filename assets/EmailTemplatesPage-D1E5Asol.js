import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{u as a,T as r,D as s,a as l}from"./emailTemplateStore-CHsNvek8.js";import{a as n}from"./sanitize-C9cT1rJa.js";import{o as d,aJ as o,t as i,X as c,U as m,H as x}from"./index-qIMeUE46.js";import{S as p}from"./search-CRv8fqA0.js";import{C as b}from"./chevron-right-w_KQjkaS.js";import{E as h}from"./ellipsis-vertical-BPmTC6Mk.js";import{P as u,S as g}from"./save-CPxKcKKr.js";import{C as j}from"./copy-COtzubd5.js";import{T as y}from"./trash-2-BNlxZ6R6.js";import{E as f}from"./eye-CVrfJldU.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const N=d("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]);function v({template:a,onSelect:s,onEdit:l,onDuplicate:n,onDelete:d}){const[o,i]=t.useState(!1),c=r[a.category]||r.custom;return e.jsxs("div",{onClick:()=>s(a),className:"bg-dark-card border border-dark-border rounded-lg p-4 hover:border-brand-primary/50 cursor-pointer transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-0.5 text-xs rounded-full ${c.color}`,children:[c.icon," ",c.label]}),a.is_shared&&e.jsxs("span",{className:"px-2 py-0.5 text-xs rounded-full bg-purple-500/10 text-purple-400",children:[e.jsx(m,{className:"w-3 h-3 inline mr-1"}),"Shared"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),i(!o)},className:"p-1 text-gray-400 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{className:"w-4 h-4"})}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:e=>{e.stopPropagation(),i(!1)}}),e.jsxs("div",{className:"absolute right-0 top-6 w-36 bg-dark-card border border-dark-border rounded-lg shadow-xl z-20 py-1",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),l(a),i(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-border/50 flex items-center gap-2",children:[e.jsx(u,{className:"w-3.5 h-3.5"})," Edit"]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),n(a),i(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-border/50 flex items-center gap-2",children:[e.jsx(j,{className:"w-3.5 h-3.5"})," Duplicate"]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),d(a),i(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",children:[e.jsx(y,{className:"w-3.5 h-3.5"})," Delete"]})]})]})]})]}),e.jsx("h3",{className:"font-medium text-white mb-1 truncate",children:a.name}),e.jsx("p",{className:"text-sm text-gray-400 mb-3 line-clamp-2",children:a.subject||"No subject"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),a.use_count," uses"]}),a.last_used_at&&e.jsxs("span",{children:["Last used ",new Date(a.last_used_at).toLocaleDateString()]})]})]})}function w({template:d,onSave:o,onClose:i}){const[m,x]=t.useState({name:d?.name||"",subject:d?.subject||"",body_html:d?.body_html||"",category:d?.category||"custom",is_shared:d?.is_shared||!1}),[p,h]=t.useState(!1),[u,j]=t.useState(!0),[y,v]=t.useState({clientName:"Acme Corp",contactName:"John Smith",contactFirstName:"John",companyName:"Your Company",projectName:"Summer Campaign",quoteAmount:"$15,000",quoteNumber:"Q-2025-001",quoteDueDate:"January 15, 2025",senderName:"Jane Doe",senderEmail:"jane@example.com",todayDate:(new Date).toLocaleDateString()}),{isSaving:w}=a(),k=async e=>{e.preventDefault(),await o(m)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:d?"Edit Template":"Create Template"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(!p),className:"px-3 py-1.5 text-sm rounded-lg flex items-center gap-2 "+(p?"bg-brand-primary text-white":"bg-dark-border text-gray-300 hover:text-white"),children:[e.jsx(f,{className:"w-4 h-4"}),"Preview"]}),e.jsx("button",{onClick:i,className:"p-1.5 text-gray-400 hover:text-white",children:e.jsx(c,{className:"w-5 h-5"})})]})]}),e.jsxs("form",{onSubmit:k,className:"flex-1 overflow-hidden flex",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-4 "+(p?"w-1/2 border-r border-dark-border":"w-full"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Template Name *"}),e.jsx("input",{type:"text",value:m.name,onChange:e=>x(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none",placeholder:"e.g., Quote Follow-up",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Category"}),e.jsx("select",{value:m.category,onChange:e=>x(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none",children:Object.entries(r).map(([t,a])=>e.jsxs("option",{value:t,children:[a.icon," ",a.label]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:m.subject,onChange:e=>x(t=>({...t,subject:e.target.value})),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none",placeholder:"e.g., Following up on your {{projectName}} quote"})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>j(!u),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white",children:[e.jsx(N,{className:"w-4 h-4"}),"Insert Variable",e.jsx(b,{className:"w-4 h-4 transition-transform "+(u?"rotate-90":"")})]}),u&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.map(t=>e.jsx("button",{type:"button",onClick:()=>(e=>{const t=document.getElementById("template-body");if(t){const a=t.selectionStart,r=t.selectionEnd,s=m.body_html,l=s.substring(0,a),n=s.substring(r),d=`${l}{{${e}}}${n}`;x(e=>({...e,body_html:d})),setTimeout(()=>{t.focus(),t.setSelectionRange(a+e.length+4,a+e.length+4)},0)}})(t.name),className:"px-2 py-1 text-xs bg-dark-border/50 text-gray-300 rounded hover:bg-brand-primary/20 hover:text-brand-primary",children:`{{${t.name}}}`},t.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Email Body"}),e.jsx("textarea",{id:"template-body",value:m.body_html,onChange:e=>x(t=>({...t,body_html:e.target.value})),className:"w-full h-64 px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none font-mono text-sm resize-none",placeholder:"Enter your email template here...\n\nUse {{variableName}} to insert dynamic content.\nExample: Hi {{contactFirstName}},"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.is_shared,onChange:e=>x(t=>({...t,is_shared:e.target.checked})),className:"rounded border-dark-border bg-dark-bg text-brand-primary focus:ring-brand-primary"}),"Share with team"]})})]})}),p&&e.jsxs("div",{className:"w-1/2 overflow-y-auto p-4 bg-dark-bg/50",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Preview with sample data"})}),e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 px-4 py-3 border-b",children:e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Subject: ",l(m.subject,y)||"(No subject)"]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"text-sm text-gray-800 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:n(l(m.body_html,y).replace(/\n/g,"<br>"))}})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-dark-border",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-300 hover:text-white",children:"Cancel"}),e.jsxs("button",{onClick:k,disabled:w||!m.name,className:"px-4 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-primary/90 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),w?"Saving...":d?"Update Template":"Create Template"]})]})]})})}function k({onSelect:s,onClose:l}){const{templates:n,loadTemplates:d,getFilteredTemplates:o,setSearchQuery:i,setCategoryFilter:m,categoryFilter:x,searchQuery:h}=a(),[u,g]=t.useState(!0);t.useEffect(()=>{d().then(()=>g(!1))},[]);const j=o();return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Select Template"}),e.jsx("button",{onClick:l,className:"p-1.5 text-gray-400 hover:text-white",children:e.jsx(c,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 border-b border-dark-border space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:h,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none",placeholder:"Search templates..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m(null),className:"px-3 py-1 text-sm rounded-full "+(x?"bg-dark-border text-gray-300 hover:text-white":"bg-brand-primary text-white"),children:"All"}),Object.entries(r).map(([t,a])=>e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1 text-sm rounded-full "+(x===t?"bg-brand-primary text-white":"bg-dark-border text-gray-300 hover:text-white"),children:[a.icon," ",a.label]},t))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:u?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading templates..."}):0===j.length?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No templates found"}):e.jsx("div",{className:"space-y-2",children:j.map(t=>{const a=r[t.category]||r.custom;return e.jsxs("div",{onClick:()=>s(t),className:"p-3 bg-dark-bg rounded-lg hover:bg-dark-border/50 cursor-pointer group flex items-center gap-3",children:[e.jsx("span",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${a.color}`,children:a.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white truncate",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400 truncate",children:t.subject||"No subject"})]}),e.jsx(b,{className:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100"})]},t.id)})})})]})})}function C(){const{templates:s,isLoading:l,loadTemplates:n,createTemplate:d,updateTemplate:c,deleteTemplate:m,duplicateTemplate:x,getFilteredTemplates:b,setSearchQuery:h,setCategoryFilter:u,categoryFilter:g,searchQuery:j,selectedTemplate:y,setSelectedTemplate:f}=a(),[N,k]=t.useState(!1),[C,S]=t.useState(null),[T,_]=t.useState(null);t.useEffect(()=>{n()},[]);const D=b(),E=e=>{S(e),k(!0)},F=async e=>{await x(e.id)},z=async e=>{_(e)};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-dark-border",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Email Templates"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Create and manage reusable email templates"})]}),e.jsxs("button",{onClick:()=>{S(null),k(!0)},className:"px-4 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-primary/90 flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"New Template"]})]}),e.jsx("div",{className:"p-4 border-b border-dark-border bg-dark-card/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(p,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:j,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:border-brand-primary focus:outline-none",placeholder:"Search templates..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(null),className:"px-3 py-1.5 text-sm rounded-lg "+(g?"bg-dark-border text-gray-300 hover:text-white":"bg-brand-primary text-white"),children:"All"}),Object.entries(r).map(([t,a])=>e.jsxs("button",{onClick:()=>u(t),className:"px-3 py-1.5 text-sm rounded-lg "+(g===t?"bg-brand-primary text-white":"bg-dark-border text-gray-300 hover:text-white"),children:[a.icon," ",a.label]},t))]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"})}):0===D.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(i,{className:"w-12 h-12 text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No templates found"}),e.jsx("p",{className:"text-gray-400 mb-4",children:j||g?"Try adjusting your search or filters":"Create your first email template to get started"}),!j&&!g&&e.jsx("button",{onClick:()=>{S(null),k(!0)},className:"px-4 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-primary/90",children:"Create Template"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(t=>e.jsx(v,{template:t,onSelect:f,onEdit:E,onDuplicate:F,onDelete:z},t.id))})}),N&&e.jsx(w,{template:C,onSave:async e=>{if(C){(await c(C.id,e)).success&&(k(!1),S(null))}else{(await d(e)).success&&k(!1)}},onClose:()=>{k(!1),S(null)}}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-xl p-6 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Template?"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:['Are you sure you want to delete "',T.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>_(null),className:"px-4 py-2 text-gray-300 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:async()=>{T&&(await m(T.id),_(null))},className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})})]})}export{k as TemplateSelector,C as default};
