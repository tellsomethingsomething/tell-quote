import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{r as t}from"./zustand-vendor-BohoUguQ.js";import{aD as s,am as a,f as r,aE as l,aF as n}from"./index-DoA-9vkb.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";function i(){const{purchaseOrders:i,loading:c,createPurchaseOrder:d,updatePurchaseOrder:o,deletePurchaseOrder:m,updateStatus:x}=s(),{projects:u}=a(),[p,h]=t.useState(!1),[v,j]=t.useState(null),[g,N]=t.useState("all"),[y,b]=t.useState("all"),[f,w]=t.useState(""),[C,k]=t.useState({vendorName:"",vendorEmail:"",vendorPhone:"",vendorAddress:"",projectId:"",category:"other",description:"",deliveryDate:"",deliveryLocation:"",paymentTerms:"Net 30",currency:"USD",notes:"",lineItems:[{description:"",quantity:1,unitPrice:0,total:0}]}),P=t.useMemo(()=>i.filter(e=>{if("all"!==g&&e.status!==g)return!1;if("all"!==y&&e.category!==y)return!1;if(f){const t=f.toLowerCase();return e.poNumber?.toLowerCase().includes(t)||e.vendorName?.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)}return!0}),[i,g,y,f]),L=t.useMemo(()=>{const e=i;return{total:e.length,draft:e.filter(e=>"draft"===e.status).length,pending:e.filter(e=>"pending"===e.status).length,approved:e.filter(e=>"approved"===e.status).length,totalValue:e.filter(e=>"cancelled"!==e.status).reduce((e,t)=>e+(t.total||0),0)}},[i]),D=()=>{k({vendorName:"",vendorEmail:"",vendorPhone:"",vendorAddress:"",projectId:"",category:"other",description:"",deliveryDate:"",deliveryLocation:"",paymentTerms:"Net 30",currency:"USD",notes:"",lineItems:[{description:"",quantity:1,unitPrice:0,total:0}]}),j(null)},I=(e,t,s)=>{k(a=>{const r=[...a.lineItems];return r[e]={...r[e],[t]:s},"quantity"!==t&&"unitPrice"!==t||(r[e].total=(parseFloat(r[e].quantity)||0)*(parseFloat(r[e].unitPrice)||0)),{...a,lineItems:r}})},S=()=>{const e=C.lineItems.reduce((e,t)=>e+(parseFloat(t.total)||0),0);return{subtotal:e,taxAmount:0,total:e}},O=e=>{const t=u.find(t=>t.id===e);return t?.name||"No Project"};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary"})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-100",children:"Purchase Orders"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage vendor purchase orders"})]}),e.jsxs("button",{onClick:()=>{D(),h(!0)},className:"btn-primary flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New PO"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:L.total})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Draft"}),e.jsx("p",{className:"text-lg font-semibold text-gray-400",children:L.draft})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-amber-400",children:L.pending})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Approved"}),e.jsx("p",{className:"text-lg font-semibold text-blue-400",children:L.approved})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Total Value"}),e.jsx("p",{className:"text-lg font-semibold text-green-400",children:r(L.totalValue,"USD",0)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search POs...",value:f,onChange:e=>w(e.target.value),className:"input w-full sm:w-64"}),e.jsxs("select",{value:g,onChange:e=>N(e.target.value),className:"input w-full sm:w-40",children:[e.jsx("option",{value:"all",children:"All Statuses"}),Object.entries(l).map(([t,{label:s}])=>e.jsx("option",{value:t,children:s},t))]}),e.jsxs("select",{value:y,onChange:e=>b(e.target.value),className:"input w-full sm:w-40",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries(n).map(([t,{label:s}])=>e.jsx("option",{value:t,children:s},t))]})]}),e.jsx("div",{className:"space-y-3",children:0===P.length?e.jsx("div",{className:"card p-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No purchase orders found"})}):P.map(t=>e.jsx("div",{className:"card p-4 hover:border-white/10 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-mono text-gray-500",children:t.poNumber}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded border ${l[t.status]?.color||"text-gray-400"}`,children:l[t.status]?.label||t.status}),e.jsx("span",{className:"text-xs text-gray-600",children:n[t.category]?.label})]}),e.jsx("p",{className:"font-medium text-gray-100 truncate",children:t.vendorName}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 truncate",children:t.description}),t.projectId&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:O(t.projectId)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:r(t.total,t.currency)}),t.deliveryDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Delivery: ",new Date(t.deliveryDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>(e=>{j(e),k({vendorName:e.vendorName||"",vendorEmail:e.vendorEmail||"",vendorPhone:e.vendorPhone||"",vendorAddress:e.vendorAddress||"",projectId:e.projectId||"",category:e.category||"other",description:e.description||"",deliveryDate:e.deliveryDate||"",deliveryLocation:e.deliveryLocation||"",paymentTerms:e.paymentTerms||"Net 30",currency:e.currency||"USD",notes:e.notes||"",lineItems:e.lineItems?.length>0?e.lineItems:[{description:"",quantity:1,unitPrice:0,total:0}]}),h(!0)})(t),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this purchase order?")&&await m(e)})(t.id),className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})},t.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:v?"Edit Purchase Order":"New Purchase Order"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t=S(),s={...C,subtotal:t.subtotal,taxAmount:t.taxAmount,total:t.total};v?await o(v.id,s):await d(s),h(!1),D()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-required",children:"Vendor Name"}),e.jsx("input",{type:"text",value:C.vendorName,onChange:e=>k(t=>({...t,vendorName:e.target.value})),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Vendor Email"}),e.jsx("input",{type:"email",value:C.vendorEmail,onChange:e=>k(t=>({...t,vendorEmail:e.target.value})),className:"input"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsx("select",{value:C.category,onChange:e=>k(t=>({...t,category:e.target.value})),className:"input",children:Object.entries(n).map(([t,{label:s}])=>e.jsx("option",{value:t,children:s},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Project"}),e.jsxs("select",{value:C.projectId,onChange:e=>k(t=>({...t,projectId:e.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"No Project"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:C.description,onChange:e=>k(t=>({...t,description:e.target.value})),className:"input resize-none",rows:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"label",children:"Line Items"}),e.jsx("button",{type:"button",onClick:()=>{k(e=>({...e,lineItems:[...e.lineItems,{description:"",quantity:1,unitPrice:0,total:0}]}))},className:"text-xs text-accent-primary hover:text-accent-primary/80",children:"+ Add Item"})]}),e.jsx("div",{className:"space-y-2",children:C.lineItems.map((t,s)=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:e=>I(s,"description",e.target.value),className:"input flex-1"}),e.jsx("input",{type:"number",placeholder:"Qty",value:t.quantity,onChange:e=>I(s,"quantity",e.target.value),className:"input w-20",min:"0"}),e.jsx("input",{type:"number",placeholder:"Price",value:t.unitPrice,onChange:e=>I(s,"unitPrice",e.target.value),className:"input w-24",min:"0",step:"0.01"}),e.jsx("span",{className:"input w-24 bg-dark-bg text-right",children:r(t.total||0,C.currency)}),C.lineItems.length>1&&e.jsx("button",{type:"button",onClick:()=>(e=>{k(t=>({...t,lineItems:t.lineItems.filter((t,s)=>s!==e)}))})(s),className:"p-2 text-gray-400 hover:text-red-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))}),e.jsxs("div",{className:"text-right mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Total: "}),e.jsx("span",{className:"font-semibold text-gray-100",children:r(S().total,C.currency)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Date"}),e.jsx("input",{type:"date",value:C.deliveryDate,onChange:e=>k(t=>({...t,deliveryDate:e.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Location"}),e.jsx("input",{type:"text",value:C.deliveryLocation,onChange:e=>k(t=>({...t,deliveryLocation:e.target.value})),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{value:C.notes,onChange:e=>k(t=>({...t,notes:e.target.value})),className:"input resize-none",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-border",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),D()},className:"btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:v?"Update PO":"Create PO"})]})]})]})})})]})}export{i as default};
