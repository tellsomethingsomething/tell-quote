import{j as e}from"./pdf-vendor-CqWdlgKa.js";import{c as t,r}from"./zustand-vendor-BohoUguQ.js";import{ah as a,E as s,X as o,O as n,aJ as i,a2 as l,H as c,y as d}from"./index-qIMeUE46.js";import{Z as u}from"./zap-CMFkoZ77.js";import{F as x}from"./funnel-kthCF9PN.js";import{S as m,P as p}from"./save-CPxKcKKr.js";import{C as g}from"./chevron-down-CteB8HXA.js";import{G as b}from"./grip-vertical-BPizAzMQ.js";import{T as h}from"./trash-2-BNlxZ6R6.js";import{C as f}from"./chevron-up-Do6HezCw.js";import{S as y}from"./search-CRv8fqA0.js";import{P as w}from"./play-NBGDxLN-.js";import{A as j}from"./activity-Dlj5BqIy.js";import{T as v}from"./trending-up-CRqRaClW.js";import{E as k}from"./ellipsis-vertical-BPmTC6Mk.js";import{C as N}from"./copy-COtzubd5.js";import{P as _}from"./pause-cnp5bgvf.js";import{C}from"./circle-x-Olk1pDV2.js";import"./react-vendor-DRPWudcR.js";import"./supabase-vendor-DWEVVlJw.js";const S={quote_sent:{id:"quote_sent",label:"Quote Sent",icon:"ðŸ“¤",category:"quote"},quote_expiring:{id:"quote_expiring",label:"Quote Expiring",icon:"â°",category:"quote"},quote_accepted:{id:"quote_accepted",label:"Quote Accepted",icon:"âœ…",category:"quote"},quote_rejected:{id:"quote_rejected",label:"Quote Rejected",icon:"âŒ",category:"quote"},opportunity_created:{id:"opportunity_created",label:"Opportunity Created",icon:"ðŸŽ¯",category:"opportunity"},opportunity_stage_change:{id:"opportunity_stage_change",label:"Stage Changed",icon:"ðŸ“Š",category:"opportunity"},opportunity_won:{id:"opportunity_won",label:"Opportunity Won",icon:"ðŸ†",category:"opportunity"},opportunity_lost:{id:"opportunity_lost",label:"Opportunity Lost",icon:"ðŸ˜¢",category:"opportunity"},no_activity:{id:"no_activity",label:"No Activity",icon:"ðŸ’¤",category:"engagement"},contact_added:{id:"contact_added",label:"Contact Added",icon:"ðŸ‘¤",category:"contact"},email_opened:{id:"email_opened",label:"Email Opened",icon:"ðŸ‘ï¸",category:"email"},email_clicked:{id:"email_clicked",label:"Link Clicked",icon:"ðŸ”—",category:"email"},task_overdue:{id:"task_overdue",label:"Task Overdue",icon:"âš ï¸",category:"task"},meeting_scheduled:{id:"meeting_scheduled",label:"Meeting Scheduled",icon:"ðŸ“…",category:"calendar"}},W={create_task:{id:"create_task",label:"Create Task",icon:"âœ…",color:"text-green-400"},send_email:{id:"send_email",label:"Send Email",icon:"ðŸ“§",color:"text-blue-400"},update_status:{id:"update_status",label:"Update Status",icon:"ðŸ”„",color:"text-amber-400"},notify_user:{id:"notify_user",label:"Notify User",icon:"ðŸ””",color:"text-purple-400"},log_activity:{id:"log_activity",label:"Log Activity",icon:"ðŸ“",color:"text-teal-400"},assign_to:{id:"assign_to",label:"Assign To",icon:"ðŸ‘¤",color:"text-indigo-400"},add_tag:{id:"add_tag",label:"Add Tag",icon:"ðŸ·ï¸",color:"text-pink-400"}},q={"=":{label:"equals",symbol:"="},"!=":{label:"not equals",symbol:"â‰ "},">":{label:"greater than",symbol:">"},">=":{label:"greater than or equal",symbol:"â‰¥"},"<":{label:"less than",symbol:"<"},"<=":{label:"less than or equal",symbol:"â‰¤"},contains:{label:"contains",symbol:"âˆ‹"},not_contains:{label:"does not contain",symbol:"âˆŒ"}},E={opportunity_value:{label:"Opportunity Value",type:"number"},opportunity_probability:{label:"Probability %",type:"number"},opportunity_stage:{label:"Pipeline Stage",type:"text"},days_since_activity:{label:"Days Since Activity",type:"number"},contact_count:{label:"Number of Contacts",type:"number"},has_decision_maker:{label:"Has Decision Maker",type:"boolean"},has_quote:{label:"Has Quote",type:"boolean"},quote_value:{label:"Quote Value",type:"number"},client_name:{label:"Client Name",type:"text"},lead_score:{label:"Lead Score",type:"number"},tags:{label:"Tags",type:"array"}},A=t(a((e,t)=>({workflows:[],executions:[],selectedWorkflow:null,isLoading:!1,isSaving:!1,error:null,initialize:async()=>{await t().loadWorkflows()},loadWorkflows:async()=>{e({isLoading:!0,error:null});try{const{data:{user:t}}=await s.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:r,error:a}=await s.from("workflow_rules").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(a)throw a;e({workflows:r||[],isLoading:!1})}catch(t){e({isLoading:!1,error:t.message})}},createWorkflow:async r=>{e({isSaving:!0,error:null});try{const{data:{user:a}}=await s.auth.getUser();if(!a)throw new Error("Not authenticated");const{data:o,error:n}=await s.from("workflow_rules").insert({user_id:a.id,name:r.name,description:r.description,is_active:r.is_active??!0,trigger_type:r.trigger_type,trigger_config:r.trigger_config||{},conditions:r.conditions||[],actions:r.actions||[],max_executions_per_entity:r.max_executions_per_entity,cooldown_hours:r.cooldown_hours||0}).select().single();if(n)throw n;return e({workflows:[o,...t().workflows],isSaving:!1}),{success:!0,workflow:o}}catch(a){return e({isSaving:!1,error:a.message}),{success:!1,error:a.message}}},updateWorkflow:async(r,a)=>{e({isSaving:!0,error:null});try{const{data:o,error:n}=await s.from("workflow_rules").update(a).eq("id",r).select().single();if(n)throw n;return e({workflows:t().workflows.map(e=>e.id===r?o:e),selectedWorkflow:t().selectedWorkflow?.id===r?o:t().selectedWorkflow,isSaving:!1}),{success:!0,workflow:o}}catch(o){return e({isSaving:!1,error:o.message}),{success:!1,error:o.message}}},deleteWorkflow:async r=>{try{const{error:a}=await s.from("workflow_rules").delete().eq("id",r);if(a)throw a;return e({workflows:t().workflows.filter(e=>e.id!==r),selectedWorkflow:t().selectedWorkflow?.id===r?null:t().selectedWorkflow}),{success:!0}}catch(a){return{success:!1,error:a.message}}},toggleWorkflow:async e=>{const r=t().workflows.find(t=>t.id===e);return r?t().updateWorkflow(e,{is_active:!r.is_active}):{success:!1,error:"Workflow not found"}},evaluateTrigger:async(e,r,a={})=>{try{const{workflows:s}=t(),o=s.filter(t=>t.is_active&&t.trigger_type===e),n=[];for(const e of o){if(!T(e.trigger_config,a))continue;if(!D(e.conditions,r,a))continue;if(!(await t().canExecuteWorkflow(e.id,r.id)))continue;const s=await t().executeWorkflow(e,r,a);n.push({workflowId:e.id,...s})}return n}catch(s){return[]}},canExecuteWorkflow:async(e,r)=>{try{const a=t().workflows.find(t=>t.id===e);if(!a)return!1;if(a.max_executions_per_entity){const{count:t}=await s.from("workflow_executions").select("*",{count:"exact",head:!0}).eq("rule_id",e).eq("entity_id",r).eq("status","completed");if(t>=a.max_executions_per_entity)return!1}if(a.cooldown_hours>0){const t=new Date;t.setHours(t.getHours()-a.cooldown_hours);const{data:o}=await s.from("workflow_executions").select("*").eq("rule_id",e).eq("entity_id",r).gte("started_at",t.toISOString()).limit(1);if(o&&o.length>0)return!1}return!0}catch(a){return!1}},executeWorkflow:async(e,t,r)=>{try{const{data:o,error:n}=await s.from("workflow_executions").insert({rule_id:e.id,entity_type:r.entityType||"unknown",entity_id:t.id,status:"running"}).select().single();if(n)throw n;const i=[];for(const s of e.actions)try{const e=await L(s,t,r);i.push({action:s.type,success:!0,result:e})}catch(a){i.push({action:s.type,success:!1,error:a.message})}const l=i.every(e=>e.success);return await s.from("workflow_executions").update({status:l?"completed":"failed",result:{actions:i},completed_at:(new Date).toISOString()}).eq("id",o.id),await s.from("workflow_rules").update({execution_count:(e.execution_count||0)+1,last_executed_at:(new Date).toISOString()}).eq("id",e.id),{success:l,actions:i}}catch(o){return{success:!1,error:o.message}}},loadExecutions:async(t=null,r=50)=>{try{let a=s.from("workflow_executions").select("*, workflow_rules(name)").order("started_at",{ascending:!1}).limit(r);t&&(a=a.eq("rule_id",t));const{data:o,error:n}=await a;if(n)throw n;return e({executions:o||[]}),o||[]}catch(a){return[]}},setSelectedWorkflow:t=>{e({selectedWorkflow:t})},reset:()=>{e({workflows:[],executions:[],selectedWorkflow:null,isLoading:!1,isSaving:!1,error:null})}})));function T(e,t){return!e||0===Object.keys(e).length||!(void 0!==e.days_before&&void 0!==t.daysUntilExpiry&&t.daysUntilExpiry>e.days_before)&&(!(void 0!==e.days_after&&void 0!==t.daysSinceActivity&&t.daysSinceActivity<e.days_after)&&((!e.status||t.status===e.status)&&(!e.stage||t.stage===e.stage)))}function D(e,t,r){return!e||0===e.length||e.every(e=>{const a=t[e.field]??r[e.field],s=e.value;switch(e.operator){case"=":case"==":return a===s;case"!=":return a!==s;case">":return a>s;case">=":return a>=s;case"<":return a<s;case"<=":return a<=s;case"contains":return String(a).toLowerCase().includes(String(s).toLowerCase());case"not_contains":return!String(a).toLowerCase().includes(String(s).toLowerCase());default:return!0}})}async function L(e,t,r){const a=e.config||{};switch(e.type){case"create_task":return await async function(e,t,r){const{data:a,error:o}=await s.from("activities").insert({user_id:r.userId,activity_type:"task",subject:t.subject||"Follow-up task",notes:t.notes||"",status:"pending",due_date:t.due_days?new Date(Date.now()+24*t.due_days*60*60*1e3).toISOString():null,client_id:e.client_id||e.clientId,opportunity_id:e.id}).select().single();if(o)throw o;return{taskId:a.id}}(t,a,r);case"send_email":return await async function(){return{queued:!0}}();case"update_status":return await async function(e,t,r){const a="quote"===r.entityType?"quotes":"opportunity"===r.entityType?"opportunities":null;if(!a)throw new Error("Unknown entity type for status update");const{error:o}=await s.from(a).update({status:t.status}).eq("id",e.id);if(o)throw o;return{newStatus:t.status}}(t,a,r);case"notify_user":return await async function(){return{notified:!0}}();case"log_activity":return await async function(e,t,r){const{data:a,error:o}=await s.from("activities").insert({user_id:r.userId,activity_type:t.activity_type||"note",subject:t.subject||"Automated activity",notes:t.notes||"",client_id:e.client_id||e.clientId,opportunity_id:e.id}).select().single();if(o)throw o;return{activityId:a.id}}(t,a,r);default:throw new Error(`Unknown action type: ${e.type}`)}}function O({value:t,onChange:a}){const[s,o]=r.useState(!1),n=S[t],i={};Object.entries(S).forEach(([e,t])=>{i[t.category]||(i[t.category]=[]),i[t.category].push({key:e,...t})});const l={quote:"Quote Events",opportunity:"Opportunity Events",activity:"Activity Events",engagement:"Engagement Events"};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>o(!s),className:"w-full flex items-center justify-between px-4 py-3 bg-dark-bg border border-dark-border rounded-lg text-white hover:border-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:n?.icon||"âš¡"}),e.jsx("span",{children:n?.label||"Select a trigger"})]}),e.jsx(g,{className:"w-5 h-5 text-gray-400 transition-transform "+(s?"rotate-180":"")})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>o(!1)}),e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-dark-nav border border-dark-border rounded-lg shadow-xl z-20 max-h-80 overflow-y-auto",children:Object.entries(i).map(([r,s])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wide bg-dark-bg",children:l[r]||r}),s.map(r=>e.jsxs("button",{type:"button",onClick:()=>{a(r.key),o(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:bg-dark-card transition-colors "+(t===r.key?"bg-brand-teal/10 text-brand-teal":"text-gray-300"),children:[e.jsx("span",{className:"text-lg",children:r.icon}),e.jsx("span",{children:r.label})]},r.key))]},r))})]})]})}function I({condition:t,index:r,onChange:a,onRemove:s}){const o=(e,r)=>{a({...t,[e]:r})};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-dark-bg rounded-lg",children:[e.jsx(b,{className:"w-4 h-4 text-gray-600 cursor-move"}),e.jsxs("select",{value:t.field||"",onChange:e=>o("field",e.target.value),className:"flex-1 px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Select field..."}),Object.entries(E).map(([t,r])=>e.jsx("option",{value:t,children:r.label},t))]}),e.jsxs("select",{value:t.operator||"",onChange:e=>o("operator",e.target.value),className:"w-32 px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Operator"}),Object.entries(q).map(([t,r])=>e.jsx("option",{value:t,children:r.label},t))]}),e.jsx("input",{type:"text",value:t.value||"",onChange:e=>o("value",e.target.value),placeholder:"Value",className:"w-32 px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal"}),e.jsx("button",{type:"button",onClick:s,className:"p-1.5 text-gray-500 hover:text-red-400 transition-colors",children:e.jsx(h,{className:"w-4 h-4"})})]})}function z({action:t,index:a,onChange:s,onRemove:o,onMoveUp:n,onMoveDown:i,isFirst:l,isLast:c}){const[d,u]=r.useState(!0),x=W[t.type],m=(e,r)=>{s({...t,config:{...t.config,[e]:r}})};return e.jsxs("div",{className:"border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-dark-card",children:[e.jsx(b,{className:"w-4 h-4 text-gray-600 cursor-move"}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg ${x?.color||""}`,children:x?.icon||"â€¢"}),e.jsxs("select",{value:t.type||"",onChange:e=>{return r="type",a=e.target.value,void s({...t,[r]:a});var r,a},className:"flex-1 px-3 py-1.5 bg-dark-bg border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Select action..."}),Object.entries(W).map(([t,r])=>e.jsxs("option",{value:t,children:[r.icon," ",r.label]},t))]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:n,disabled:l,className:"p-1 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",children:e.jsx(f,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:i,disabled:c,className:"p-1 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"p-1 text-gray-500 hover:text-white transition-colors",children:d?e.jsx(f,{className:"w-4 h-4"}):e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:o,className:"p-1 text-gray-500 hover:text-red-400 transition-colors",children:e.jsx(h,{className:"w-4 h-4"})})]})]}),d&&t.type&&e.jsx("div",{className:"px-4 pb-4 bg-dark-card border-t border-dark-border",children:(()=>{switch(t.type){case"create_task":return e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsx("input",{type:"text",value:t.config?.title||"",onChange:e=>m("title",e.target.value),placeholder:"Task title",className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal"}),e.jsx("textarea",{value:t.config?.description||"",onChange:e=>m("description",e.target.value),placeholder:"Task description",rows:2,className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal resize-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:t.config?.priority||"medium",onChange:e=>m("priority",e.target.value),className:"flex-1 px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"})]}),e.jsx("input",{type:"number",value:t.config?.dueDays||7,onChange:e=>m("dueDays",parseInt(e.target.value)),min:1,className:"w-24 px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal"}),e.jsx("span",{className:"text-gray-500 text-sm self-center",children:"days"})]})]});case"send_email":return e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("select",{value:t.config?.templateId||"",onChange:e=>m("templateId",e.target.value),className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Select email template..."}),e.jsx("option",{value:"followup",children:"Follow-up Email"}),e.jsx("option",{value:"reminder",children:"Reminder Email"}),e.jsx("option",{value:"thank_you",children:"Thank You Email"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Email will be sent to the primary contact on the opportunity"})]});case"update_status":return e.jsx("div",{className:"mt-3",children:e.jsxs("select",{value:t.config?.newStatus||"",onChange:e=>m("newStatus",e.target.value),className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"",children:"Select new status..."}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"qualified",children:"Qualified"}),e.jsx("option",{value:"proposal",children:"Proposal"}),e.jsx("option",{value:"negotiation",children:"Negotiation"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})});case"notify_user":return e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsx("input",{type:"text",value:t.config?.title||"",onChange:e=>m("title",e.target.value),placeholder:"Notification title",className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal"}),e.jsx("textarea",{value:t.config?.message||"",onChange:e=>m("message",e.target.value),placeholder:"Notification message",rows:2,className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal resize-none"})]});case"log_activity":return e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("select",{value:t.config?.activityType||"note",onChange:e=>m("activityType",e.target.value),className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"note",children:"Note"}),e.jsx("option",{value:"call",children:"Call"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"meeting",children:"Meeting"})]}),e.jsx("textarea",{value:t.config?.notes||"",onChange:e=>m("notes",e.target.value),placeholder:"Activity notes",rows:2,className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal resize-none"})]});case"add_tag":return e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",value:t.config?.tag||"",onChange:e=>m("tag",e.target.value),placeholder:"Tag name",className:"w-full px-3 py-2 bg-dark-card border border-dark-border rounded text-gray-300 text-sm focus:outline-none focus:border-brand-teal"})});default:return null}})()})]})}function F({workflow:t,onClose:a}){const{createWorkflow:s,updateWorkflow:c}=A(),[d,p]=r.useState(!1),[g,b]=r.useState(null),[h,f]=r.useState({name:"",description:"",trigger_type:"quote_sent",trigger_config:{},conditions:[],actions:[{type:"",config:{}}],is_active:!0});r.useEffect(()=>{t&&f({name:t.name||"",description:t.description||"",trigger_type:t.trigger_type||"quote_sent",trigger_config:t.trigger_config||{},conditions:t.conditions||[],actions:t.actions||[{type:"",config:{}}],is_active:!1!==t.is_active})},[t]);const y=(e,t)=>{const r=e+t;if(r<0||r>=h.actions.length)return;const a=[...h.actions];[a[e],a[r]]=[a[r],a[e]],f(e=>({...e,actions:a}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg w-full max-w-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-teal/20 flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-brand-teal"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t?"Edit Workflow":"Create Workflow"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Automate tasks when events occur"})]})]}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(o,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b(null),h.name.trim())if(h.actions.some(e=>e.type)){p(!0);try{const e=t?await c(t.id,h):await s(h);e.success?a():b(e.error||"Failed to save workflow")}catch(r){b(r.message)}finally{p(!1)}}else b("At least one action is required");else b("Workflow name is required")},className:"p-6 space-y-6",children:[g&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400",children:[e.jsx(n,{className:"w-5 h-5"}),e.jsx("span",{children:g})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Workflow Name *"}),e.jsx("input",{type:"text",value:h.name,onChange:e=>f(t=>({...t,name:e.target.value})),placeholder:"e.g., Follow up on sent quotes",className:"w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:h.description,onChange:e=>f(t=>({...t,description:e.target.value})),placeholder:"What does this workflow do?",rows:2,className:"w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(u,{className:"w-3 h-3 text-purple-400"})}),e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"When this happens..."})]}),e.jsx(O,{value:h.trigger_type,onChange:e=>f(t=>({...t,trigger_type:e}))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500/20 flex items-center justify-center",children:e.jsx(x,{className:"w-3 h-3 text-amber-400"})}),e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Only if these conditions match... (optional)"})]}),e.jsxs("button",{type:"button",onClick:()=>{f(e=>({...e,conditions:[...e.conditions,{field:"",operator:"",value:""}]}))},className:"text-sm text-brand-teal hover:text-brand-teal/80 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),"Add Condition"]})]}),0===h.conditions.length?e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm bg-dark-bg rounded-lg border border-dashed border-dark-border",children:"No conditions added. Workflow will run for all matching triggers."}):e.jsx("div",{className:"space-y-2",children:h.conditions.map((t,r)=>e.jsx(I,{condition:t,index:r,onChange:e=>((e,t)=>{f(r=>({...r,conditions:r.conditions.map((r,a)=>a===e?t:r)}))})(r,e),onRemove:()=>(e=>{f(t=>({...t,conditions:t.conditions.filter((t,r)=>r!==e)}))})(r)},r))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(l,{className:"w-3 h-3 text-green-400"})}),e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Then do these actions..."})]}),e.jsxs("button",{type:"button",onClick:()=>{f(e=>({...e,actions:[...e.actions,{type:"",config:{}}]}))},className:"text-sm text-brand-teal hover:text-brand-teal/80 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),"Add Action"]})]}),e.jsx("div",{className:"space-y-2",children:h.actions.map((t,r)=>e.jsx(z,{action:t,index:r,onChange:e=>((e,t)=>{f(r=>({...r,actions:r.actions.map((r,a)=>a===e?t:r)}))})(r,e),onRemove:()=>(e=>{f(t=>({...t,actions:t.actions.filter((t,r)=>r!==e)}))})(r),onMoveUp:()=>y(r,-1),onMoveDown:()=>y(r,1),isFirst:0===r,isLast:r===h.actions.length-1},r))})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Activate Workflow"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Workflow will run automatically when triggered"})]}),e.jsx("button",{type:"button",onClick:()=>f(e=>({...e,is_active:!e.is_active})),className:"w-12 h-6 rounded-full transition-colors relative "+(h.is_active?"bg-brand-teal":"bg-gray-700"),children:e.jsx("div",{className:"absolute top-1 w-4 h-4 rounded-full bg-white transition-transform "+(h.is_active?"translate-x-7":"translate-x-1")})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-border",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:d,className:"flex items-center gap-2 px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors disabled:opacity-50",children:[d?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(m,{className:"w-4 h-4"}),t?"Save Changes":"Create Workflow"]})]})]})]})})}function P({workflow:t,onEdit:a,onToggle:s,onDelete:o,onDuplicate:n}){const[i,x]=r.useState(!1),m=S[t.trigger_type],g=t.actions||[];return e.jsxs("div",{className:"bg-dark-card border rounded-lg p-4 transition-all "+(t.is_active?"border-dark-border":"border-dark-border/50 opacity-60"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center "+(t.is_active?"bg-brand-teal/20":"bg-gray-700"),children:e.jsx(u,{className:"w-5 h-5 "+(t.is_active?"text-brand-teal":"text-gray-500")})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:t.description})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>x(!i),className:"p-1.5 text-gray-400 hover:text-white rounded transition-colors",children:e.jsx(k,{className:"w-4 h-4"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>x(!1)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-dark-nav border border-dark-border rounded-lg shadow-xl z-20 py-1",children:[e.jsxs("button",{onClick:()=>{a(t),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>{n(t),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("button",{onClick:()=>{s(t),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-dark-card flex items-center gap-2",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4"}),"Activate"]})}),e.jsx("hr",{className:"my-1 border-dark-border"}),e.jsxs("button",{onClick:()=>{o(t),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-dark-card flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Delete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-purple-500/20 text-purple-300 rounded",children:[e.jsx("span",{children:m?.icon||"âš¡"}),e.jsx("span",{children:m?.label||t.trigger_type})]}),e.jsx(l,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[g.slice(0,3).map((t,r)=>{const a=W[t.type];return e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${a?.color||"text-gray-400"} bg-dark-bg`,children:[a?.icon||"â€¢"," ",a?.label||t.type]},r)}),g.length>3&&e.jsxs("span",{className:"px-2 py-1 rounded text-xs text-gray-400 bg-dark-bg",children:["+",g.length-3," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),t.execution_count||0," runs"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),(e=>{if(!e)return"Never";const t=new Date(e),r=new Date-t;return r<6e4?"Just now":r<36e5?`${Math.floor(r/6e4)}m ago`:r<864e5?`${Math.floor(r/36e5)}h ago`:t.toLocaleDateString()})(t.last_run_at)]})]}),e.jsx("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded "+(t.is_active?"bg-green-500/20 text-green-400":"bg-gray-700 text-gray-400"),children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-3 h-3"}),"Paused"]})})]})]})}function M({workflows:t,executions:r}){const a=t.filter(e=>e.is_active).length,s=t.reduce((e,t)=>e+(t.execution_count||0),0),o=r.filter(e=>"completed"===e.status).length,n=s>0?Math.round(o/s*100):0;return e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Total Workflows"}),e.jsx(u,{className:"w-4 h-4 text-brand-teal"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Active"}),e.jsx(w,{className:"w-4 h-4 text-green-400"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:a})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Total Runs"}),e.jsx(j,{className:"w-4 h-4 text-purple-400"})]}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:s})]}),e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Success Rate"}),e.jsx(v,{className:"w-4 h-4 text-amber-400"})]}),e.jsxs("p",{className:"text-2xl font-semibold text-white",children:[n,"%"]})]})]})}function U(){const{workflows:t,executions:a,isLoading:s,loadWorkflows:o,loadExecutions:n,updateWorkflow:l,deleteWorkflow:c,duplicateWorkflow:d}=A(),[m,p]=r.useState(""),[g,b]=r.useState("all"),[h,f]=r.useState("all"),[w,j]=r.useState(!1),[v,k]=r.useState(null),[N,_]=r.useState(null);r.useEffect(()=>{o(),n()},[]);const C=t.filter(e=>{const t=!m||e.name.toLowerCase().includes(m.toLowerCase())||e.description?.toLowerCase().includes(m.toLowerCase()),r="all"===g||"active"===g&&e.is_active||"paused"===g&&!e.is_active,a="all"===h||e.trigger_type===h;return t&&r&&a}),W=e=>{k(e),j(!0)},q=async e=>{await l(e.id,{is_active:!e.is_active})},E=async e=>{_(e)},T=async e=>{await d(e.id)},D=Object.entries(S).map(([e,t])=>({value:e,label:t.label,icon:t.icon}));return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Workflow Automation"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Automate tasks based on triggers and conditions"})]}),e.jsxs("button",{onClick:()=>{k(null),j(!0)},className:"flex items-center gap-2 px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors",children:[e.jsx(i,{className:"w-4 h-4"}),"New Workflow"]})]}),e.jsx(M,{workflows:t,executions:a}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search workflows...",value:m,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-card border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-brand-teal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:g,onChange:e=>b(e.target.value),className:"px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-gray-300 focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]}),e.jsxs("select",{value:h,onChange:e=>f(e.target.value),className:"px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-gray-300 focus:outline-none focus:border-brand-teal",children:[e.jsx("option",{value:"all",children:"All Triggers"}),D.map(t=>e.jsxs("option",{value:t.value,children:[t.icon," ",t.label]},t.value))]})]})]}),s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-brand-teal border-t-transparent rounded-full"})}):0===C.length?e.jsxs("div",{className:"text-center py-12 bg-dark-card border border-dark-border rounded-lg",children:[e.jsx(u,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:0===t.length?"No workflows yet":"No matching workflows"}),e.jsx("p",{className:"text-gray-400 mb-4",children:0===t.length?"Create your first workflow to automate repetitive tasks":"Try adjusting your search or filters"}),0===t.length&&e.jsx("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-brand-teal text-white rounded-lg hover:bg-brand-teal/90 transition-colors",children:"Create Workflow"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(t=>e.jsx(P,{workflow:t,onEdit:W,onToggle:q,onDelete:E,onDuplicate:T},t.id))}),w&&e.jsx(F,{workflow:v,onClose:()=>{j(!1),k(null)}}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Workflow"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:['Are you sure you want to delete "',N.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>_(null),className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{N&&(await c(N.id),_(null))},className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete"})]})]})})]})}export{U as default};
